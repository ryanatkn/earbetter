var St=l=>{throw TypeError(l)};var Tt=(l,e,a)=>e.has(l)||St("Cannot "+a);var ut=(l,e,a)=>(Tt(l,e,"read from private field"),a?a.call(l):e.get(l)),mt=(l,e,a)=>e.has(l)?St("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,a),ft=(l,e,a,r)=>(Tt(l,e,"write to private field"),r?r.call(l,a):e.set(l,a),a);import{d as Te,t as p,x as Xe,s as he,a as _,y as xa,b as N,c as Dt,h as wa}from"../chunks/D6FQBtKd.js";import{aO as ja,g as t,a9 as za,r as qa,u as Ia,a0 as Ot,p as de,M as Me,V as D,f as ze,c as o,G as m,a as i,s as n,b as u,t as Y,d as ue,T as Ne,n as Ce,B as At,X as Sa}from"../chunks/Drfw-9es.js";import{g as Ta,b as Aa}from"../chunks/DGs4Uxve.js";import{H as Pa}from"../chunks/DIMrDfL4.js";import{m as Ma,F as Ea}from"../chunks/CxoK_AUc.js";import{R as La,K as Rt,T as gt,d as Ct,U as Nt,l as Da,W as Oa,J as Ra,j as Bt,n as bt,p as Ca,X as ht,Y as Ft,o as Jt,w as Vt,Z as Na,f as Ht,a as tt,b as at,_ as nt,m as Pt,$ as Ba,t as we,c as je,a0 as it,M as Ut,a1 as st,a2 as Wt,s as Gt,a3 as Fa,a4 as Ja}from"../chunks/CPUX8dqx.js";import{p as te,i as w}from"../chunks/CnDERkxj.js";import{i as Va,s as Ha,b as xe,I as Xt,V as Yt,c as Kt,a as Ua}from"../chunks/BpNc9_EQ.js";import{e as Be,r as Se,s as X,j as lt,d as Zt,b as Qt,p as Wa,c as Ee,k as Ga}from"../chunks/wr1Q2OBW.js";import{M as $t,P as ea,b as Xa,B as Ya}from"../chunks/Bb9lJ5m4.js";import{b as Le}from"../chunks/BIJQOs6A.js";import{D as Ue}from"../chunks/D4kchBJr.js";import{A as rt}from"../chunks/rZfaOUOJ.js";import{L as Ka}from"../chunks/50t3z5os.js";function Za(l){let e=0,a=za(0),r;return()=>{ja()&&(t(a),qa(()=>(e===0&&(r=Ia(()=>l(()=>La(a)))),e+=1,()=>{Ot().then(()=>{e-=1,e===0&&(r==null||r(),r=void 0)})})))}}var We,Ge;class Qa{constructor(e,a){mt(this,We);mt(this,Ge);ft(this,We,e),ft(this,Ge,Za(a))}get current(){return ut(this,Ge).call(this),ut(this,We).call(this)}}We=new WeakMap,Ge=new WeakMap;var Mt=Object.prototype.hasOwnProperty;function Et(l,e,a){for(a of l.keys())if(De(a,e))return a}function De(l,e){var a,r,c;if(l===e)return!0;if(l&&e&&(a=l.constructor)===e.constructor){if(a===Date)return l.getTime()===e.getTime();if(a===RegExp)return l.toString()===e.toString();if(a===Array){if((r=l.length)===e.length)for(;r--&&De(l[r],e[r]););return r===-1}if(a===Set){if(l.size!==e.size)return!1;for(r of l)if(c=r,c&&typeof c=="object"&&(c=Et(e,c),!c)||!e.has(c))return!1;return!0}if(a===Map){if(l.size!==e.size)return!1;for(r of l)if(c=r[0],c&&typeof c=="object"&&(c=Et(e,c),!c)||!De(r[1],e.get(c)))return!1;return!0}if(a===ArrayBuffer)l=new Uint8Array(l),e=new Uint8Array(e);else if(a===DataView){if((r=l.byteLength)===e.byteLength)for(;r--&&l.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(l)){if((r=l.byteLength)===e.byteLength)for(;r--&&l[r]===e[r];);return r===-1}if(!a||typeof l=="object"){r=0;for(a in l)if(Mt.call(l,a)&&++r&&!Mt.call(e,a)||!(a in e)||!De(l[a],e[a]))return!1;return Object.keys(e).length===r}}return l!==l&&e!==e}var $a=(l,e)=>m(e,l.currentTarget.value,!0),el=(l,e,a,r,c,s)=>{var f;return(f=e.oninput)==null?void 0:f.call(e,t(a),t(r)?{scale:c(),octaves:s()}:void 0)},tl=(l,e)=>e(Da(l.currentTarget.value)),al=p("<option> </option>"),ll=p('<small><textarea class="preview width_sm panel svelte-1n8fnqy"></textarea></small> <button type="button" class="accent mb_lg">use these intervals</button> <label><div class="title text_align_center">scale</div> <select></select></label> <label><div class="title text_align_center">octaves</div> <div class="text_align_center"> </div> <input type="range"></label>',1);function rl(l,e){de(e,!0);let a=te(e,"scale",31,()=>Me(Rt)),r=te(e,"octaves",15,1);const c=u(()=>Oa(a(),r())),s=u(()=>gt(t(c))),f=Me(gt(e.intervals));let h=D(Me(f));const g=u(()=>(t(c),Date.now())),P=u(()=>(e.intervals,t(h),Date.now())),z=u(()=>t(g)>t(P)),k=u(()=>t(z)?t(s):t(h)),b=u(()=>Nt(t(k))),j=u(()=>!De(e.intervals,t(b))),q=u(()=>!!t(b).length);var T=ll(),F=ze(T),M=o(F);Xe(M),M.__input=[$a,h],i(F);var L=n(F,2);L.__click=[el,e,b,z,a,r];var R=n(L,2),E=n(o(R),2);Va(E,()=>a().name);var K;E.__change=[tl,a],Be(E,20,()=>Ct,se=>se,(se,_e)=>{var O=al(),B={},re=o(O,!0);i(O),Y(()=>{B!==(B=_e.name)&&(O.value=(O.__value=_e.name)??""),he(re,_e.name)}),_(se,O)}),i(E),i(R);var H=n(R,2),I=n(o(H),2),W=o(I,!0);i(I);var me=n(I,2);Se(me),X(me,"min",1),X(me,"max",6),i(H),Y(()=>{lt(M,t(k)),L.disabled=!t(j)||!t(q),K!==(K=a().name)&&(E.value=(E.__value=a().name)??"",Ha(E,a().name)),he(W,r())}),xe(me,r),_(l,T),ue()}Te(["input","click","change"]);const Lt=new Qa(()=>window.innerWidth,l=>xa(window,"resize",l));var nl=(l,e)=>{m(e,new Set,!0)},il=(l,e,a)=>{var r;(r=e.oninput)==null||r.call(e,t(a))},sl=p('<!> <button class="mb_lg" type="button">clear selection</button> <button type="button" class="accent">select <!> </button>',1),ol=p("<option> </option>"),_l=(l,e,a)=>e(t(a)),cl=p('<button type="button"> </button>'),vl=(l,e)=>e(l.currentTarget.value),dl=p('<!> <div class="notes_input pt_lg svelte-18obm47"><!> <div class="piano_wrapper svelte-18obm47"><!></div> <section class="box"><label class="mb_lg"><div class="title text_align_center">key</div> <select></select></label> <div class="scales mb_lg svelte-18obm47"></div> <!> <div class="notes width_sm svelte-18obm47"><blockquote class="panel my_lg"><textarea></textarea></blockquote></div></section> <form class="width_sm panel p_md"><fieldset><!> <!></fieldset> <fieldset><!></fieldset></form></div>',1);function ul(l,e){de(e,!0);const a=A=>{var d=sl(),y=ze(d);Qt(y,()=>e.before_buttons);var Z=n(y,2);Z.__click=[nl,s];var $=n(Z,2);$.__click=[il,e,f];var x=n(o($));{var S=G=>{var J=N("all");_(G,J)},Q=G=>{var J=N();Y(()=>he(J,t(g))),_(G,J)};w(x,G=>{t(g)===0?G(S):G(Q,!1)})}var V=n(x);i($),Y(G=>{Z.disabled=t(g)===0,$.disabled=!t(b),he(V,` tonic${G??""}`)},[()=>Wa(t(g))]),_(A,d)},r=te(e,"audio_state",7),{playing_notes:c}=r();let s=D(void 0);const f=u(()=>t(s)&&Array.from(t(s)).sort((A,d)=>A-d)),h=u(()=>t(s)??e.notes),g=u(()=>t(h).size),P=u(()=>t(f)&&ht(t(f))),z=A=>{m(s,new Set(Ft(A)),!0)},k=u(()=>ht(Array.from(e.notes).sort((A,d)=>A-d))),b=u(()=>!!t(f)&&t(P)!==t(k)),j=A=>{const d=new Set(t(h));d.has(A)?d.delete(A):d.add(A),m(s,d,!0)};let q=D(Me(Ra));const T=Bt.get(),F=20,M=(A,d=null)=>{Jt(r(),T(),A,Vt(r().volume,d),r().instrument)},L=A=>{const d=Na(A,t(q),e.min_note,e.max_note);if(!t(s)||!t(f)){m(s,d,!0);return}let y=!0;for(const $ of d)if(!t(s).has($)){y=!1;break}const Z=y?t(f).filter($=>!d.has($)):t(f).concat(Array.from(d));m(s,new Set(Z),!0)};var R=dl(),E=ze(R);$t(E,{get midi_access(){return r().midi_access},onnotestart:(A,d)=>M(A,d),onnotestop:A=>bt(A)});var K=n(E,2),H=o(K);a(H);var I=n(H,2);Zt(I,"",{},{padding:"20px"});var W=o(I);{var me=A=>{const d=u(()=>Lt.current-F*5);ea(A,{get width(){return t(d)},get min_note(){return e.min_note},get max_note(){return e.max_note},max_height:300,pressed_keys:c,get highlighted_keys(){return t(h)},middle_c_label:!0,allow_sticking:!0,onpress:y=>{j(y),M(y)},onrelease:y=>{bt(y)}})};w(W,A=>{Lt.current&&A(me)})}i(I);var se=n(I,2),_e=o(se),O=n(o(_e),2);Be(O,20,()=>Ca,A=>A,(A,d)=>{var y=ol(),Z={},$=o(y,!0);i(y),Y(()=>{Z!==(Z=d)&&(y.value=(y.__value=d)??""),he($,d)}),_(A,y)}),i(O),i(_e);var B=n(_e,2);Be(B,21,()=>Ct,A=>A.name,(A,d)=>{var y=cl();y.__click=[_l,L,d];var Z=o(y,!0);i(y),Y(()=>he(Z,t(d).name)),_(A,y)}),i(B);var re=n(B,2);a(re);var fe=n(re,2),ge=o(fe),ae=o(ge);Xe(ae),ae.__change=[vl,z],i(ge),i(fe),i(se);var ee=n(se,2),U=o(ee),be=o(U);Xt(be,{get instrument(){return r().instrument},set instrument(A){r().instrument=A}});var qe=n(be,2);Yt(qe,{get volume(){return r().volume},set volume(A){r().volume=A}}),i(U);var Ae=n(U,2),pe=o(Ae);Kt(pe,{get midi_state(){return r()}}),i(Ae),i(ee),i(K),Y(()=>lt(ae,t(P))),Ua(O,()=>t(q),A=>m(q,A)),_(l,R),ue()}Te(["click","change"]);var ml=(l,e)=>{var a;navigator.clipboard.writeText(e.text),(a=e.oncopy)==null||a.call(e)},fl=p('<button type="button" class="my_lg"><!></button>');function pt(l,e){de(e,!0);var a=fl();a.__click=[ml,e];var r=o(a);{var c=f=>{var h=Dt(),g=ze(h);Qt(g,()=>e.children),_(f,h)},s=f=>{var h=N("copy to clipboard");_(f,h)};w(r,f=>{e.children?f(c):f(s,!1)})}i(a),_(l,a),ue()}Te(["click"]);const gl=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Ba());const f=nt.parse(s);r.onsubmit(f)}catch(s){console.error("failed to import data",s),m(e,s.message||"unknown error",!0)}m(c,!1)},bl=(l,e,a,r,c)=>{m(e,m(a,JSON.stringify(r()),!0),!0),m(c,!0)};var hl=(l,e)=>m(e,Nt(l.currentTarget.value)),pl=(l,e)=>m(e,!0),yl=p("<!> <br>",1),kl=(l,e)=>m(e,Ft(l.currentTarget.value)),xl=(l,e)=>m(e,!0),wl=(l,e,a)=>e.onsubmit(a()),jl=(l,e)=>m(e,!t(e)),zl=(l,e,a)=>{m(e,!1),a.onremove(a.level_data.id)},ql=p('<div class="pb_md"><button type="button" class="color_c w_100 svelte-h4qokl">✕ confirm remove</button></div>'),Il=(l,e)=>e.onduplicate(e.level_data.id),Sl=p('<button type="button" class="svelte-h4qokl">duplicate level</button>'),Tl=p('<button type="button" class="svelte-h4qokl">remove level</button> <!> <!>',1),Al=p("<pre> </pre>"),Pl=p('<div class="overflow_x_auto"><!></div>'),Ml=(l,e,a,r)=>e.onplay(t(a)?r():e.level_data,t(a)),El=p('<button type="button" class="svelte-h4qokl">play!</button>'),Ll=(l,e)=>e.onclose(e.level_data.id),Dl=p('<button type="button" class="svelte-h4qokl"><!></button>'),Ol=p('<div class="importing pane shadow_d_xl p_xl width_md mx_auto svelte-h4qokl"><h2 class="my_0">import level data</h2> <!> <textarea class="svelte-h4qokl"></textarea> <button type="button" class="svelte-h4qokl">import project data</button></div>'),Rl=p('<div class="pane mx_auto shadow_d_xl p_xl width_md box"><h2 class="my_0">pick intervals</h2> <!> <button type="button" class="svelte-h4qokl">cancel</button></div>'),Cl=p('<button type="button" class="mb_lg svelte-h4qokl">cancel</button>'),Nl=p('<div class="pane mx_auto shadow_d_xl py_xl box"><h2 class="my_0">pick tonics</h2> <!></div>'),Bl=p(`<form class="level_def_form w_100"><header><h2 class="my_0"><!></h2></header> <div class="fields svelte-h4qokl"><fieldset><label><div class="title">name</div> <input></label></fieldset> <fieldset><label class="mb_0" title="the semitones to include relative to the tonic"><div class="title">intervals</div> <input></label> <button type="button" class="svelte-h4qokl">pick intervals</button> <details><summary>about <code>intervals</code></summary> <p><code>intervals</code> is a comma-separated list of numbers representing the <a href="https://wikipedia.org/wiki/Interval_(music)">musical intervals</a> used in the
					level, aka the number of piano keys (<a href="https://wikipedia.org/wiki/Semitone">semitones</a>) separating each note from the <a href="https://wikipedia.org/wiki/Tonic_(music)">tonic</a> (see below)</p> <p>for example, to practice distinguishing between the <a href="https://wikipedia.org/wiki/Perfect_fourth">perfect fourth</a> and <a href="https://wikipedia.org/wiki/Perfect_fifth">perfect fifth</a>, enter "<code>5, 7</code>"</p> <p>negative numbers are allowed</p></details></fieldset> <fieldset><label title="the number of trials per level"><div class="title">trial count</div> <div class="row"><input class="small_input svelte-h4qokl" type="number"> <input type="range"></div></label></fieldset> <fieldset><label title="the number of notes per trial"><div class="title">sequence length</div> <div class="row"><input class="small_input svelte-h4qokl" type="number"> <input type="range"></div></label></fieldset> <fieldset class="row"><label class="text_align_center"><div class="title">lowest note</div> <div> </div> <input type="number"> <input type="range"></label> <label class="text_align_center"><div class="title">highest note</div> <div> </div> <input type="number"> <input type="range"></label></fieldset> <!> <fieldset><label class="mb_0" title="the possible starting notes for each trial"><div class="title">tonics</div> <input placeholder="all"></label> <button type="button" class="svelte-h4qokl">pick tonics</button> <details><summary>about <code>tonics</code></summary> <p>The <a href="https://wikipedia.org/wiki/Tonic_(music)">tonic</a> is like the "base" or "home"
					note, and for our purposes it's always the first note played in a trial. Other notes in the
					trial are calculated from the tonic and intervals. (see above)</p></details></fieldset> <button type="button" class="accent svelte-h4qokl"><!></button> <!> <button type="button" class="svelte-h4qokl"><!></button> <!> <!> <!></div></form> <!> <!> <!>`,1);function Fl(l,e){de(e,!0);const a=te(e,"editing",3,!1),r=Ht.get();let c=D(!1),s=D(Me(e.level_data.name));const f=u(()=>{var v;return(v=t(s))==null?void 0:v.trim()});let h=D(e.level_data.intervals),g=D(e.level_data.tonics);const P=u(()=>t(g)?t(g).filter(v=>v>=t(b)&&v<=t(j)):t(g));let z=D(Me(e.level_data.trial_count)),k=D(Me(e.level_data.sequence_length)),b=D(Me(e.level_data.min_note)),j=D(Me(e.level_data.max_note));const q=()=>nt.parse({id:e.level_data.id,name:t(f),intervals:t(h),tonics:t(P),trial_count:t(z),sequence_length:t(k),min_note:t(b),max_note:t(j)});Ne(()=>{m(s,e.level_data.name,!0),m(h,e.level_data.intervals),m(g,e.level_data.tonics),m(z,e.level_data.trial_count,!0),m(k,e.level_data.sequence_length,!0),m(b,e.level_data.min_note,!0),m(j,e.level_data.max_note,!0)});const T=u(()=>t(f)!==e.level_data.name||t(z)!==e.level_data.trial_count||t(k)!==e.level_data.sequence_length||t(b)!==e.level_data.min_note||t(j)!==e.level_data.max_note||!De(t(h),e.level_data.intervals)||!De(t(P),e.level_data.tonics));let F=D(!1),M=D(!1),L=D(!1),R=D(""),E=D("");const K=u(()=>t(R)!==t(E));let H=D("");Ne(()=>{e.level_data,m(H,"")});let I=D(void 0),W=D(void 0),me=D(void 0),se=D(void 0);const _e=u(()=>t(g)&&new Set(t(g)));let O=D(Me(Rt)),B=D(1),re=D(void 0);const fe=u(()=>t(b)>=t(j));var ge=Bl(),ae=ze(ge),ee=o(ae),U=o(ee),be=o(U);{var qe=v=>{var C=N("editing level");_(v,C)},Ae=v=>{var C=N("create a new level");_(v,C)};w(be,v=>{a()?v(qe):v(Ae,!1)})}i(U),i(ee);var pe=n(ee,2),A=o(pe),d=o(A),y=n(o(d),2);Se(y),i(d),i(A);var Z=n(A,2),$=o(Z),x=n(o($),2);Se(x),x.__change=[hl,h],Le(x,v=>m(me,v),()=>t(me)),i($);var S=n($,2);S.__click=[pl,M],Ce(2),i(Z);var Q=n(Z,2),V=o(Q),G=n(o(V),2),J=o(G);Se(J),X(J,"min",1);var oe=n(J,2);Se(oe),X(oe,"min",1),X(oe,"max",20),i(G),i(V),i(Q);var ne=n(Q,2),Pe=o(ne),Ye=n(o(Pe),2),Ke=o(Ye);Se(Ke),X(Ke,"min",2);var Ze=n(Ke,2);Se(Ze),X(Ze,"min",2),X(Ze,"max",16),i(Ye),i(Pe),i(ne);var ot=n(ne,2),_t=o(ot),ct=n(o(_t),2),ta=o(ct,!0);i(ct);var Oe=n(ct,2);Se(Oe),X(Oe,"step",1),X(Oe,"min",tt),X(Oe,"max",at);var Fe=n(Oe,2);Se(Fe),X(Fe,"step",1),X(Fe,"min",tt),X(Fe,"max",at),i(_t);var yt=n(_t,2),vt=n(o(yt),2),aa=o(vt,!0);i(vt);var Re=n(vt,2);Se(Re),X(Re,"step",1),X(Re,"min",tt),X(Re,"max",at);var Je=n(Re,2);Se(Je),X(Je,"step",1),X(Je,"min",tt),X(Je,"max",at),i(yt),i(ot);var kt=n(ot,2);{var la=v=>{rt(v,{status:"error",children:(C,ce)=>{Ce();var ve=N("the lowest note must be lower than the highest");_(C,ve)},$$slots:{default:!0}})},ra=v=>{var C=yl(),ce=ze(C);const ve=u(()=>t(re)??0);ea(ce,{get width(){return t(ve)},max_height:50,get min_note(){return t(b)},get max_note(){return t(j)},get highlighted_keys(){return t(_e)},clickable:!1,middle_c_label:!0}),Ce(2),_(v,C)};w(kt,v=>{t(fe)?v(la):v(ra,!1)})}var Qe=n(kt,2),dt=o(Qe),$e=n(o(dt),2);Se($e),$e.__change=[kl,g],Le($e,v=>m(se,v),()=>t(se)),i(dt);var na=n(dt,2);na.__click=[xl,L],Ce(2),i(Qe);var Ve=n(Qe,2);Ve.__click=[wl,e,q];var ia=o(Ve);{var sa=v=>{var C=N("save changes to level");_(v,C)},oa=v=>{var C=N("create level");_(v,C)};w(ia,v=>{a()?v(sa):v(oa,!1)})}i(Ve);var xt=n(Ve,2);{var _a=v=>{var C=Tl(),ce=ze(C);ce.__click=[jl,c];var ve=n(ce,2);{var ye=le=>{var Ie=ql(),et=o(Ie);et.__click=[zl,c,e],i(Ie),we(3,Ie,()=>je),_(le,Ie)};w(ve,le=>{t(c)&&le(ye)})}var ie=n(ve,2);{var ke=le=>{var Ie=Sl();Ie.__click=[Il,e],_(le,Ie)};w(ie,le=>{e.onduplicate&&le(ke)})}_(v,C)};w(xt,v=>{e.onremove&&a()&&v(_a)})}var He=n(xt,2);He.__click=[bl,R,E,q,F];var ca=o(He);{var va=v=>{var C=N("import/export data");_(v,C)},da=v=>{var C=N("import data");_(v,C)};w(ca,v=>{a()?v(va):v(da,!1)})}i(He),Le(He,v=>m(W,v),()=>t(W));var wt=n(He,2);{var ua=v=>{var C=Pl(),ce=o(C);rt(ce,{status:"error",children:(ve,ye)=>{var ie=Al(),ke=o(ie,!0);i(ie),Y(()=>he(ke,t(H))),_(ve,ie)},$$slots:{default:!0}}),i(C),_(v,C)};w(wt,v=>{t(H)&&v(ua)})}var jt=n(wt,2);{var ma=v=>{var C=El();C.__click=[Ml,e,T,q],_(v,C)};w(jt,v=>{e.onplay&&a()&&v(ma)})}var fa=n(jt,2);{var ga=v=>{var C=Dl();C.__click=[Ll,e];var ce=o(C);{var ve=ie=>{var ke=N("discard changes and stop editing");_(ie,ke)},ye=ie=>{var ke=N("close level editor");_(ie,ke)};w(ce,ie=>{t(T)?ie(ve):ie(ye,!1)})}i(C),_(v,C)};w(fa,v=>{e.onclose&&a()&&v(ga)})}i(pe),i(ae);var zt=n(ae,2);{var ba=v=>{Ue(v,{onclose:()=>{var C;m(F,!1),(C=t(W))==null||C.focus()},children:(C,ce)=>{var ve=Ol(),ye=n(o(ve),2);pt(ye,{get text(){return t(E)},oncopy:()=>{var le;(le=t(I))==null||le.select()}});var ie=n(ye,2);Xe(ie),Le(ie,le=>m(I,le),()=>t(I));var ke=n(ie,2);ke.__click=[gl,H,E,e,F],i(ve),Y(()=>{ke.disabled=!t(K),X(ke,"title",t(K)?void 0:"data has not changed")}),xe(ie,()=>t(E),le=>m(E,le)),_(C,ve)},$$slots:{default:!0}})};w(zt,v=>{t(F)&&v(ba)})}var qt=n(zt,2);{var ha=v=>{Ue(v,{onclose:()=>{var ce;m(M,!1),(ce=t(me))==null||ce.focus()},children:(ce,ve=At)=>{var ye=Rl(),ie=n(o(ye),2);rl(ie,{get intervals(){return t(h)},oninput:le=>{m(h,le),ve()()},get scale(){return t(O)},set scale(le){m(O,le,!0)},get octaves(){return t(B)},set octaves(le){m(B,le,!0)}});var ke=n(ie,2);ke.__click=function(...le){var Ie;(Ie=ve())==null||Ie.apply(this,le)},i(ye),_(ce,ye)},$$slots:{default:!0}})};w(qt,v=>{t(M)&&v(ha)})}var pa=n(qt,2);{var ya=v=>{Ue(v,{onclose:()=>{var ce;m(L,!1),(ce=t(se))==null||ce.focus()},children:(ce,ve=At)=>{var ye=Nl(),ie=n(o(ye),2);const ke=u(()=>new Set(t(g)));ul(ie,{audio_state:r,get notes(){return t(ke)},get min_note(){return t(b)},get max_note(){return t(j)},oninput:Ie=>{m(g,Ie),ve()()},before_buttons:Ie=>{var et=Cl();et.__click=function(...ka){var It;(It=ve())==null||It.apply(this,ka)},_(Ie,et)},$$slots:{before_buttons:!0}}),i(ye),_(ce,ye)},$$slots:{default:!0}})};w(pa,v=>{t(L)&&v(ya)})}Y((v,C)=>{lt(x,v),he(ta,Pt[t(b)]),he(aa,Pt[t(j)]),lt($e,C),Ve.disabled=a()&&!t(T)||t(fe)},[()=>gt(t(h)),()=>ht(t(g))]),xe(y,()=>t(s),v=>m(s,v)),xe(J,()=>t(z),v=>m(z,v)),xe(oe,()=>t(z),v=>m(z,v)),xe(Ke,()=>t(k),v=>m(k,v)),xe(Ze,()=>t(k),v=>m(k,v)),xe(Oe,()=>t(b),v=>m(b,v)),xe(Fe,()=>t(b),v=>m(b,v)),xe(Re,()=>t(j),v=>m(j,v)),xe(Je,()=>t(j),v=>m(j,v)),Xa(Qe,"clientWidth",v=>m(re,v)),_(l,ge),ue()}Te(["change","click"]);var Jl=(l,e,a)=>e()(a.project.id),Vl=p('<button type="button"> </button>'),Hl=(l,e,a,r,c)=>{var s,f;return t(e)?(s=a())==null?void 0:s(r.project.id):(f=c())==null?void 0:f(r.project_data??r.load(r.project.id))},Ul=p('<button type="button"><!></button>'),Wl=(l,e)=>m(e,!t(e)),Gl=p('<button type="button" class="icon_button plain_button size_xl svelte-12y7az0"><!></button>'),Xl=p("<li><!>  <!> <!></li>");function Yl(l,e){de(e,!0);const a=te(e,"select",3,null),r=te(e,"edit",3,null),c=te(e,"remove",3,null);let s=D(!1);var f=Xl();let h;var g=o(f);{var P=q=>{var T=Vl();let F;T.__click=[Jl,a,e];var M=o(T,!0);i(T),Y(L=>{F=Ee(T,1,"flex_1",null,F,L),he(M,e.project.name)},[()=>({selected:e.selected})]),_(q,T)};w(g,q=>{a()&&q(P)})}var z=n(g,2);{var k=q=>{var T=Ul();let F;T.__click=[Hl,s,c,e,r];var M=o(T);{var L=E=>{var K=N("✕");_(E,K)},R=E=>{var K=N("✎");_(E,K)};w(M,E=>{t(s)?E(L):E(R,!1)})}i(T),Y(E=>{F=Ee(T,1,"icon_button plain_button size_xl deselectable svelte-12y7az0",null,F,E),X(T,"title",t(s)?"remove project":"edit project")},[()=>({selected:e.selected&&!t(s)&&e.editing,color_c:t(s)})]),_(q,T)};w(z,q=>{(t(s)&&c()||!t(s)&&r())&&q(k)})}var b=n(z,2);{var j=q=>{var T=Gl();T.__click=[Wl,s];var F=o(T);{var M=R=>{var E=N("×");_(R,E)},L=R=>{var E=N("✕");_(R,E)};w(F,R=>{t(s)?R(M):R(L,!1)})}i(T),Y(()=>X(T,"title",t(s)?"cancel removing":"remove project")),_(q,T)};w(b,q=>{c()&&q(j)})}i(f),Y(q=>h=Ee(f,1,"project_item svelte-12y7az0",null,h,q),[()=>({selected:e.selected})]),we(3,f,()=>je),_(l,f),ue()}Te(["click"]);var Kl=p('<menu class="unstyled width_sm mb_0"></menu>');function Zl(l,e){de(e,!0);const a=te(e,"selected_project_id",3,null),r=te(e,"editing_project_id",3,null),c=te(e,"projects",19,()=>[]),s=te(e,"project_datas",19,()=>[]);var f=Kl();Be(f,21,c,h=>h.id,(h,g)=>{const P=u(()=>s().find(b=>b.id===t(g).id)),z=u(()=>t(g).id===a()),k=u(()=>t(g).id===r());Yl(h,{get project(){return t(g)},get project_data(){return t(P)},get load(){return e.load_project},get select(){return e.select_project},get edit(){return e.edit_project},get remove(){return e.remove_project},get selected(){return t(z)},get editing(){return t(k)}})}),i(f),_(l,f),ue()}var Ql=(l,e,a,r)=>{t(e)?a().editing_project=!1:t(r)(it.parse({}))},$l=p('<div class="panel p_md"><header><h2 class="my_0">projects</h2></header> <!> <button type="button">create a new project</button></div>');function er(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().load_project),c=u(()=>a().select_project),s=u(()=>a().edit_project),f=u(()=>a().remove_project),h=u(()=>a().editing_project&&a().selected_project_id!==a().editing_project_id),g=u(()=>a().app_data),P=u(()=>t(g).projects);var z=$l(),k=n(o(z),2);const b=u(()=>a().editing_project?a().editing_project_id:null);Zl(k,{get selected_project_id(){return a().selected_project_id},get editing_project_id(){return t(b)},get projects(){return t(P)},get project_datas(){return a().project_datas},get load_project(){return t(r)},get select_project(){return t(c)},edit_project:T=>t(s)(T===a().editing_project_data&&a().editing_project?null:T),get remove_project(){return t(f)}});var j=n(k,2);let q;j.__click=[Ql,h,a,s],i(z),Y(T=>q=Ee(j,1,"w_100 mt_md deselectable",null,q,T),[()=>({selected:t(h)})]),_(l,z),ue()}Te(["click"]);var tr=(l,e)=>e.toggle(),ar=p(`<aside>devices with smaller screens aren't well supported yet, see <a href="https://github.com/ryanatkn/earbetter/issues/2">issue #2</a></aside> <table><tbody><tr><td class="svelte-1gwge1y"><code>Spacebar</code></td><td class="svelte-1gwge1y">replay trial</td></tr><tr><td class="svelte-1gwge1y"><code>r</code></td><td class="svelte-1gwge1y">restart level</td></tr><tr><td class="svelte-1gwge1y"><code>Escape</code></td><td class="svelte-1gwge1y"><button type="button" class="inline">toggle main menu</button></td></tr><tr><td class="svelte-1gwge1y"><code>1 to 4</code></td><td class="svelte-1gwge1y">set instrument</td></tr><tr><td class="svelte-1gwge1y"><code>c</code></td><td class="svelte-1gwge1y">connect MIDI</td></tr><tr><td class="svelte-1gwge1y"><code>up/down arrows</code></td><td class="svelte-1gwge1y">adjust volume</td></tr></tbody></table>`,1);function lr(l,e){de(e,!0);const a=Ma.get();var r=ar(),c=n(ze(r),2),s=o(c),f=n(o(s),2),h=n(o(f)),g=o(h);g.__click=[tr,a],Zt(g,"",{},{"min-width":"172px"}),i(h),i(f),Ce(3),i(s),i(c),_(l,r),ue()}Te(["click"]);var rr=p('<div class="realm_stats_summary svelte-1mwdoug" title="you performed flawlessly in every level of this realm!">★</div>');function nr(l,e){de(e,!0);const a=u(()=>e.realm_data.levels.map(k=>e.level_stats.mistakes[k.id]??[])),r=u(()=>t(a).reduce((k,b)=>k+b.length,0)),c=u(()=>Ut*t(a).length),s=u(()=>!!t(r)&&t(r)>=t(c)),f=u(()=>t(s)?t(a).reduce((k,b)=>k+b.reduce((j,q)=>j+q,0),0):void 0),h=u(()=>t(f)===0);var g=Dt(),P=ze(g);{var z=k=>{var b=rr();_(k,b)};w(P,k=>{t(h)&&k(z)})}_(l,g),ue()}var ir=(l,e,a)=>e()(a.realm_data.id),sr=p('<button type="button"> </button>'),or=(l,e,a,r,c)=>{var s,f;return t(e)?(s=a())==null?void 0:s(r.realm_data.id):(f=c())==null?void 0:f(r.realm_data)},_r=p('<button type="button"><!></button>'),cr=(l,e)=>m(e,!t(e)),vr=p('<button type="button" class="icon_button plain_button size_xl svelte-1joa4ch"><!></button>'),dr=p("<li><!> <!>  <!> <!></li>");function ur(l,e){de(e,!0);const a=te(e,"select",3,null),r=te(e,"edit",3,null),c=te(e,"remove",3,null);let s=D(!1);const f=u(()=>e.project_data.level_stats);var h=dr();let g;var P=o(h);{var z=M=>{nr(M,{get realm_data(){return e.realm_data},get level_stats(){return t(f)}})};w(P,M=>{t(f)&&M(z)})}var k=n(P,2);{var b=M=>{var L=sr();let R;L.__click=[ir,a,e];var E=o(L,!0);i(L),Y(K=>{R=Ee(L,1,"realm_button svelte-1joa4ch",null,R,K),he(E,e.realm_data.name)},[()=>({selected:e.selected})]),_(M,L)};w(k,M=>{a()&&M(b)})}var j=n(k,2);{var q=M=>{var L=_r();let R;L.__click=[or,s,c,e,r];var E=o(L);{var K=I=>{var W=N("✕");_(I,W)},H=I=>{var W=N("✎");_(I,W)};w(E,I=>{t(s)?I(K):I(H,!1)})}i(L),Y(I=>{R=Ee(L,1,"icon_button plain_button size_xl deselectable svelte-1joa4ch",null,R,I),X(L,"title",t(s)?"remove realm":e.editing?"stop editing realm":"edit realm")},[()=>({selected:e.selected&&!t(s)&&e.editing,color_c:t(s)})]),_(M,L)};w(j,M=>{(t(s)&&c()||!t(s)&&r())&&M(q)})}var T=n(j,2);{var F=M=>{var L=vr();L.__click=[cr,s];var R=o(L);{var E=H=>{var I=N("×");_(H,I)},K=H=>{var I=N("✕");_(H,I)};w(R,H=>{t(s)?H(E):H(K,!1)})}i(L),Y(()=>X(L,"title",t(s)?"cancel removing":"remove realm")),_(M,L)};w(T,M=>{c()&&M(F)})}i(h),Y(M=>g=Ee(h,1,"realm_item svelte-1joa4ch",null,g,M),[()=>({selected:e.selected})]),we(3,h,()=>je),_(l,h),ue()}Te(["click"]);var mr=p('<menu class="unstyled width_sm mb_0"></menu>');function fr(l,e){de(e,!0);const a=te(e,"selected_realm_data",3,null),r=te(e,"editing_realm_id",3,null),c=te(e,"realms",19,()=>[]),s=u(()=>new Map(c().map(g=>[g.id,g]))),f=g=>t(s).get(g);var h=mr();Be(h,21,c,g=>g.id,(g,P)=>{const z=u(()=>f(t(P).id)),k=u(()=>{var j;return t(P).id===((j=a())==null?void 0:j.id)}),b=u(()=>t(P).id===r());ur(g,{get realm_data(){return t(z)},get project_data(){return e.project_data},get select(){return e.select_realm},get edit(){return e.edit_realm},get remove(){return e.remove_realm},get selected(){return t(k)},get editing(){return t(b)}})}),i(h),_(l,h),ue()}const gr=(l,e,a,r,c)=>{var s;t(e)?(s=document.querySelector(".realm_def_form input"))==null||s.focus():t(a)?r().editing_realm=!1:t(c)(st.parse({}))};var br=p("<div><!></div>"),hr=p('<div class="panel p_md"><header><h2 class="my_0">realms</h2></header> <!> <button type="button">create a new realm</button></div>');function pr(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().select_realm),c=u(()=>a().edit_realm),s=u(()=>a().remove_realm),f=u(()=>{var j;return a().editing_realm&&!!a().editing_realm_data&&((j=a().selected_realm_data)==null?void 0:j.id)!==a().editing_realm_data.id}),h=u(()=>{var j;return!((j=a().realms)!=null&&j.length)});var g=hr(),P=n(o(g),2);{var z=j=>{var q=br(),T=o(q);const F=u(()=>a().editing_realm?a().editing_realm_id:null);fr(T,{get project_data(){return a().selected_project_data},get selected_realm_data(){return a().selected_realm_data},get realms(){return a().realms},get editing_realm_id(){return t(F)},get select_realm(){return t(r)},edit_realm:M=>t(c)(M===a().editing_realm_data&&a().editing_realm?null:M),get remove_realm(){return t(s)}}),i(q),we(3,q,()=>je),_(j,q)};w(P,j=>{a().realms&&a().selected_project_data&&j(z)})}var k=n(P,2);let b;k.__click=[gr,h,f,a,c],i(g),Y(j=>b=Ee(k,1,Ga(t(h)?void 0:"deselectable"),"svelte-100yq62",b,j),[()=>({selected:t(f)||t(h)})]),_(l,g),ue()}Te(["click"]);const yr=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Fa());const f=st.parse(s);r.onsubmit(f)}catch(s){console.error("failed to import data",s),m(e,s.message||"unknown error",!0)}m(c,!1)},kr=(l,e,a,r,c)=>{m(e,m(a,JSON.stringify(r()),!0),!0),m(c,!0)};var xr=p('<div class="importing pane shadow_d_xl p_xl width_md mx_auto svelte-1g446ss"><h2 class="my_0">import realm data</h2> <!> <textarea class="svelte-1g446ss"></textarea> <button type="button" class="svelte-1g446ss">import realm data</button></div>'),wr=(l,e,a)=>{l.key==="Enter"&&(Gt(l),e.onsubmit(a()))},jr=(l,e,a)=>e.onsubmit(a()),zr=(l,e)=>m(e,!t(e)),qr=(l,e,a)=>{m(e,!1),a.onremove(a.realm_data.id)},Ir=p('<div class="pb_md"><button type="button" class="color_c w_100 svelte-1g446ss">✕ confirm remove</button></div>'),Sr=(l,e)=>e.onduplicate(e.realm_data.id),Tr=p('<button type="button" class="svelte-1g446ss">duplicate realm</button>'),Ar=p('<button type="button" class="svelte-1g446ss">remove realm</button> <!> <!>',1),Pr=(l,e)=>m(e,!t(e)),Mr=(l,e,a)=>{m(e,!1),a.onsubmit(Wt().realms)},Er=p('<div><button type="button" class="w_100 svelte-1g446ss"> </button></div>'),Lr=p('<button type="button" class="svelte-1g446ss">create default realms</button> <!>',1),Dr=p("<pre> </pre>"),Or=p('<div class="message-wrapper svelte-1g446ss"><!></div>'),Rr=(l,e)=>e.onclose(e.realm_data.id),Cr=p('<button class="w_100 svelte-1g446ss" type="button"><!></button>'),Nr=p('<!> <form class="realm_def_form"><header><h2 class="my_0"><!></h2></header> <fieldset><label><div class="title">name</div> <input></label></fieldset> <button type="button" class="accent svelte-1g446ss"><!></button> <!> <button type="button" class="svelte-1g446ss"><!></button> <!> <!> <!></form>',1);function Br(l,e){de(e,!0);const a=te(e,"editing",3,!1);let r=D(!1),c=D(Me(e.realm_data.name));const s=u(()=>{var x;return(x=t(c))==null?void 0:x.trim()}),f=()=>st.parse({id:e.realm_data.id,name:t(s),levels:e.realm_data.levels});Ne(()=>{console.log("set_realm_data",e.realm_data),m(c,e.realm_data.name,!0)});const h=u(()=>t(s)!==e.realm_data.name);let g=D(!1),P=D(""),z=D("");const k=u(()=>t(P)!==t(z));let b=D("");Ne(()=>{e.realm_data,m(b,"")});let j=D(void 0),q=D(void 0);const T=Wt().realms;let F=D(!1);var M=Nr(),L=ze(M);{var R=x=>{Ue(x,{onclose:()=>{var S;m(g,!1),(S=t(q))==null||S.focus()},children:(S,Q)=>{var V=xr(),G=n(o(V),2);pt(G,{get text(){return t(z)},oncopy:()=>{var ne;(ne=t(j))==null||ne.select()}});var J=n(G,2);Xe(J),Le(J,ne=>m(j,ne),()=>t(j));var oe=n(J,2);oe.__click=[yr,b,z,e,g],i(V),Y(()=>{oe.disabled=!t(k),X(oe,"title",t(k)?void 0:"data has not changed")}),xe(J,()=>t(z),ne=>m(z,ne)),_(S,V)},$$slots:{default:!0}})};w(L,x=>{t(g)&&x(R)})}var E=n(L,2),K=o(E),H=o(K),I=o(H);{var W=x=>{var S=N("editing realm");_(x,S)},me=x=>{var S=N("create a new realm");_(x,S)};w(I,x=>{a()?x(W):x(me,!1)})}i(H),i(K);var se=n(K,2),_e=o(se),O=n(o(_e),2);Se(O),O.__keydown=[wr,e,f],i(_e),i(se);var B=n(se,2);B.__click=[jr,e,f];var re=o(B);{var fe=x=>{var S=N("save changes to realm");_(x,S)},ge=x=>{var S=N("create realm");_(x,S)};w(re,x=>{a()?x(fe):x(ge,!1)})}i(B);var ae=n(B,2);{var ee=x=>{var S=Ar(),Q=ze(S);Q.__click=[zr,r];var V=n(Q,2);{var G=ne=>{var Pe=Ir(),Ye=o(Pe);Ye.__click=[qr,r,e],i(Pe),we(3,Pe,()=>je),_(ne,Pe)};w(V,ne=>{t(r)&&ne(G)})}var J=n(V,2);{var oe=ne=>{var Pe=Tr();Pe.__click=[Sr,e],_(ne,Pe)};w(J,ne=>{e.onduplicate&&ne(oe)})}_(x,S)};w(ae,x=>{e.onremove&&a()&&x(ee)})}var U=n(ae,2);U.__click=[kr,P,z,f,g];var be=o(U);{var qe=x=>{var S=N("import/export data");_(x,S)},Ae=x=>{var S=N("import data");_(x,S)};w(be,x=>{a()?x(qe):x(Ae,!1)})}i(U),Le(U,x=>m(q,x),()=>t(q));var pe=n(U,2);{var A=x=>{var S=Lr(),Q=ze(S);Q.__click=[Pr,F];var V=n(Q,2);{var G=J=>{var oe=Er(),ne=o(oe);ne.__click=[Mr,F,e];var Pe=o(ne);i(ne),i(oe),Y(()=>he(Pe,`create ${T.length??""} new realms`)),we(3,oe,()=>je),_(J,oe)};w(V,J=>{t(F)&&J(G)})}_(x,S)};w(pe,x=>{a()||x(A)})}var d=n(pe,2);{var y=x=>{var S=Or(),Q=o(S);rt(Q,{status:"error",children:(V,G)=>{var J=Dr(),oe=o(J,!0);i(J),Y(()=>he(oe,t(b))),_(V,J)},$$slots:{default:!0}}),i(S),_(x,S)};w(d,x=>{t(b)&&x(y)})}var Z=n(d,2);{var $=x=>{var S=Cr();S.__click=[Rr,e];var Q=o(S);{var V=J=>{var oe=N("discard changes");_(J,oe)},G=J=>{var oe=N("close realm editor");_(J,oe)};w(Q,J=>{t(h)?J(V):J(G,!1)})}i(S),_(x,S)};w(Z,x=>{e.onclose&&a()&&x($)})}i(E),Y(()=>B.disabled=a()&&!t(h)),xe(O,()=>t(c),x=>m(c,x)),_(l,M),ue()}Te(["click","keydown"]);var Fr=p('<div class="panel p_md"><!></div>');function Jr(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().remove_realm),c=u(()=>a().duplicate_realm),s=u(()=>a().update_realm),f=u(()=>a().create_realm),h=u(()=>a().editing_realm_data??st.parse({})),g=u(()=>a().realms?a().realms.some(b=>b.id===t(h).id):!1),P=(b,j)=>{var q;(q=a().realms)!=null&&q.some(T=>T.id===b.id)?t(s)(b):t(f)(b,j)};var z=Fr(),k=o(z);Br(k,{get editing(){return t(g)},get realm_data(){return t(h)},onsubmit:b=>{if(Array.isArray(b))for(let j=0;j<b.length;j++)P(b[j],j===0);else P(b,!0)},onremove:b=>t(r)(b),onduplicate:b=>t(c)(b),onclose:()=>a().editing_realm=!1}),i(z),_(l,z),ue()}var Vr=(l,e)=>e.app.play_level(e.level_data.id),Hr=async(l,e,a,r)=>{if(t(e))a.app.remove_level(a.level_data.id);else{const c=!t(r);if(a.app.edit_level(c?a.level_data:null),c){await Ot();const s=document.querySelector(".level_def_form");s==null||s.scrollIntoView({behavior:"smooth",block:"center"})}}},Ur=(l,e)=>m(e,!t(e)),Wr=p('<li><!> <button type="button" title="play this level"> </button> <button type="button"><!></button> <button type="button" class="icon_button plain_button size_xl svelte-170pvnv"><!></button></li>');function Gr(l,e){de(e,!0);const a=u(()=>e.app.draft_level_data===e.level_data),r=u(()=>e.app.editing_level&&t(a)),c=u(()=>{var I;return(I=e.app.selected_project_data)==null?void 0:I.level_stats});let s=D(!1);const f=u(()=>t(r)||t(a));var h=Wr();let g;var P=o(h);{var z=I=>{Ka(I,{get level_data(){return e.level_data},get level_stats(){return t(c)}})};w(P,I=>{t(c)&&I(z)})}var k=n(P,2);let b;k.__click=[Vr,e];var j=o(k,!0);i(k);var q=n(k,2);let T;q.__click=[Hr,s,e,r];var F=o(q);{var M=I=>{var W=N("✕");_(I,W)},L=I=>{var W=N("✎");_(I,W)};w(F,I=>{t(s)?I(M):I(L,!1)})}i(q);var R=n(q,2);R.__click=[Ur,s];var E=o(R);{var K=I=>{var W=N("×");_(I,W)},H=I=>{var W=N("✕");_(I,W)};w(E,I=>{t(s)?I(K):I(H,!1)})}i(R),i(h),Y((I,W,me)=>{g=Ee(h,1,"level_map_item svelte-170pvnv",null,g,I),b=Ee(k,1,"level_button deselectable svelte-170pvnv",null,b,W),he(j,e.level_data.name),T=Ee(q,1,"icon_button plain_button size_xl svelte-170pvnv",null,T,me),X(q,"title",t(s)?"remove level":t(r)?"stop editing level":"edit level"),X(R,"title",t(s)?"cancel removing":"remove level")},[()=>({selected:t(f)}),()=>({selected:t(f)}),()=>({selected:!t(s)&&t(r),color_c:t(s)})]),we(3,h,()=>je),_(l,h),ue()}Te(["click"]);const Xr=(l,e,a,r)=>{var c;t(e)?(c=document.querySelector(".level_def_form input"))==null||c.focus():a.app.edit_level(t(r)?null:nt.parse({}))};var Yr=p('<div class="panel p_md"><header><h2 class="my_0">levels</h2> <h3 class="my_0"> </h3></header> <menu class="levels unstyled mb_0 svelte-wmjxbn"></menu> <button type="button">create a new level</button></div>');function Kr(l,e){de(e,!0);const a=u(()=>e.app.editing_level&&!e.levels.some(k=>k===e.app.draft_level_data)),r=u(()=>!e.levels.length);var c=Yr(),s=o(c),f=n(o(s),2),h=o(f,!0);i(f),i(s);var g=n(s,2);Be(g,21,()=>e.levels,k=>k.id,(k,b)=>{Gr(k,{get app(){return e.app},get level_data(){return t(b)}})}),i(g);var P=n(g,2);P.__click=[Xr,r,e,a];let z;i(c),Y(k=>{var b;he(h,(b=e.app.selected_realm_data)==null?void 0:b.name),z=Ee(P,1,"svelte-wmjxbn",null,z,k)},[()=>({selected:t(a)||t(r),deselectable:!t(r)})]),_(l,c),ue()}Te(["click"]);const Zr=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Ja());const f=it.parse(s);r.onsubmit(f)}catch(s){console.error("failed to import data",s),m(e,s.message||"unknown error",!0)}m(c,!1)},Qr=(l,e,a,r,c)=>{m(e,m(a,JSON.stringify(r()),!0),!0),m(c,!0)};var $r=p('<div class="importing pane shadow_d_xl p_xl width_md mx_auto svelte-l3tcx7"><h2 class="my_0">import project data</h2> <!> <textarea class="svelte-l3tcx7"></textarea> <button type="button" class="svelte-l3tcx7">import project data</button></div>'),en=(l,e,a)=>{l.key==="Enter"&&(Gt(l),e.onsubmit(a()))},tn=(l,e,a)=>e.onsubmit(a()),an=(l,e)=>m(e,!t(e)),ln=(l,e,a)=>{m(e,!1),a.onremove(a.project_data.id)},rn=p('<div class="pb_md"><button type="button" class="color_c w_100 svelte-l3tcx7">✕ confirm remove</button></div>'),nn=(l,e)=>e.onduplicate(e.project_data.id),sn=p('<button type="button" class="w_100 svelte-l3tcx7">duplicate project</button>'),on=p('<button class="w_100 svelte-l3tcx7" type="button">remove project</button> <!> <!>',1),_n=p("<pre> </pre>"),cn=p('<div class="overflow_x_auto"><!></div>'),vn=(l,e)=>e.onclose(e.project_data.id),dn=p('<button type="button" class="w_100 svelte-l3tcx7"><!></button>'),un=p('<!> <form><header><h2 class="my_0"><!></h2></header> <fieldset><label><div class="title">name</div> <input></label></fieldset> <button type="button" class="accent w_100 svelte-l3tcx7"><!></button> <!> <button type="button" class="w_100 svelte-l3tcx7"><!></button> <!> <!></form>',1);function mn(l,e){de(e,!0);const a=te(e,"editing",3,!1);let r=D(!1),c=D(Me(e.project_data.name));const s=u(()=>t(c).trim()),f=()=>it.parse({id:e.project_data.id,name:t(s),realms:e.project_data.realms,level_stats:e.project_data.level_stats});Ne(()=>{console.log("set_project_data",e.project_data),m(c,e.project_data.name,!0)});const h=u(()=>t(s)!==e.project_data.name);let g=D(!1),P=D(""),z=D("");const k=u(()=>t(P)!==t(z));let b=D("");Ne(()=>{e.project_data,m(b,"")});let j=D(void 0),q=D(void 0);var T=un(),F=ze(T);{var M=d=>{Ue(d,{onclose:()=>{var y;m(g,!1),(y=t(q))==null||y.focus()},children:(y,Z)=>{var $=$r(),x=n(o($),2);pt(x,{get text(){return t(z)},oncopy:()=>{var V;(V=t(j))==null||V.select()}});var S=n(x,2);Xe(S),Le(S,V=>m(j,V),()=>t(j));var Q=n(S,2);Q.__click=[Zr,b,z,e,g],i($),Y(()=>{Q.disabled=!t(k),X(Q,"title",t(k)?void 0:"data has not changed")}),xe(S,()=>t(z),V=>m(z,V)),_(y,$)},$$slots:{default:!0}})};w(F,d=>{t(g)&&d(M)})}var L=n(F,2),R=o(L),E=o(R),K=o(E);{var H=d=>{var y=N("editing project");_(d,y)},I=d=>{var y=N("create a new project");_(d,y)};w(K,d=>{a()?d(H):d(I,!1)})}i(E),i(R);var W=n(R,2),me=o(W),se=n(o(me),2);Se(se),se.__keydown=[en,e,f],i(me),i(W);var _e=n(W,2);_e.__click=[tn,e,f];var O=o(_e);{var B=d=>{var y=N("save changes to project");_(d,y)},re=d=>{var y=N("create project");_(d,y)};w(O,d=>{a()?d(B):d(re,!1)})}i(_e);var fe=n(_e,2);{var ge=d=>{var y=on(),Z=ze(y);Z.__click=[an,r];var $=n(Z,2);{var x=V=>{var G=rn(),J=o(G);J.__click=[ln,r,e],i(G),we(3,G,()=>je),_(V,G)};w($,V=>{t(r)&&V(x)})}var S=n($,2);{var Q=V=>{var G=sn();G.__click=[nn,e],_(V,G)};w(S,V=>{e.onduplicate&&V(Q)})}_(d,y)};w(fe,d=>{e.onremove&&a()&&d(ge)})}var ae=n(fe,2);ae.__click=[Qr,P,z,f,g];var ee=o(ae);{var U=d=>{var y=N("import/export data");_(d,y)},be=d=>{var y=N("import data");_(d,y)};w(ee,d=>{a()?d(U):d(be,!1)})}i(ae),Le(ae,d=>m(q,d),()=>t(q));var qe=n(ae,2);{var Ae=d=>{var y=cn(),Z=o(y);rt(Z,{status:"error",children:($,x)=>{var S=_n(),Q=o(S,!0);i(S),Y(()=>he(Q,t(b))),_($,S)},$$slots:{default:!0}}),i(y),_(d,y)};w(qe,d=>{t(b)&&d(Ae)})}var pe=n(qe,2);{var A=d=>{var y=dn();y.__click=[vn,e];var Z=o(y);{var $=S=>{var Q=N("discard changes and stop editing");_(S,Q)},x=S=>{var Q=N("close project editor");_(S,Q)};w(Z,S=>{t(h)?S($):S(x,!1)})}i(y),_(d,y)};w(pe,d=>{e.onclose&&a()&&d(A)})}i(L),Y(()=>_e.disabled=a()&&!t(h)),xe(se,()=>t(c),d=>m(c,d)),_(l,T),ue()}Te(["click","keydown"]);var fn=p('<div class="panel p_md"><!></div>');function gn(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().remove_project),c=u(()=>a().duplicate_project),s=u(()=>a().update_project),f=u(()=>a().create_project),h=u(()=>a().editing_project_data??it.parse({})),g=u(()=>a().project_datas.some(b=>b.id===t(h).id));var P=fn(),z=o(P);const k=u(()=>t(g)?t(s):t(f));mn(z,{get editing(){return t(g)},get project_data(){return t(h)},get onsubmit(){return t(k)},get onremove(){return t(r)},get onduplicate(){return t(c)},onclose:()=>a().editing_project=!1}),i(P),_(l,P),ue()}var bn=p('<section class="card svelte-8muejm"><!></section>'),hn=p('<section class="card svelte-8muejm"><!></section>'),pn=p('<div class="width_sm svelte-8muejm"><!>  <!> <section class="card svelte-8muejm"><div class="panel p_md"><header><h2 class="my_0">controls</h2></header> <!> <div class="mb_lg"><!></div> <!> <aside>Earbetter supports MIDI devices like piano keyboards, connect and click:</aside> <!></div></section></div>'),yn=(l,e)=>t(e)(),kn=p(`<section class="card svelte-8muejm"><div class="panel p_md"><p>Earbetter is an <a href="https://wikipedia.org/wiki/Ear_training">ear training</a> tool:</p> <ul><li>each level is a standalone challenge that's a series of trials</li> <li></li> <li>realms group levels into bigger challenges</li> <li>projects group realms so you can customize various experiences</li> <li>levels can be shared via their links or exporting/importing data</li></ul> <p>See also the 3 minute <a href="https://www.youtube.com/watch?v=zW2zI1A_Ikw">video intro on YouTube</a> and <a href="https://github.com/ryanatkn/earbetter">the readme</a>.</p> <aside>Earbetter is in early development, and many things are unfinished and unknown - feedback
						is appreciated on <a href="https://github.com/ryanatkn/earbetter">the GitHub discussions and issues</a>.</aside> <div class="box row"><button type="button" class="m_0">ok, hide this</button></div></div></section>`),xn=p('<section class="card svelte-8muejm"><!></section>'),wn=p('<section class="card svelte-8muejm"><!></section>'),jn=p('<section class="card svelte-8muejm"><div class="panel p_md"><!></div></section>'),zn=p('<div class="width_sm svelte-8muejm"><!>  <!></div>'),qn=p('<!> <div class="map svelte-8muejm"><!> <div class="width_sm svelte-8muejm"><!> <section class="card svelte-8muejm"><!></section>  <!></div> <!></div>',1);function In(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().toggle_trainer_help),c=u(()=>a().play_level),s=u(()=>a().edit_level),f=u(()=>a().remove_level),h=u(()=>a().duplicate_level),g=u(()=>a().create_level),P=u(()=>a().update_level),z=Bt.get();window.ac=z;const k=u(()=>a().draft_level_data??nt.parse({})),b=u(()=>a().levels?a().levels.some(O=>O.id===t(k).id):!1),j=u(()=>{var O;return!((O=a().realms)!=null&&O.length)});var q=qn(),T=ze(q);$t(T,{get midi_access(){return a().midi_access},onnotestart:(O,B)=>{Jt(a(),z(),O,Vt(a().volume,B),a().instrument)},onnotestop:O=>{bt(O)}});var F=n(T,2),M=o(F);{var L=O=>{var B=pn(),re=o(B);{var fe=d=>{var y=bn(),Z=o(y);er(Z,{get app(){return a()}}),i(y),we(3,y,()=>je),_(d,y)};w(re,d=>{a().selected_project_data&&d(fe)})}var ge=n(re,2);{var ae=d=>{var y=hn(),Z=o(y);gn(Z,{get app(){return a()}}),i(y),we(3,y,()=>je),_(d,y)};w(ge,d=>{(a().editing_project&&a().editing_project_data||!a().selected_project_data)&&d(ae)})}var ee=n(ge,2),U=o(ee),be=n(o(U),2);lr(be,{});var qe=n(be,2),Ae=o(qe);Yt(Ae,{get volume(){return a().volume},set volume(d){a().volume=d}}),i(qe);var pe=n(qe,2);Xt(pe,{get instrument(){return a().instrument},set instrument(d){a().instrument=d}});var A=n(pe,4);Kt(A,{get midi_state(){return a()}}),i(U),i(ee),i(B),we(3,ee,()=>je),_(O,B)};w(M,O=>{a().project_datas.length&&O(L)})}var R=n(M,2),E=o(R);{var K=O=>{var B=kn(),re=o(B),fe=n(o(re),2),ge=n(o(fe),2);ge.textContent=`your level score is the sum of mistakes in your best ${Ut}
							runs, win a ★ at 0`,Ce(6),i(fe);var ae=n(fe,6),ee=o(ae);ee.__click=[yn,r],i(ae),i(re),i(B),we(3,B,()=>je),_(O,B)};w(E,O=>{a().show_trainer_help&&O(K)})}var H=n(E,2),I=o(H);pr(I,{get app(){return a()}}),i(H);var W=n(H,2);{var me=O=>{var B=xn(),re=o(B);Jr(re,{get app(){return a()}}),i(B),we(3,B,()=>je),_(O,B)};w(W,O=>{(a().editing_realm&&a().editing_realm_data||t(j))&&O(me)})}i(R);var se=n(R,2);{var _e=O=>{var B=zn(),re=o(B);{var fe=ee=>{var U=wn(),be=o(U);Kr(be,{get app(){return a()},get levels(){return a().levels}}),i(U),we(3,U,()=>je),_(ee,U)};w(re,ee=>{a().levels&&ee(fe)})}var ge=n(re,2);{var ae=ee=>{var U=jn(),be=o(U),qe=o(be);const Ae=u(()=>t(b)?t(P):t(g));Fl(qe,{get editing(){return t(b)},get level_data(){return t(k)},get onsubmit(){return t(Ae)},get onremove(){return t(f)},get onduplicate(){return t(h)},onplay:async(pe,A)=>{A&&t(P)(pe),await t(c)(pe.id)},onclose:()=>t(s)(null)}),i(be),i(U),we(2,U,()=>je),_(ee,U)};w(ge,ee=>{var U;a().selected_realm_id&&(a().editing_level&&a().levels||((U=a().levels)==null?void 0:U.length)===0)&&ee(ae)})}i(B),_(O,B)};w(se,O=>{a().project_datas.length&&O(_e)})}i(F),_(l,q),ue()}Te(["click"]);var Sn=p('<main><!> <!> <!> <div class="box"><!></div></main>');function Hn(l,e){de(e,!0);const a=Ht.get();var r=Sn();wa(P=>{Sa.title="Earbetter trainer"});var c=o(r);Ya(c,{onclick:()=>Ta(Aa+"/")});var s=n(c,2);Pa(s);var f=n(s,2);In(f,{app:a});var h=n(f,2),g=o(h);Ea(g,{}),i(h),i(r),_(l,r),ue()}export{Hn as component};
