var St=(l,e,a)=>{if(!e.has(l))throw TypeError("Cannot "+a)};var ut=(l,e,a)=>(St(l,e,"read from private field"),a?a.call(l):e.get(l)),mt=(l,e,a)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,a)},ft=(l,e,a,r)=>(St(l,e,"write to private field"),r?r.call(l,a):e.set(l,a),a);import{h as Pe,z as Ge,b as he,a as _,t as y,A as ka,e as D,d as Mt,i as xa}from"../chunks/disclose-version.DbIX9lBU.js";import{aN as wa,g as t,b as ja,u as za,a5 as Dt,i as qa,a as de,_ as E,f as Ie,c as o,r as i,s as n,t as V,p as ve,k as m,d as v,Y as Ce,n as Ne,an as At,a0 as Ia}from"../chunks/index-client.BoISVktJ.js";import{g as Sa,b as Aa}from"../chunks/entry.DDeV_Nys.js";import{H as Ta}from"../chunks/Header.CTrxAHR8.js";import{m as Pa,F as La}from"../chunks/Footer.EehJhk4e.js";import{R as Ea,K as Ot,T as gt,d as Rt,l as Ma,U as Nt,W as Da,L as Oa,j as Ct,k as bt,e as Ra,X as ht,Y as Ft,o as Bt,w as Ht,Z as Na,f as Jt,a as tt,b as at,m as Tt,_ as nt,$ as Ca,t as ze,c as qe,a0 as it,M as Vt,a1 as st,a2 as Ut,s as Wt,a3 as Fa,a4 as Ba}from"../chunks/index.DY9TdQ-H.js";import{p as ee,a as F,i as w}from"../chunks/props.Dc3VY8m1.js";import{i as Ha,s as Ja,b as je,I as Yt,V as Gt,c as Kt,a as Va}from"../chunks/Init_Midi_Button.CjFsnaTE.js";import{e as Fe,r as Te,s as Y,h as lt,b as Xt,c as Zt,p as Ua,t as pe,j as Wa}from"../chunks/string.CP9_p8aN.js";import{M as Qt,P as $t,b as Ya,B as Ga}from"../chunks/Back_Button.DDz4iAF1.js";import{b as Me}from"../chunks/this.Clzg12Qd.js";import{D as Ue}from"../chunks/Dialog.BRCL7cOY.js";import{A as rt}from"../chunks/Alert.IdmVHHLR.js";import{L as Ka}from"../chunks/Level_Stats_Summary.2CzGuVZt.js";function Xa(l){let e=0,a=qa(0),r;return()=>{wa()&&(t(a),ja(()=>(e===0&&(r=za(()=>l(()=>Ea(a)))),e+=1,()=>{Dt().then(()=>{e-=1,e===0&&(r==null||r(),r=void 0)})})))}}var We,Ye;class Za{constructor(e,a){mt(this,We,void 0);mt(this,Ye,void 0);ft(this,We,e),ft(this,Ye,Xa(a))}get current(){return ut(this,Ye).call(this),ut(this,We).call(this)}}We=new WeakMap,Ye=new WeakMap;var Pt=Object.prototype.hasOwnProperty;function Lt(l,e,a){for(a of l.keys())if(De(a,e))return a}function De(l,e){var a,r,c;if(l===e)return!0;if(l&&e&&(a=l.constructor)===e.constructor){if(a===Date)return l.getTime()===e.getTime();if(a===RegExp)return l.toString()===e.toString();if(a===Array){if((r=l.length)===e.length)for(;r--&&De(l[r],e[r]););return r===-1}if(a===Set){if(l.size!==e.size)return!1;for(r of l)if(c=r,c&&typeof c=="object"&&(c=Lt(e,c),!c)||!e.has(c))return!1;return!0}if(a===Map){if(l.size!==e.size)return!1;for(r of l)if(c=r[0],c&&typeof c=="object"&&(c=Lt(e,c),!c)||!De(r[1],e.get(c)))return!1;return!0}if(a===ArrayBuffer)l=new Uint8Array(l),e=new Uint8Array(e);else if(a===DataView){if((r=l.byteLength)===e.byteLength)for(;r--&&l.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(l)){if((r=l.byteLength)===e.byteLength)for(;r--&&l[r]===e[r];);return r===-1}if(!a||typeof l=="object"){r=0;for(a in l)if(Pt.call(l,a)&&++r&&!Pt.call(e,a)||!(a in e)||!De(l[a],e[a]))return!1;return Object.keys(e).length===r}}return l!==l&&e!==e}var Qa=(l,e)=>m(e,F(l.currentTarget.value)),$a=(l,e,a,r,c,s)=>{var g;return(g=e.oninput)==null?void 0:g.call(e,t(a),t(r)?{scale:c(),octaves:s()}:void 0)},el=(l,e)=>e(Ma(l.currentTarget.value)),tl=y("<option> </option>"),al=y('<small><textarea class="preview width_sm panel svelte-1n8fnqy"></textarea></small> <button type="button" class="accent mb_lg">use these intervals</button> <label><div class="title text_align_center">scale</div> <select></select></label> <label><div class="title text_align_center">octaves</div> <div class="text_align_center"> </div> <input type="range"></label>',1);function ll(l,e){de(e,!0);let a=ee(e,"scale",31,()=>F(Ot)),r=ee(e,"octaves",15,1);const c=v(()=>Da(a(),r())),s=v(()=>gt(t(c))),g=F(gt(e.intervals));let h=E(F(g));const b=v(()=>(t(c),Date.now())),P=v(()=>(e.intervals,t(h),Date.now())),p=v(()=>t(b)>t(P)),z=v(()=>t(p)?t(s):t(h)),f=v(()=>Nt(t(z))),j=v(()=>!De(e.intervals,t(f))),q=v(()=>!!t(f).length);var U=al(),A=Ie(U),L=o(A);Ge(L),L.__input=[Qa,h],i(A);var O=n(A,2);O.__click=[$a,e,f,p,a,r];var B=n(O,2),S=n(o(B),2);Ha(S,()=>a().name);var R;S.__change=[el,a],Fe(S,20,()=>Rt,ie=>ie,(ie,se)=>{var M=tl(),C={},le=o(M,!0);i(M),V(()=>{C!==(C=se.name)&&(M.value=(M.__value=se.name)==null?"":se.name),he(le,se.name)}),_(ie,M)}),i(S),i(B);var X=n(B,2),ue=n(o(X),2),ye=o(ue,!0);i(ue);var fe=n(ue,2);Te(fe),Y(fe,"min",1),Y(fe,"max",6),i(X),V(()=>{lt(L,t(z)),O.disabled=!t(j)||!t(q),R!==(R=a().name)&&(S.value=(S.__value=a().name)==null?"":a().name,Ja(S,a().name)),he(ye,r())}),je(fe,r),_(l,U),ve()}Pe(["input","click","change"]);const Et=new Za(()=>window.innerWidth,l=>ka(window,"resize",l));var rl=(l,e)=>{m(e,F(new Set))},nl=(l,e,a)=>{var r;(r=e.oninput)==null||r.call(e,t(a))},il=y('<!> <button class="mb_lg" type="button">clear selection</button> <button type="button" class="accent">select <!> </button>',1),sl=y("<option> </option>"),ol=(l,e,a)=>e(t(a)),_l=y('<button type="button"> </button>'),cl=(l,e)=>e(l.currentTarget.value),dl=y('<!> <div class="notes_input pt_lg svelte-18obm47"><!> <div class="piano_wrapper svelte-18obm47"><!></div> <section class="box"><label class="mb_lg"><div class="title text_align_center">key</div> <select></select></label> <div class="scales mb_lg svelte-18obm47"></div> <!> <div class="notes width_sm svelte-18obm47"><blockquote class="panel my_lg"><textarea></textarea></blockquote></div></section> <form class="width_sm panel p_md"><fieldset><!> <!></fieldset> <fieldset><!></fieldset></form></div>',1);function vl(l,e){de(e,!0);const a=T=>{var d=il(),k=Ie(d);Zt(k,()=>e.before_buttons);var G=n(k,2);G.__click=[rl,s];var Z=n(G,2);Z.__click=[nl,e,g];var x=n(o(Z));{var I=Q=>{var H=D("all");_(Q,H)},K=Q=>{var H=D();V(()=>he(H,t(b))),_(Q,H)};w(x,Q=>{t(b)===0?Q(I):Q(K,!1)})}var J=n(x);V(()=>he(J,` tonic${Ua(t(b))??""}`)),i(Z),V(()=>{G.disabled=t(b)===0,Z.disabled=!t(f)}),_(T,d)},r=ee(e,"audio_state",7),{playing_notes:c}=r();let s=E(void 0);const g=v(()=>t(s)&&Array.from(t(s)).sort((T,d)=>T-d)),h=v(()=>t(s)??e.notes),b=v(()=>t(h).size),P=v(()=>t(g)&&ht(t(g))),p=T=>{m(s,F(new Set(Ft(T))))},z=v(()=>ht(Array.from(e.notes).sort((T,d)=>T-d))),f=v(()=>!!t(g)&&t(P)!==t(z)),j=T=>{const d=new Set(t(h));d.has(T)?d.delete(T):d.add(T),m(s,F(d))};let q=E(F(Oa));const U=Ct.get(),A=20,L=(T,d=null)=>{Bt(r(),U(),T,Ht(r().volume,d),r().instrument)},O=T=>{const d=Na(T,t(q),e.min_note,e.max_note);if(!t(s)||!t(g)){m(s,F(d));return}let k=!0;for(const Z of d)if(!t(s).has(Z)){k=!1;break}const G=k?t(g).filter(Z=>!d.has(Z)):t(g).concat(Array.from(d));m(s,F(new Set(G)))};var B=dl(),S=Ie(B);Qt(S,{get midi_access(){return r().midi_access},onnotestart:(T,d)=>L(T,d),onnotestop:T=>bt(T)});var R=n(S,2),X=o(R);a(X);var ue=n(X,2);Xt(ue,"padding",`${A}px`);var ye=o(ue);{var fe=T=>{var d=v(()=>Et.current-A*5);$t(T,{get width(){return t(d)},get min_note(){return e.min_note},get max_note(){return e.max_note},max_height:300,pressed_keys:c,get highlighted_keys(){return t(h)},middle_c_label:!0,allow_sticking:!0,onpress:k=>{j(k),L(k)},onrelease:k=>{bt(k)}})};w(ye,T=>{Et.current&&T(fe)})}i(ue);var ie=n(ue,2),se=o(ie),M=n(o(se),2);Fe(M,20,()=>Ra,T=>T,(T,d)=>{var k=sl(),G={},Z=o(k,!0);i(k),V(()=>{G!==(G=d)&&(k.value=(k.__value=d)==null?"":d),he(Z,d)}),_(T,k)}),i(M),i(se);var C=n(se,2);Fe(C,21,()=>Rt,T=>T.name,(T,d)=>{var k=_l();k.__click=[ol,O,d];var G=o(k,!0);i(k),V(()=>he(G,t(d).name)),_(T,k)}),i(C);var le=n(C,2);a(le);var me=n(le,2),ge=o(me),te=o(ge);Ge(te),te.__change=[cl,p],i(ge),i(me),i(ie);var $=n(ie,2),W=o($),be=o(W);Yt(be,{get instrument(){return r().instrument},set instrument(T){r().instrument=T}});var Se=n(be,2);Gt(Se,{get volume(){return r().volume},set volume(T){r().volume=T}}),i(W);var Le=n(W,2),ke=o(Le);Kt(ke,{get midi_state(){return r()}}),i(Le),i($),i(R),V(()=>lt(te,t(P))),Va(M,()=>t(q),T=>m(q,T)),_(l,B),ve()}Pe(["click","change"]);var ul=(l,e)=>{var a;navigator.clipboard.writeText(e.text),(a=e.oncopy)==null||a.call(e)},ml=y('<button type="button" class="my_lg"><!></button>');function pt(l,e){de(e,!0);var a=ml();a.__click=[ul,e];var r=o(a);{var c=g=>{var h=Mt(),b=Ie(h);Zt(b,()=>e.children),_(g,h)},s=g=>{var h=D("copy to clipboard");_(g,h)};w(r,g=>{e.children?g(c):g(s,!1)})}i(a),_(l,a),ve()}Pe(["click"]);const fl=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Ca());const g=nt.parse(s);r.onsubmit(g)}catch(s){console.error("failed to import data",s),m(e,F(s.message||"unknown error"))}m(c,!1)},gl=(l,e,a,r,c)=>{m(e,F(m(a,F(JSON.stringify(r()))))),m(c,!0)};var bl=(l,e)=>m(e,Nt(l.currentTarget.value)),hl=(l,e)=>m(e,!0),pl=y("<!> <br>",1),yl=(l,e)=>m(e,Ft(l.currentTarget.value)),kl=(l,e)=>m(e,!0),xl=(l,e,a)=>e.onsubmit(a()),wl=(l,e)=>m(e,!t(e)),jl=(l,e,a)=>{m(e,!1),a.onremove(a.level_data.id)},zl=y('<div class="pb_md"><button type="button" class="color_c w_100 svelte-h4qokl">âœ• confirm remove</button></div>'),ql=(l,e)=>e.onduplicate(e.level_data.id),Il=y('<button type="button" class="svelte-h4qokl">duplicate level</button>'),Sl=y('<button type="button" class="svelte-h4qokl">remove level</button> <!> <!>',1),Al=y("<pre> </pre>"),Tl=y('<div class="overflow_x_auto"><!></div>'),Pl=(l,e,a,r)=>e.onplay(t(a)?r():e.level_data,t(a)),Ll=y('<button type="button" class="svelte-h4qokl">play!</button>'),El=(l,e)=>e.onclose(e.level_data.id),Ml=y('<button type="button" class="svelte-h4qokl"><!></button>'),Dl=y('<div class="importing bg shadow_d_xl p_xl width_md box svelte-h4qokl"><h2 class="my_0">import level data</h2> <!> <textarea class="svelte-h4qokl"></textarea> <button type="button" class="svelte-h4qokl">import project data</button></div>'),Ol=y('<div class="bg shadow_d_xl p_xl width_md box"><h2 class="my_0">pick intervals</h2> <!> <button type="button" class="svelte-h4qokl">cancel</button></div>'),Rl=y('<button type="button" class="mb_lg svelte-h4qokl">cancel</button>'),Nl=y('<div class="bg shadow_d_xl py_xl box"><h2 class="my_0">pick tonics</h2> <!></div>'),Cl=y(`<form class="level_def_form w_100"><header><h2 class="my_0"><!></h2></header> <div class="fields svelte-h4qokl"><fieldset><label><div class="title">name</div> <input></label></fieldset> <fieldset><label class="mb_0" title="the semitones to include relative to the tonic"><div class="title">intervals</div> <input></label> <button type="button" class="svelte-h4qokl">pick intervals</button> <details><summary>about <code>intervals</code></summary> <p><code>intervals</code> is a comma-separated list of numbers representing the <a href="https://wikipedia.org/wiki/Interval_(music)">musical intervals</a> used in the
					level, aka the number of piano keys (<a href="https://wikipedia.org/wiki/Semitone">semitones</a>) separating each note from the <a href="https://wikipedia.org/wiki/Tonic_(music)">tonic</a> (see below)</p> <p>for example, to practice distinguishing between the <a href="https://wikipedia.org/wiki/Perfect_fourth">perfect fourth</a> and <a href="https://wikipedia.org/wiki/Perfect_fifth">perfect fifth</a>, enter "<code>5, 7</code>"</p> <p>negative numbers are allowed</p></details></fieldset> <fieldset><label title="the number of trials per level"><div class="title">trial count</div> <div class="row"><input class="small_input svelte-h4qokl" type="number"> <input type="range"></div></label></fieldset> <fieldset><label title="the number of notes per trial"><div class="title">sequence length</div> <div class="row"><input class="small_input svelte-h4qokl" type="number"> <input type="range"></div></label></fieldset> <fieldset class="row"><label class="text_align_center"><div class="title">lowest note</div> <div> </div> <input type="number"> <input type="range"></label> <label class="text_align_center"><div class="title">highest note</div> <div> </div> <input type="number"> <input type="range"></label></fieldset> <!> <fieldset><label class="mb_0" title="the possible starting notes for each trial"><div class="title">tonics</div> <input placeholder="all"></label> <button type="button" class="svelte-h4qokl">pick tonics</button> <details><summary>about <code>tonics</code></summary> <p>The <a href="https://wikipedia.org/wiki/Tonic_(music)">tonic</a> is like the "base" or "home"
					note, and for our purposes it's always the first note played in a trial. Other notes in the
					trial are calculated from the tonic and intervals. (see above)</p></details></fieldset> <button type="button" class="accent svelte-h4qokl"><!></button> <!> <button type="button" class="svelte-h4qokl"><!></button> <!> <!> <!></div></form> <!> <!> <!>`,1);function Fl(l,e){de(e,!0);const a=ee(e,"editing",3,!1),r=Jt.get();let c=E(!1),s=E(F(e.level_data.name));const g=v(()=>{var u;return(u=t(s))==null?void 0:u.trim()});let h=E(e.level_data.intervals),b=E(e.level_data.tonics);const P=v(()=>t(b)?t(b).filter(u=>u>=t(f)&&u<=t(j)):t(b));let p=E(F(e.level_data.trial_count)),z=E(F(e.level_data.sequence_length)),f=E(F(e.level_data.min_note)),j=E(F(e.level_data.max_note));const q=()=>nt.parse({id:e.level_data.id,name:t(g),intervals:t(h),tonics:t(P),trial_count:t(p),sequence_length:t(z),min_note:t(f),max_note:t(j)});Ce(()=>{m(s,F(e.level_data.name)),m(h,e.level_data.intervals),m(b,e.level_data.tonics),m(p,F(e.level_data.trial_count)),m(z,F(e.level_data.sequence_length)),m(f,F(e.level_data.min_note)),m(j,F(e.level_data.max_note))});const U=v(()=>t(g)!==e.level_data.name||t(p)!==e.level_data.trial_count||t(z)!==e.level_data.sequence_length||t(f)!==e.level_data.min_note||t(j)!==e.level_data.max_note||!De(t(h),e.level_data.intervals)||!De(t(P),e.level_data.tonics));let A=E(!1),L=E(!1),O=E(!1),B=E(""),S=E("");const R=v(()=>t(B)!==t(S));let X=E("");Ce(()=>{e.level_data,m(X,"")});let ue=E(void 0),ye=E(void 0),fe=E(void 0),ie=E(void 0);const se=v(()=>t(b)&&new Set(t(b)));let M=E(F(Ot)),C=E(1),le=E(void 0);const me=v(()=>t(f)>=t(j));var ge=Cl(),te=Ie(ge),$=o(te),W=o($),be=o(W);{var Se=u=>{var N=D("editing level");_(u,N)},Le=u=>{var N=D("create a new level");_(u,N)};w(be,u=>{a()?u(Se):u(Le,!1)})}i(W),i($);var ke=n($,2),T=o(ke),d=o(T),k=n(o(d),2);Te(k),i(d),i(T);var G=n(T,2),Z=o(G),x=n(o(Z),2);Te(x),V(()=>lt(x,gt(t(h)))),x.__change=[bl,h],Me(x,u=>m(fe,u),()=>t(fe)),i(Z);var I=n(Z,2);I.__click=[hl,L],Ne(2),i(G);var K=n(G,2),J=o(K),Q=n(o(J),2),H=o(Q);Te(H),Y(H,"min",1);var oe=n(H,2);Te(oe),Y(oe,"min",1),Y(oe,"max",20),i(Q),i(J),i(K);var re=n(K,2),Ee=o(re),Ke=n(o(Ee),2),Xe=o(Ke);Te(Xe),Y(Xe,"min",2);var Ze=n(Xe,2);Te(Ze),Y(Ze,"min",2),Y(Ze,"max",16),i(Ke),i(Ee),i(re);var ot=n(re,2),_t=o(ot),ct=n(o(_t),2),ea=o(ct,!0);i(ct);var Oe=n(ct,2);Te(Oe),Y(Oe,"step",1),Y(Oe,"min",tt),Y(Oe,"max",at);var Be=n(Oe,2);Te(Be),Y(Be,"step",1),Y(Be,"min",tt),Y(Be,"max",at),i(_t);var yt=n(_t,2),dt=n(o(yt),2),ta=o(dt,!0);i(dt);var Re=n(dt,2);Te(Re),Y(Re,"step",1),Y(Re,"min",tt),Y(Re,"max",at);var He=n(Re,2);Te(He),Y(He,"step",1),Y(He,"min",tt),Y(He,"max",at),i(yt),i(ot);var kt=n(ot,2);{var aa=u=>{rt(u,{status:"error",children:(N,_e)=>{Ne();var ce=D("the lowest note must be lower than the highest");_(N,ce)},$$slots:{default:!0}})},la=u=>{var N=pl(),_e=Ie(N),ce=v(()=>t(le)??0);$t(_e,{get width(){return t(ce)},max_height:50,get min_note(){return t(f)},get max_note(){return t(j)},get highlighted_keys(){return t(se)},clickable:!1,middle_c_label:!0}),Ne(2),_(u,N)};w(kt,u=>{t(me)?u(aa):u(la,!1)})}var Qe=n(kt,2),vt=o(Qe),$e=n(o(vt),2);Te($e),V(()=>lt($e,ht(t(b)))),$e.__change=[yl,b],Me($e,u=>m(ie,u),()=>t(ie)),i(vt);var ra=n(vt,2);ra.__click=[kl,O],Ne(2),i(Qe);var Je=n(Qe,2);Je.__click=[xl,e,q];var na=o(Je);{var ia=u=>{var N=D("save changes to level");_(u,N)},sa=u=>{var N=D("create level");_(u,N)};w(na,u=>{a()?u(ia):u(sa,!1)})}i(Je);var xt=n(Je,2);{var oa=u=>{var N=Sl(),_e=Ie(N);_e.__click=[wl,c];var ce=n(_e,2);{var xe=ae=>{var Ae=zl(),et=o(Ae);et.__click=[jl,c,e],i(Ae),ze(3,Ae,()=>qe),_(ae,Ae)};w(ce,ae=>{t(c)&&ae(xe)})}var ne=n(ce,2);{var we=ae=>{var Ae=Il();Ae.__click=[ql,e],_(ae,Ae)};w(ne,ae=>{e.onduplicate&&ae(we)})}_(u,N)};w(xt,u=>{e.onremove&&a()&&u(oa)})}var Ve=n(xt,2);Ve.__click=[gl,B,S,q,A];var _a=o(Ve);{var ca=u=>{var N=D("import/export data");_(u,N)},da=u=>{var N=D("import data");_(u,N)};w(_a,u=>{a()?u(ca):u(da,!1)})}i(Ve),Me(Ve,u=>m(ye,u),()=>t(ye));var wt=n(Ve,2);{var va=u=>{var N=Tl(),_e=o(N);rt(_e,{status:"error",children:(ce,xe)=>{var ne=Al(),we=o(ne,!0);i(ne),V(()=>he(we,t(X))),_(ce,ne)},$$slots:{default:!0}}),i(N),_(u,N)};w(wt,u=>{t(X)&&u(va)})}var jt=n(wt,2);{var ua=u=>{var N=Ll();N.__click=[Pl,e,U,q],_(u,N)};w(jt,u=>{e.onplay&&a()&&u(ua)})}var ma=n(jt,2);{var fa=u=>{var N=Ml();N.__click=[El,e];var _e=o(N);{var ce=ne=>{var we=D("discard changes and stop editing");_(ne,we)},xe=ne=>{var we=D("close level editor");_(ne,we)};w(_e,ne=>{t(U)?ne(ce):ne(xe,!1)})}i(N),_(u,N)};w(ma,u=>{e.onclose&&a()&&u(fa)})}i(ke),i(te);var zt=n(te,2);{var ga=u=>{Ue(u,{onclose:()=>{var N;m(A,!1),(N=t(ye))==null||N.focus()},children:(N,_e)=>{var ce=Dl(),xe=n(o(ce),2);pt(xe,{get text(){return t(S)},oncopy:()=>{var ae;(ae=t(ue))==null||ae.select()}});var ne=n(xe,2);Ge(ne),Me(ne,ae=>m(ue,ae),()=>t(ue));var we=n(ne,2);we.__click=[fl,X,S,e,A],i(ce),V(()=>{we.disabled=!t(R),Y(we,"title",t(R)?void 0:"data has not changed")}),je(ne,()=>t(S),ae=>m(S,ae)),_(N,ce)},$$slots:{default:!0}})};w(zt,u=>{t(A)&&u(ga)})}var qt=n(zt,2);{var ba=u=>{Ue(u,{onclose:()=>{var _e;m(L,!1),(_e=t(fe))==null||_e.focus()},children:(_e,ce=At)=>{var xe=Ol(),ne=n(o(xe),2);ll(ne,{get intervals(){return t(h)},oninput:ae=>{m(h,ae),ce()()},get scale(){return t(M)},set scale(ae){m(M,F(ae))},get octaves(){return t(C)},set octaves(ae){m(C,F(ae))}});var we=n(ne,2);we.__click=function(...ae){var Ae;(Ae=ce())==null||Ae.apply(this,ae)},i(xe),_(_e,xe)},$$slots:{default:!0}})};w(qt,u=>{t(L)&&u(ba)})}var ha=n(qt,2);{var pa=u=>{Ue(u,{onclose:()=>{var _e;m(O,!1),(_e=t(ie))==null||_e.focus()},children:(_e,ce=At)=>{var xe=Nl(),ne=n(o(xe),2),we=v(()=>new Set(t(b)));vl(ne,{audio_state:r,get notes(){return t(we)},get min_note(){return t(f)},get max_note(){return t(j)},oninput:Ae=>{m(b,Ae),ce()()},before_buttons:Ae=>{var et=Rl();et.__click=function(...ya){var It;(It=ce())==null||It.apply(this,ya)},_(Ae,et)},$$slots:{before_buttons:!0}}),i(xe),_(_e,xe)},$$slots:{default:!0}})};w(ha,u=>{t(O)&&u(pa)})}V(()=>{he(ea,Tt[t(f)]),he(ta,Tt[t(j)]),Je.disabled=a()&&!t(U)||t(me)}),je(k,()=>t(s),u=>m(s,u)),je(H,()=>t(p),u=>m(p,u)),je(oe,()=>t(p),u=>m(p,u)),je(Xe,()=>t(z),u=>m(z,u)),je(Ze,()=>t(z),u=>m(z,u)),je(Oe,()=>t(f),u=>m(f,u)),je(Be,()=>t(f),u=>m(f,u)),je(Re,()=>t(j),u=>m(j,u)),je(He,()=>t(j),u=>m(j,u)),Ya(Qe,"clientWidth",u=>m(le,u)),_(l,ge),ve()}Pe(["change","click"]);var Bl=(l,e,a)=>e()(a.project.id),Hl=y('<button type="button" class="flex_1"> </button>'),Jl=(l,e,a,r,c)=>{var s,g;return t(e)?(s=a())==null?void 0:s(r.project.id):(g=c())==null?void 0:g(r.project_data??r.load(r.project.id))},Vl=y('<button type="button" class="icon_button plain_button size_xl deselectable svelte-12y7az0"><!></button>'),Ul=(l,e)=>m(e,!t(e)),Wl=y('<button type="button" class="icon_button plain_button size_xl svelte-12y7az0"><!></button>'),Yl=y('<li class="project_item svelte-12y7az0"><!>  <!> <!></li>');function Gl(l,e){de(e,!0);const a=ee(e,"select",3,null),r=ee(e,"edit",3,null),c=ee(e,"remove",3,null);let s=E(!1);var g=Yl(),h=o(g);{var b=j=>{var q=Hl();q.__click=[Bl,a,e];var U=o(q,!0);i(q),V(()=>{pe(q,"selected",e.selected),he(U,e.project.name)}),_(j,q)};w(h,j=>{a()&&j(b)})}var P=n(h,2);{var p=j=>{var q=Vl();q.__click=[Jl,s,c,e,r];var U=o(q);{var A=O=>{var B=D("âœ•");_(O,B)},L=O=>{var B=D("âœŽ");_(O,B)};w(U,O=>{t(s)?O(A):O(L,!1)})}i(q),V(()=>{Y(q,"title",t(s)?"remove project":"edit project"),pe(q,"selected",e.selected&&!t(s)&&e.editing),pe(q,"color_c",t(s))}),_(j,q)};w(P,j=>{(t(s)&&c()||!t(s)&&r())&&j(p)})}var z=n(P,2);{var f=j=>{var q=Wl();q.__click=[Ul,s];var U=o(q);{var A=O=>{var B=D("Ã—");_(O,B)},L=O=>{var B=D("âœ•");_(O,B)};w(U,O=>{t(s)?O(A):O(L,!1)})}i(q),V(()=>Y(q,"title",t(s)?"cancel removing":"remove project")),_(j,q)};w(z,j=>{c()&&j(f)})}i(g),V(()=>pe(g,"selected",e.selected)),ze(3,g,()=>qe),_(l,g),ve()}Pe(["click"]);var Kl=y('<menu class="unstyled width_sm mb_0"></menu>');function Xl(l,e){de(e,!0);const a=ee(e,"selected_project_id",3,null),r=ee(e,"editing_project_id",3,null),c=ee(e,"projects",19,()=>[]),s=ee(e,"project_datas",19,()=>[]);var g=Kl();Fe(g,21,c,h=>h.id,(h,b)=>{var P=v(()=>s().find(f=>f.id===t(b).id)),p=v(()=>t(b).id===a()),z=v(()=>t(b).id===r());Gl(h,{get project(){return t(b)},get project_data(){return t(P)},get load(){return e.load_project},get select(){return e.select_project},get edit(){return e.edit_project},get remove(){return e.remove_project},get selected(){return t(p)},get editing(){return t(z)}})}),i(g),_(l,g),ve()}var Zl=(l,e,a,r)=>{t(e)?a().editing_project=!1:t(r)(it.parse({}))},Ql=y('<div class="panel p_md"><header><h2 class="my_0">projects</h2></header> <!> <button type="button" class="w_100 mt_md deselectable">create a new project</button></div>');function $l(l,e){de(e,!0);const a=ee(e,"app",7),r=v(()=>a().load_project),c=v(()=>a().select_project),s=v(()=>a().edit_project),g=v(()=>a().remove_project),h=v(()=>a().editing_project&&a().selected_project_id!==a().editing_project_id),b=v(()=>a().app_data),P=v(()=>t(b).projects);var p=Ql(),z=n(o(p),2),f=v(()=>a().editing_project?a().editing_project_id:null);Xl(z,{get selected_project_id(){return a().selected_project_id},get editing_project_id(){return t(f)},get projects(){return t(P)},get project_datas(){return a().project_datas},get load_project(){return t(r)},get select_project(){return t(c)},edit_project:q=>t(s)(q===a().editing_project_data&&a().editing_project?null:q),get remove_project(){return t(g)}});var j=n(z,2);j.__click=[Zl,h,a,s],i(p),V(()=>pe(j,"selected",t(h))),_(l,p),ve()}Pe(["click"]);var er=(l,e)=>e.toggle(),tr=y(`<aside>devices with smaller screens aren't well supported yet, see <a href="https://github.com/ryanatkn/earbetter/issues/2">issue #2</a></aside> <table><tbody><tr><td class="svelte-1gwge1y"><code>Spacebar</code></td><td class="svelte-1gwge1y">replay trial</td></tr><tr><td class="svelte-1gwge1y"><code>r</code></td><td class="svelte-1gwge1y">restart level</td></tr><tr><td class="svelte-1gwge1y"><code>Escape</code></td><td class="svelte-1gwge1y"><button type="button" class="inline">toggle main menu</button></td></tr><tr><td class="svelte-1gwge1y"><code>1 to 4</code></td><td class="svelte-1gwge1y">set instrument</td></tr><tr><td class="svelte-1gwge1y"><code>c</code></td><td class="svelte-1gwge1y">connect MIDI</td></tr><tr><td class="svelte-1gwge1y"><code>up/down arrows</code></td><td class="svelte-1gwge1y">adjust volume</td></tr></tbody></table>`,1);function ar(l,e){de(e,!0);const a=Pa.get();var r=tr(),c=n(Ie(r),2),s=o(c),g=n(o(s),2),h=n(o(g)),b=o(h);b.__click=[er,a],Xt(b,"min-width","172px"),i(h),i(g),Ne(3),i(s),i(c),_(l,r),ve()}Pe(["click"]);var lr=y('<div class="realm_stats_summary svelte-1mwdoug" title="you performed flawlessly in every level of this realm!">â˜…</div>');function rr(l,e){de(e,!0);const a=v(()=>e.realm_data.levels.map(z=>e.level_stats.mistakes[z.id]??[])),r=v(()=>t(a).reduce((z,f)=>z+f.length,0)),c=v(()=>Vt*t(a).length),s=v(()=>!!t(r)&&t(r)>=t(c)),g=v(()=>t(s)?t(a).reduce((z,f)=>z+f.reduce((j,q)=>j+q,0),0):void 0),h=v(()=>t(g)===0);var b=Mt(),P=Ie(b);{var p=z=>{var f=lr();_(z,f)};w(P,z=>{t(h)&&z(p)})}_(l,b),ve()}var nr=(l,e,a)=>e()(a.realm_data.id),ir=y('<button type="button" class="realm_button svelte-1joa4ch"> </button>'),sr=(l,e,a,r,c)=>{var s,g;return t(e)?(s=a())==null?void 0:s(r.realm_data.id):(g=c())==null?void 0:g(r.realm_data)},or=y('<button type="button" class="icon_button plain_button size_xl deselectable svelte-1joa4ch"><!></button>'),_r=(l,e)=>m(e,!t(e)),cr=y('<button type="button" class="icon_button plain_button size_xl svelte-1joa4ch"><!></button>'),dr=y('<li class="realm_item svelte-1joa4ch"><!> <!>  <!> <!></li>');function vr(l,e){de(e,!0);const a=ee(e,"select",3,null),r=ee(e,"edit",3,null),c=ee(e,"remove",3,null);let s=E(!1);const g=v(()=>e.project_data.level_stats);var h=dr(),b=o(h);{var P=A=>{rr(A,{get realm_data(){return e.realm_data},get level_stats(){return t(g)}})};w(b,A=>{t(g)&&A(P)})}var p=n(b,2);{var z=A=>{var L=ir();L.__click=[nr,a,e];var O=o(L,!0);i(L),V(()=>{pe(L,"selected",e.selected),he(O,e.realm_data.name)}),_(A,L)};w(p,A=>{a()&&A(z)})}var f=n(p,2);{var j=A=>{var L=or();L.__click=[sr,s,c,e,r];var O=o(L);{var B=R=>{var X=D("âœ•");_(R,X)},S=R=>{var X=D("âœŽ");_(R,X)};w(O,R=>{t(s)?R(B):R(S,!1)})}i(L),V(()=>{Y(L,"title",t(s)?"remove realm":e.editing?"stop editing realm":"edit realm"),pe(L,"selected",e.selected&&!t(s)&&e.editing),pe(L,"color_c",t(s))}),_(A,L)};w(f,A=>{(t(s)&&c()||!t(s)&&r())&&A(j)})}var q=n(f,2);{var U=A=>{var L=cr();L.__click=[_r,s];var O=o(L);{var B=R=>{var X=D("Ã—");_(R,X)},S=R=>{var X=D("âœ•");_(R,X)};w(O,R=>{t(s)?R(B):R(S,!1)})}i(L),V(()=>Y(L,"title",t(s)?"cancel removing":"remove realm")),_(A,L)};w(q,A=>{c()&&A(U)})}i(h),V(()=>pe(h,"selected",e.selected)),ze(3,h,()=>qe),_(l,h),ve()}Pe(["click"]);var ur=y('<menu class="unstyled width_sm mb_0"></menu>');function mr(l,e){de(e,!0);const a=ee(e,"selected_realm_data",3,null),r=ee(e,"editing_realm_id",3,null),c=ee(e,"realms",19,()=>[]),s=v(()=>new Map(c().map(b=>[b.id,b]))),g=b=>t(s).get(b);var h=ur();Fe(h,21,c,b=>b.id,(b,P)=>{var p=v(()=>g(t(P).id)),z=v(()=>{var j;return t(P).id===((j=a())==null?void 0:j.id)}),f=v(()=>t(P).id===r());vr(b,{get realm_data(){return t(p)},get project_data(){return e.project_data},get select(){return e.select_realm},get edit(){return e.edit_realm},get remove(){return e.remove_realm},get selected(){return t(z)},get editing(){return t(f)}})}),i(h),_(l,h),ve()}const fr=(l,e,a,r,c)=>{var s;t(e)?(s=document.querySelector(".realm_def_form input"))==null||s.focus():t(a)?r().editing_realm=!1:t(c)(st.parse({}))};var gr=y("<div><!></div>"),br=y('<div class="panel p_md"><header><h2 class="my_0">realms</h2></header> <!> <button type="button">create a new realm</button></div>');function hr(l,e){de(e,!0);const a=ee(e,"app",7),r=v(()=>a().select_realm),c=v(()=>a().edit_realm),s=v(()=>a().remove_realm),g=v(()=>{var f;return a().editing_realm&&!!a().editing_realm_data&&((f=a().selected_realm_data)==null?void 0:f.id)!==a().editing_realm_data.id}),h=v(()=>{var f;return!((f=a().realms)!=null&&f.length)});var b=br(),P=n(o(b),2);{var p=f=>{var j=gr(),q=o(j),U=v(()=>a().editing_realm?a().editing_realm_id:null);mr(q,{get project_data(){return a().selected_project_data},get selected_realm_data(){return a().selected_realm_data},get realms(){return a().realms},get editing_realm_id(){return t(U)},get select_realm(){return t(r)},edit_realm:A=>t(c)(A===a().editing_realm_data&&a().editing_realm?null:A),get remove_realm(){return t(s)}}),i(j),ze(3,j,()=>qe),_(f,j)};w(P,f=>{a().realms&&a().selected_project_data&&f(p)})}var z=n(P,2);z.__click=[fr,h,g,a,c],i(b),V(()=>{Wa(z,`${(t(h)?void 0:"deselectable")??""} svelte-100yq62`),pe(z,"selected",t(g)||t(h))}),_(l,b),ve()}Pe(["click"]);const pr=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Fa());const g=st.parse(s);r.onsubmit(g)}catch(s){console.error("failed to import data",s),m(e,F(s.message||"unknown error"))}m(c,!1)},yr=(l,e,a,r,c)=>{m(e,F(m(a,F(JSON.stringify(r()))))),m(c,!0)};var kr=y('<div class="importing bg shadow_d_xl p_xl width_md box svelte-1g446ss"><h2 class="my_0">import realm data</h2> <!> <textarea class="svelte-1g446ss"></textarea> <button type="button" class="svelte-1g446ss">import realm data</button></div>'),xr=(l,e,a)=>{l.key==="Enter"&&(Wt(l),e.onsubmit(a()))},wr=(l,e,a)=>e.onsubmit(a()),jr=(l,e)=>m(e,!t(e)),zr=(l,e,a)=>{m(e,!1),a.onremove(a.realm_data.id)},qr=y('<div class="pb_md"><button type="button" class="color_c w_100 svelte-1g446ss">âœ• confirm remove</button></div>'),Ir=(l,e)=>e.onduplicate(e.realm_data.id),Sr=y('<button type="button" class="svelte-1g446ss">duplicate realm</button>'),Ar=y('<button type="button" class="svelte-1g446ss">remove realm</button> <!> <!>',1),Tr=(l,e)=>m(e,!t(e)),Pr=(l,e,a)=>{m(e,!1),a.onsubmit(Ut().realms)},Lr=y('<div><button type="button" class="w_100 svelte-1g446ss"> </button></div>'),Er=y('<button type="button" class="svelte-1g446ss">create default realms</button> <!>',1),Mr=y("<pre> </pre>"),Dr=y('<div class="message-wrapper svelte-1g446ss"><!></div>'),Or=(l,e)=>e.onclose(e.realm_data.id),Rr=y('<button class="w_100 svelte-1g446ss" type="button"><!></button>'),Nr=y('<!> <form class="realm_def_form"><header><h2 class="my_0"><!></h2></header> <fieldset><label><div class="title">name</div> <input></label></fieldset> <button type="button" class="accent svelte-1g446ss"><!></button> <!> <button type="button" class="svelte-1g446ss"><!></button> <!> <!> <!></form>',1);function Cr(l,e){de(e,!0);const a=ee(e,"editing",3,!1);let r=E(!1),c=E(F(e.realm_data.name));const s=v(()=>{var x;return(x=t(c))==null?void 0:x.trim()}),g=()=>st.parse({id:e.realm_data.id,name:t(s),levels:e.realm_data.levels});Ce(()=>{console.log("set_realm_data",e.realm_data),m(c,F(e.realm_data.name))});const h=v(()=>t(s)!==e.realm_data.name);let b=E(!1),P=E(""),p=E("");const z=v(()=>t(P)!==t(p));let f=E("");Ce(()=>{e.realm_data,m(f,"")});let j=E(void 0),q=E(void 0);const U=Ut().realms;let A=E(!1);var L=Nr(),O=Ie(L);{var B=x=>{Ue(x,{onclose:()=>{var I;m(b,!1),(I=t(q))==null||I.focus()},children:(I,K)=>{var J=kr(),Q=n(o(J),2);pt(Q,{get text(){return t(p)},oncopy:()=>{var re;(re=t(j))==null||re.select()}});var H=n(Q,2);Ge(H),Me(H,re=>m(j,re),()=>t(j));var oe=n(H,2);oe.__click=[pr,f,p,e,b],i(J),V(()=>{oe.disabled=!t(z),Y(oe,"title",t(z)?void 0:"data has not changed")}),je(H,()=>t(p),re=>m(p,re)),_(I,J)},$$slots:{default:!0}})};w(O,x=>{t(b)&&x(B)})}var S=n(O,2),R=o(S),X=o(R),ue=o(X);{var ye=x=>{var I=D("editing realm");_(x,I)},fe=x=>{var I=D("create a new realm");_(x,I)};w(ue,x=>{a()?x(ye):x(fe,!1)})}i(X),i(R);var ie=n(R,2),se=o(ie),M=n(o(se),2);Te(M),M.__keydown=[xr,e,g],i(se),i(ie);var C=n(ie,2);C.__click=[wr,e,g];var le=o(C);{var me=x=>{var I=D("save changes to realm");_(x,I)},ge=x=>{var I=D("create realm");_(x,I)};w(le,x=>{a()?x(me):x(ge,!1)})}i(C);var te=n(C,2);{var $=x=>{var I=Ar(),K=Ie(I);K.__click=[jr,r];var J=n(K,2);{var Q=re=>{var Ee=qr(),Ke=o(Ee);Ke.__click=[zr,r,e],i(Ee),ze(3,Ee,()=>qe),_(re,Ee)};w(J,re=>{t(r)&&re(Q)})}var H=n(J,2);{var oe=re=>{var Ee=Sr();Ee.__click=[Ir,e],_(re,Ee)};w(H,re=>{e.onduplicate&&re(oe)})}_(x,I)};w(te,x=>{e.onremove&&a()&&x($)})}var W=n(te,2);W.__click=[yr,P,p,g,b];var be=o(W);{var Se=x=>{var I=D("import/export data");_(x,I)},Le=x=>{var I=D("import data");_(x,I)};w(be,x=>{a()?x(Se):x(Le,!1)})}i(W),Me(W,x=>m(q,x),()=>t(q));var ke=n(W,2);{var T=x=>{var I=Er(),K=Ie(I);K.__click=[Tr,A];var J=n(K,2);{var Q=H=>{var oe=Lr(),re=o(oe);re.__click=[Pr,A,e];var Ee=o(re);i(re),i(oe),V(()=>he(Ee,`create ${U.length??""} new realms`)),ze(3,oe,()=>qe),_(H,oe)};w(J,H=>{t(A)&&H(Q)})}_(x,I)};w(ke,x=>{a()||x(T)})}var d=n(ke,2);{var k=x=>{var I=Dr(),K=o(I);rt(K,{status:"error",children:(J,Q)=>{var H=Mr(),oe=o(H,!0);i(H),V(()=>he(oe,t(f))),_(J,H)},$$slots:{default:!0}}),i(I),_(x,I)};w(d,x=>{t(f)&&x(k)})}var G=n(d,2);{var Z=x=>{var I=Rr();I.__click=[Or,e];var K=o(I);{var J=H=>{var oe=D("discard changes");_(H,oe)},Q=H=>{var oe=D("close realm editor");_(H,oe)};w(K,H=>{t(h)?H(J):H(Q,!1)})}i(I),_(x,I)};w(G,x=>{e.onclose&&a()&&x(Z)})}i(S),V(()=>C.disabled=a()&&!t(h)),je(M,()=>t(c),x=>m(c,x)),_(l,L),ve()}Pe(["click","keydown"]);var Fr=y('<div class="panel p_md"><!></div>');function Br(l,e){de(e,!0);const a=ee(e,"app",7),r=v(()=>a().remove_realm),c=v(()=>a().duplicate_realm),s=v(()=>a().update_realm),g=v(()=>a().create_realm),h=v(()=>a().editing_realm_data??st.parse({})),b=v(()=>a().realms?a().realms.some(f=>f.id===t(h).id):!1),P=(f,j)=>{var q;(q=a().realms)!=null&&q.some(U=>U.id===f.id)?t(s)(f):t(g)(f,j)};var p=Fr(),z=o(p);Cr(z,{get editing(){return t(b)},get realm_data(){return t(h)},onsubmit:f=>{if(Array.isArray(f))for(let j=0;j<f.length;j++)P(f[j],j===0);else P(f,!0)},onremove:f=>t(r)(f),onduplicate:f=>t(c)(f),onclose:()=>a().editing_realm=!1}),i(p),_(l,p),ve()}var Hr=(l,e)=>e.app.play_level(e.level_data.id),Jr=async(l,e,a,r)=>{if(t(e))a.app.remove_level(a.level_data.id);else{const c=!t(r);if(a.app.edit_level(c?a.level_data:null),c){await Dt();const s=document.querySelector(".level_def_form");s==null||s.scrollIntoView({behavior:"smooth",block:"center"})}}},Vr=(l,e)=>m(e,!t(e)),Ur=y('<li class="level_map_item svelte-170pvnv"><!> <button type="button" class="level_button deselectable svelte-170pvnv" title="play this level"> </button> <button type="button" class="icon_button plain_button size_xl svelte-170pvnv"><!></button> <button type="button" class="icon_button plain_button size_xl svelte-170pvnv"><!></button></li>');function Wr(l,e){de(e,!0);const a=v(()=>e.app.draft_level_data===e.level_data),r=v(()=>e.app.editing_level&&t(a)),c=v(()=>{var S;return(S=e.app.selected_project_data)==null?void 0:S.level_stats});let s=E(!1);const g=v(()=>t(r)||t(a));var h=Ur(),b=o(h);{var P=S=>{Ka(S,{get level_data(){return e.level_data},get level_stats(){return t(c)}})};w(b,S=>{t(c)&&S(P)})}var p=n(b,2);p.__click=[Hr,e];var z=o(p,!0);i(p);var f=n(p,2);f.__click=[Jr,s,e,r];var j=o(f);{var q=S=>{var R=D("âœ•");_(S,R)},U=S=>{var R=D("âœŽ");_(S,R)};w(j,S=>{t(s)?S(q):S(U,!1)})}i(f);var A=n(f,2);A.__click=[Vr,s];var L=o(A);{var O=S=>{var R=D("Ã—");_(S,R)},B=S=>{var R=D("âœ•");_(S,R)};w(L,S=>{t(s)?S(O):S(B,!1)})}i(A),i(h),V(()=>{pe(h,"selected",t(g)),pe(p,"selected",t(g)),he(z,e.level_data.name),Y(f,"title",t(s)?"remove level":t(r)?"stop editing level":"edit level"),pe(f,"selected",!t(s)&&t(r)),pe(f,"color_c",t(s)),Y(A,"title",t(s)?"cancel removing":"remove level")}),ze(3,h,()=>qe),_(l,h),ve()}Pe(["click"]);const Yr=(l,e,a,r)=>{var c;t(e)?(c=document.querySelector(".level_def_form input"))==null||c.focus():a.app.edit_level(t(r)?null:nt.parse({}))};var Gr=y('<div class="panel p_md"><header><h2 class="my_0">levels</h2> <h3 class="my_0"> </h3></header> <menu class="levels unstyled mb_0 svelte-wmjxbn"></menu> <button type="button" class="svelte-wmjxbn">create a new level</button></div>');function Kr(l,e){de(e,!0);const a=v(()=>e.app.editing_level&&!e.levels.some(p=>p===e.app.draft_level_data)),r=v(()=>!e.levels.length);var c=Gr(),s=o(c),g=n(o(s),2),h=o(g,!0);i(g),i(s);var b=n(s,2);Fe(b,21,()=>e.levels,p=>p.id,(p,z)=>{Wr(p,{get app(){return e.app},get level_data(){return t(z)}})}),i(b);var P=n(b,2);P.__click=[Yr,r,e,a],i(c),V(()=>{var p;he(h,(p=e.app.selected_realm_data)==null?void 0:p.name),pe(P,"selected",t(a)||t(r)),pe(P,"deselectable",!t(r))}),_(l,c),ve()}Pe(["click"]);const Xr=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Ba());const g=it.parse(s);r.onsubmit(g)}catch(s){console.error("failed to import data",s),m(e,F(s.message||"unknown error"))}m(c,!1)},Zr=(l,e,a,r,c)=>{m(e,F(m(a,F(JSON.stringify(r()))))),m(c,!0)};var Qr=y('<div class="importing bg shadow_d_xl p_xl width_md box svelte-l3tcx7"><h2 class="my_0">import project data</h2> <!> <textarea class="svelte-l3tcx7"></textarea> <button type="button" class="svelte-l3tcx7">import project data</button></div>'),$r=(l,e,a)=>{l.key==="Enter"&&(Wt(l),e.onsubmit(a()))},en=(l,e,a)=>e.onsubmit(a()),tn=(l,e)=>m(e,!t(e)),an=(l,e,a)=>{m(e,!1),a.onremove(a.project_data.id)},ln=y('<div class="pb_md"><button type="button" class="color_c w_100 svelte-l3tcx7">âœ• confirm remove</button></div>'),rn=(l,e)=>e.onduplicate(e.project_data.id),nn=y('<button type="button" class="w_100 svelte-l3tcx7">duplicate project</button>'),sn=y('<button class="w_100 svelte-l3tcx7" type="button">remove project</button> <!> <!>',1),on=y("<pre> </pre>"),_n=y('<div class="overflow_x_auto"><!></div>'),cn=(l,e)=>e.onclose(e.project_data.id),dn=y('<button type="button" class="w_100 svelte-l3tcx7"><!></button>'),vn=y('<!> <form><header><h2 class="my_0"><!></h2></header> <fieldset><label><div class="title">name</div> <input></label></fieldset> <button type="button" class="accent w_100 svelte-l3tcx7"><!></button> <!> <button type="button" class="w_100 svelte-l3tcx7"><!></button> <!> <!></form>',1);function un(l,e){de(e,!0);const a=ee(e,"editing",3,!1);let r=E(!1),c=E(F(e.project_data.name));const s=v(()=>t(c).trim()),g=()=>it.parse({id:e.project_data.id,name:t(s),realms:e.project_data.realms,level_stats:e.project_data.level_stats});Ce(()=>{console.log("set_project_data",e.project_data),m(c,F(e.project_data.name))});const h=v(()=>t(s)!==e.project_data.name);let b=E(!1),P=E(""),p=E("");const z=v(()=>t(P)!==t(p));let f=E("");Ce(()=>{e.project_data,m(f,"")});let j=E(void 0),q=E(void 0);var U=vn(),A=Ie(U);{var L=d=>{Ue(d,{onclose:()=>{var k;m(b,!1),(k=t(q))==null||k.focus()},children:(k,G)=>{var Z=Qr(),x=n(o(Z),2);pt(x,{get text(){return t(p)},oncopy:()=>{var J;(J=t(j))==null||J.select()}});var I=n(x,2);Ge(I),Me(I,J=>m(j,J),()=>t(j));var K=n(I,2);K.__click=[Xr,f,p,e,b],i(Z),V(()=>{K.disabled=!t(z),Y(K,"title",t(z)?void 0:"data has not changed")}),je(I,()=>t(p),J=>m(p,J)),_(k,Z)},$$slots:{default:!0}})};w(A,d=>{t(b)&&d(L)})}var O=n(A,2),B=o(O),S=o(B),R=o(S);{var X=d=>{var k=D("editing project");_(d,k)},ue=d=>{var k=D("create a new project");_(d,k)};w(R,d=>{a()?d(X):d(ue,!1)})}i(S),i(B);var ye=n(B,2),fe=o(ye),ie=n(o(fe),2);Te(ie),ie.__keydown=[$r,e,g],i(fe),i(ye);var se=n(ye,2);se.__click=[en,e,g];var M=o(se);{var C=d=>{var k=D("save changes to project");_(d,k)},le=d=>{var k=D("create project");_(d,k)};w(M,d=>{a()?d(C):d(le,!1)})}i(se);var me=n(se,2);{var ge=d=>{var k=sn(),G=Ie(k);G.__click=[tn,r];var Z=n(G,2);{var x=J=>{var Q=ln(),H=o(Q);H.__click=[an,r,e],i(Q),ze(3,Q,()=>qe),_(J,Q)};w(Z,J=>{t(r)&&J(x)})}var I=n(Z,2);{var K=J=>{var Q=nn();Q.__click=[rn,e],_(J,Q)};w(I,J=>{e.onduplicate&&J(K)})}_(d,k)};w(me,d=>{e.onremove&&a()&&d(ge)})}var te=n(me,2);te.__click=[Zr,P,p,g,b];var $=o(te);{var W=d=>{var k=D("import/export data");_(d,k)},be=d=>{var k=D("import data");_(d,k)};w($,d=>{a()?d(W):d(be,!1)})}i(te),Me(te,d=>m(q,d),()=>t(q));var Se=n(te,2);{var Le=d=>{var k=_n(),G=o(k);rt(G,{status:"error",children:(Z,x)=>{var I=on(),K=o(I,!0);i(I),V(()=>he(K,t(f))),_(Z,I)},$$slots:{default:!0}}),i(k),_(d,k)};w(Se,d=>{t(f)&&d(Le)})}var ke=n(Se,2);{var T=d=>{var k=dn();k.__click=[cn,e];var G=o(k);{var Z=I=>{var K=D("discard changes and stop editing");_(I,K)},x=I=>{var K=D("close project editor");_(I,K)};w(G,I=>{t(h)?I(Z):I(x,!1)})}i(k),_(d,k)};w(ke,d=>{e.onclose&&a()&&d(T)})}i(O),V(()=>se.disabled=a()&&!t(h)),je(ie,()=>t(c),d=>m(c,d)),_(l,U),ve()}Pe(["click","keydown"]);var mn=y('<div class="panel p_md"><!></div>');function fn(l,e){de(e,!0);const a=ee(e,"app",7),r=v(()=>a().remove_project),c=v(()=>a().duplicate_project),s=v(()=>a().update_project),g=v(()=>a().create_project),h=v(()=>a().editing_project_data??it.parse({})),b=v(()=>a().project_datas.some(f=>f.id===t(h).id));var P=mn(),p=o(P),z=v(()=>t(b)?t(s):t(g));un(p,{get editing(){return t(b)},get project_data(){return t(h)},get onsubmit(){return t(z)},get onremove(){return t(r)},get onduplicate(){return t(c)},onclose:()=>a().editing_project=!1}),i(P),_(l,P),ve()}var gn=y('<section class="card svelte-8muejm"><!></section>'),bn=y('<section class="card svelte-8muejm"><!></section>'),hn=y('<div class="width_sm svelte-8muejm"><!>  <!> <section class="card svelte-8muejm"><div class="panel p_md"><header><h2 class="my_0">controls</h2></header> <!> <div class="mb_lg"><!></div> <!> <aside>Earbetter supports MIDI devices like piano keyboards, connect and click:</aside> <!></div></section></div>'),pn=(l,e)=>t(e)(),yn=y(`<section class="card svelte-8muejm"><div class="panel p_md"><p>Earbetter is an <a href="https://wikipedia.org/wiki/Ear_training">ear training</a> tool:</p> <ul><li>each level is a standalone challenge that's a series of trials</li> <li></li> <li>realms group levels into bigger challenges</li> <li>projects group realms so you can customize various experiences</li> <li>levels can be shared via their links or exporting/importing data</li></ul> <p>See also the 3 minute <a href="https://www.youtube.com/watch?v=zW2zI1A_Ikw">video intro on YouTube</a> and <a href="https://github.com/ryanatkn/earbetter">the readme</a>.</p> <aside>Earbetter is in early development, and many things are unfinished and unknown - feedback
						is appreciated on <a href="https://github.com/ryanatkn/earbetter">the GitHub discussions and issues</a>.</aside> <div class="box row"><button type="button" class="m_0">ok, hide this</button></div></div></section>`),kn=y('<section class="card svelte-8muejm"><!></section>'),xn=y('<section class="card svelte-8muejm"><!></section>'),wn=y('<section class="card svelte-8muejm"><div class="panel p_md"><!></div></section>'),jn=y('<div class="width_sm svelte-8muejm"><!>  <!></div>'),zn=y('<!> <div class="map svelte-8muejm"><!> <div class="width_sm svelte-8muejm"><!> <section class="card svelte-8muejm"><!></section>  <!></div> <!></div>',1);function qn(l,e){de(e,!0);const a=ee(e,"app",7),r=v(()=>a().toggle_trainer_help),c=v(()=>a().play_level),s=v(()=>a().edit_level),g=v(()=>a().remove_level),h=v(()=>a().duplicate_level),b=v(()=>a().create_level),P=v(()=>a().update_level),p=Ct.get();window.ac=p;const z=v(()=>a().draft_level_data??nt.parse({})),f=v(()=>a().levels?a().levels.some(M=>M.id===t(z).id):!1),j=v(()=>{var M;return!((M=a().realms)!=null&&M.length)});var q=zn(),U=Ie(q);Qt(U,{get midi_access(){return a().midi_access},onnotestart:(M,C)=>{Bt(a(),p(),M,Ht(a().volume,C),a().instrument)},onnotestop:M=>{bt(M)}});var A=n(U,2),L=o(A);{var O=M=>{var C=hn(),le=o(C);{var me=d=>{var k=gn(),G=o(k);$l(G,{get app(){return a()}}),i(k),ze(3,k,()=>qe),_(d,k)};w(le,d=>{a().selected_project_data&&d(me)})}var ge=n(le,2);{var te=d=>{var k=bn(),G=o(k);fn(G,{get app(){return a()}}),i(k),ze(3,k,()=>qe),_(d,k)};w(ge,d=>{(a().editing_project&&a().editing_project_data||!a().selected_project_data)&&d(te)})}var $=n(ge,2),W=o($),be=n(o(W),2);ar(be,{});var Se=n(be,2),Le=o(Se);Gt(Le,{get volume(){return a().volume},set volume(d){a().volume=d}}),i(Se);var ke=n(Se,2);Yt(ke,{get instrument(){return a().instrument},set instrument(d){a().instrument=d}});var T=n(ke,4);Kt(T,{get midi_state(){return a()}}),i(W),i($),i(C),ze(3,$,()=>qe),_(M,C)};w(L,M=>{a().project_datas.length&&M(O)})}var B=n(L,2),S=o(B);{var R=M=>{var C=yn(),le=o(C),me=n(o(le),2),ge=n(o(me),2);ge.textContent=`your level score is the sum of mistakes in your best ${Vt}
							runs, win a â˜… at 0`,Ne(6),i(me);var te=n(me,6),$=o(te);$.__click=[pn,r],i(te),i(le),i(C),ze(3,C,()=>qe),_(M,C)};w(S,M=>{a().show_trainer_help&&M(R)})}var X=n(S,2),ue=o(X);hr(ue,{get app(){return a()}}),i(X);var ye=n(X,2);{var fe=M=>{var C=kn(),le=o(C);Br(le,{get app(){return a()}}),i(C),ze(3,C,()=>qe),_(M,C)};w(ye,M=>{(a().editing_realm&&a().editing_realm_data||t(j))&&M(fe)})}i(B);var ie=n(B,2);{var se=M=>{var C=jn(),le=o(C);{var me=$=>{var W=xn(),be=o(W);Kr(be,{get app(){return a()},get levels(){return a().levels}}),i(W),ze(3,W,()=>qe),_($,W)};w(le,$=>{a().levels&&$(me)})}var ge=n(le,2);{var te=$=>{var W=wn(),be=o(W),Se=o(be),Le=v(()=>t(f)?t(P):t(b));Fl(Se,{get editing(){return t(f)},get level_data(){return t(z)},get onsubmit(){return t(Le)},get onremove(){return t(g)},get onduplicate(){return t(h)},onplay:async(ke,T)=>{T&&t(P)(ke),await t(c)(ke.id)},onclose:()=>t(s)(null)}),i(be),i(W),ze(2,W,()=>qe),_($,W)};w(ge,$=>{var W;a().selected_realm_id&&(a().editing_level&&a().levels||((W=a().levels)==null?void 0:W.length)===0)&&$(te)})}i(C),_(M,C)};w(ie,M=>{a().project_datas.length&&M(se)})}i(A),_(l,q),ve()}Pe(["click"]);var In=y('<main><!> <!> <!> <div class="box"><!></div></main>');function Jn(l,e){de(e,!0);const a=Jt.get();var r=In();xa(P=>{Ia.title="Earbetter trainer"});var c=o(r);Ga(c,{onclick:()=>Sa(Aa+"/")});var s=n(c,2);Ta(s);var g=n(s,2);qn(g,{app:a});var h=n(g,2),b=o(h);La(b,{}),i(h),i(r),_(l,r),ve()}export{Jn as component};
