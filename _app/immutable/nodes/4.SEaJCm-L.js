var St=l=>{throw TypeError(l)};var Tt=(l,e,a)=>e.has(l)||St("Cannot "+a);var ut=(l,e,a)=>(Tt(l,e,"read from private field"),a?a.call(l):e.get(l)),mt=(l,e,a)=>e.has(l)?St("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,a),ft=(l,e,a,r)=>(Tt(l,e,"write to private field"),r?r.call(l,a):e.set(l,a),a);import{d as Te,t as p,x as Ye,s as he,a as _,y as xa,b as C,c as Lt,h as wa}from"../chunks/BJBe7Lb0.js";import{aN as ja,g as t,a5 as za,b as Ia,u as qa,X as Nt,p as de,D as Me,N as L,f as ze,c as o,F as m,r as i,s as n,d as u,t as G,a as ue,M as Ce,n as Re,ai as At,Q as Sa}from"../chunks/D3PyqNrN.js";import{g as Ta,b as Aa}from"../chunks/CLfsLMPi.js";import{H as Pa}from"../chunks/BAsDJvZq.js";import{m as Ma,F as Da}from"../chunks/B6ztYV1o.js";import{R as Ea,K as Ot,T as gt,d as Rt,U as Ct,l as La,W as Na,J as Oa,j as Ft,n as bt,p as Ra,X as ht,Y as Jt,o as Bt,w as Ht,Z as Ca,f as Vt,a as tt,b as at,_ as nt,m as Pt,$ as Fa,t as we,c as je,a0 as it,M as Ut,a1 as st,a2 as Wt,s as Xt,a3 as Ja,a4 as Ba}from"../chunks/WNhD8uu6.js";import{p as te,i as w}from"../chunks/DZ3TPD6y.js";import{i as Ha,s as Va,b as xe,I as Yt,V as Gt,c as Kt,a as Ua}from"../chunks/s7fqbzLX.js";import{e as Fe,r as Se,s as Y,j as lt,d as Qt,b as Zt,p as Wa,c as De,k as Xa}from"../chunks/BPZI2arh.js";import{M as $t,P as ea,b as Ya,B as Ga}from"../chunks/BCww0_2j.js";import{b as Ee}from"../chunks/DADDcQB6.js";import{D as Ue}from"../chunks/B45j1QEV.js";import{A as rt}from"../chunks/DBYD84Rt.js";import{L as Ka}from"../chunks/DWuEMugI.js";function Qa(l){let e=0,a=za(0),r;return()=>{ja()&&(t(a),Ia(()=>(e===0&&(r=qa(()=>l(()=>Ea(a)))),e+=1,()=>{Nt().then(()=>{e-=1,e===0&&(r==null||r(),r=void 0)})})))}}var We,Xe;class Za{constructor(e,a){mt(this,We);mt(this,Xe);ft(this,We,e),ft(this,Xe,Qa(a))}get current(){return ut(this,Xe).call(this),ut(this,We).call(this)}}We=new WeakMap,Xe=new WeakMap;var Mt=Object.prototype.hasOwnProperty;function Dt(l,e,a){for(a of l.keys())if(Le(a,e))return a}function Le(l,e){var a,r,c;if(l===e)return!0;if(l&&e&&(a=l.constructor)===e.constructor){if(a===Date)return l.getTime()===e.getTime();if(a===RegExp)return l.toString()===e.toString();if(a===Array){if((r=l.length)===e.length)for(;r--&&Le(l[r],e[r]););return r===-1}if(a===Set){if(l.size!==e.size)return!1;for(r of l)if(c=r,c&&typeof c=="object"&&(c=Dt(e,c),!c)||!e.has(c))return!1;return!0}if(a===Map){if(l.size!==e.size)return!1;for(r of l)if(c=r[0],c&&typeof c=="object"&&(c=Dt(e,c),!c)||!Le(r[1],e.get(c)))return!1;return!0}if(a===ArrayBuffer)l=new Uint8Array(l),e=new Uint8Array(e);else if(a===DataView){if((r=l.byteLength)===e.byteLength)for(;r--&&l.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(l)){if((r=l.byteLength)===e.byteLength)for(;r--&&l[r]===e[r];);return r===-1}if(!a||typeof l=="object"){r=0;for(a in l)if(Mt.call(l,a)&&++r&&!Mt.call(e,a)||!(a in e)||!Le(l[a],e[a]))return!1;return Object.keys(e).length===r}}return l!==l&&e!==e}var $a=(l,e)=>m(e,l.currentTarget.value,!0),el=(l,e,a,r,c,s)=>{var f;return(f=e.oninput)==null?void 0:f.call(e,t(a),t(r)?{scale:c(),octaves:s()}:void 0)},tl=(l,e)=>e(La(l.currentTarget.value)),al=p("<option> </option>"),ll=p('<small><textarea class="preview width_sm panel svelte-nk5x9z"></textarea></small> <button type="button" class="accent mb_lg">use these intervals</button> <label><div class="title text_align_center">scale</div> <select></select></label> <label><div class="title text_align_center">octaves</div> <div class="text_align_center"> </div> <input type="range"></label>',1);function rl(l,e){de(e,!0);let a=te(e,"scale",31,()=>Me(Ot)),r=te(e,"octaves",15,1);const c=u(()=>Na(a(),r())),s=u(()=>gt(t(c))),f=Me(gt(e.intervals));let h=L(Me(f));const g=u(()=>(t(c),Date.now())),P=u(()=>(e.intervals,t(h),Date.now())),z=u(()=>t(g)>t(P)),k=u(()=>t(z)?t(s):t(h)),b=u(()=>Ct(t(k))),j=u(()=>!Le(e.intervals,t(b))),I=u(()=>!!t(b).length);var T=ll(),J=ze(T),M=o(J);Ye(M),M.__input=[$a,h],i(J);var E=n(J,2);E.__click=[el,e,b,z,a,r];var O=n(E,2),D=n(o(O),2);Ha(D,()=>a().name);var K;D.__change=[tl,a],Fe(D,20,()=>Rt,se=>se,(se,_e)=>{var N=al(),F={},re=o(N,!0);i(N),G(()=>{F!==(F=_e.name)&&(N.value=(N.__value=_e.name)??""),he(re,_e.name)}),_(se,N)}),i(D),i(O);var V=n(O,2),q=n(o(V),2),W=o(q,!0);i(q);var me=n(q,2);Se(me),Y(me,"min",1),Y(me,"max",6),i(V),G(()=>{lt(M,t(k)),E.disabled=!t(j)||!t(I),K!==(K=a().name)&&(D.value=(D.__value=a().name)??"",Va(D,a().name)),he(W,r())}),xe(me,r),_(l,T),ue()}Te(["input","click","change"]);const Et=new Za(()=>window.innerWidth,l=>xa(window,"resize",l));var nl=(l,e)=>{m(e,new Set,!0)},il=(l,e,a)=>{var r;(r=e.oninput)==null||r.call(e,t(a))},sl=p('<!> <button class="mb_lg" type="button">clear selection</button> <button type="button" class="accent">select <!> </button>',1),ol=p("<option> </option>"),_l=(l,e,a)=>e(t(a)),cl=p('<button type="button"> </button>'),vl=(l,e)=>e(l.currentTarget.value),dl=p('<!> <div class="notes_input pt_lg svelte-l5hmn0"><!> <div class="piano_wrapper svelte-l5hmn0"><!></div> <section class="box"><label class="mb_lg"><div class="title text_align_center">key</div> <select></select></label> <div class="scales mb_lg svelte-l5hmn0"></div> <!> <div class="notes width_sm svelte-l5hmn0"><blockquote class="panel my_lg"><textarea></textarea></blockquote></div></section> <form class="width_sm panel p_md"><fieldset><!> <!></fieldset> <fieldset><!></fieldset></form></div>',1);function ul(l,e){de(e,!0);const a=A=>{var d=sl(),y=ze(d);Zt(y,()=>e.before_buttons);var Q=n(y,2);Q.__click=[nl,s];var $=n(Q,2);$.__click=[il,e,f];var x=n(o($));{var S=X=>{var B=C("all");_(X,B)},Z=X=>{var B=C();G(()=>he(B,t(g))),_(X,B)};w(x,X=>{t(g)===0?X(S):X(Z,!1)})}var H=n(x);i($),G(X=>{Q.disabled=t(g)===0,$.disabled=!t(b),he(H,` tonic${X??""}`)},[()=>Wa(t(g))]),_(A,d)},r=te(e,"audio_state",7),{playing_notes:c}=r();let s=L(void 0);const f=u(()=>t(s)&&Array.from(t(s)).sort((A,d)=>A-d)),h=u(()=>t(s)??e.notes),g=u(()=>t(h).size),P=u(()=>t(f)&&ht(t(f))),z=A=>{m(s,new Set(Jt(A)),!0)},k=u(()=>ht(Array.from(e.notes).sort((A,d)=>A-d))),b=u(()=>!!t(f)&&t(P)!==t(k)),j=A=>{const d=new Set(t(h));d.has(A)?d.delete(A):d.add(A),m(s,d,!0)};let I=L(Me(Oa));const T=Ft.get(),J=20,M=(A,d=null)=>{Bt(r(),T(),A,Ht(r().volume,d),r().instrument)},E=A=>{const d=Ca(A,t(I),e.min_note,e.max_note);if(!t(s)||!t(f)){m(s,d,!0);return}let y=!0;for(const $ of d)if(!t(s).has($)){y=!1;break}const Q=y?t(f).filter($=>!d.has($)):t(f).concat(Array.from(d));m(s,new Set(Q),!0)};var O=dl(),D=ze(O);$t(D,{get midi_access(){return r().midi_access},onnotestart:(A,d)=>M(A,d),onnotestop:A=>bt(A)});var K=n(D,2),V=o(K);a(V);var q=n(V,2);Qt(q,"",{},{padding:"20px"});var W=o(q);{var me=A=>{const d=u(()=>Et.current-J*5);ea(A,{get width(){return t(d)},get min_note(){return e.min_note},get max_note(){return e.max_note},max_height:300,pressed_keys:c,get highlighted_keys(){return t(h)},middle_c_label:!0,allow_sticking:!0,onpress:y=>{j(y),M(y)},onrelease:y=>{bt(y)}})};w(W,A=>{Et.current&&A(me)})}i(q);var se=n(q,2),_e=o(se),N=n(o(_e),2);Fe(N,20,()=>Ra,A=>A,(A,d)=>{var y=ol(),Q={},$=o(y,!0);i(y),G(()=>{Q!==(Q=d)&&(y.value=(y.__value=d)??""),he($,d)}),_(A,y)}),i(N),i(_e);var F=n(_e,2);Fe(F,21,()=>Rt,A=>A.name,(A,d)=>{var y=cl();y.__click=[_l,E,d];var Q=o(y,!0);i(y),G(()=>he(Q,t(d).name)),_(A,y)}),i(F);var re=n(F,2);a(re);var fe=n(re,2),ge=o(fe),ae=o(ge);Ye(ae),ae.__change=[vl,z],i(ge),i(fe),i(se);var ee=n(se,2),U=o(ee),be=o(U);Yt(be,{get instrument(){return r().instrument},set instrument(A){r().instrument=A}});var Ie=n(be,2);Gt(Ie,{get volume(){return r().volume},set volume(A){r().volume=A}}),i(U);var Ae=n(U,2),pe=o(Ae);Kt(pe,{get midi_state(){return r()}}),i(Ae),i(ee),i(K),G(()=>lt(ae,t(P))),Ua(N,()=>t(I),A=>m(I,A)),_(l,O),ue()}Te(["click","change"]);var ml=(l,e)=>{var a;navigator.clipboard.writeText(e.text),(a=e.oncopy)==null||a.call(e)},fl=p('<button type="button" class="my_lg"><!></button>');function pt(l,e){de(e,!0);var a=fl();a.__click=[ml,e];var r=o(a);{var c=f=>{var h=Lt(),g=ze(h);Zt(g,()=>e.children),_(f,h)},s=f=>{var h=C("copy to clipboard");_(f,h)};w(r,f=>{e.children?f(c):f(s,!1)})}i(a),_(l,a),ue()}Te(["click"]);const gl=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Fa());const f=nt.parse(s);r.onsubmit(f)}catch(s){console.error("failed to import data",s),m(e,s.message||"unknown error",!0)}m(c,!1)},bl=(l,e,a,r,c)=>{m(e,m(a,JSON.stringify(r()),!0),!0),m(c,!0)};var hl=(l,e)=>m(e,Ct(l.currentTarget.value)),pl=(l,e)=>m(e,!0),yl=p("<!> <br>",1),kl=(l,e)=>m(e,Jt(l.currentTarget.value)),xl=(l,e)=>m(e,!0),wl=(l,e,a)=>e.onsubmit(a()),jl=(l,e)=>m(e,!t(e)),zl=(l,e,a)=>{m(e,!1),a.onremove(a.level_data.id)},Il=p('<div class="pb_md"><button type="button" class="color_c w_100 svelte-h4qokl">✕ confirm remove</button></div>'),ql=(l,e)=>e.onduplicate(e.level_data.id),Sl=p('<button type="button" class="svelte-h4qokl">duplicate level</button>'),Tl=p('<button type="button" class="svelte-h4qokl">remove level</button> <!> <!>',1),Al=p("<pre> </pre>"),Pl=p('<div class="overflow_x_auto"><!></div>'),Ml=(l,e,a,r)=>e.onplay(t(a)?r():e.level_data,t(a)),Dl=p('<button type="button" class="svelte-h4qokl">play!</button>'),El=(l,e)=>e.onclose(e.level_data.id),Ll=p('<button type="button" class="svelte-h4qokl"><!></button>'),Nl=p('<div class="importing pane shadow_d_xl p_xl width_md mx_auto svelte-h4qokl"><h2 class="my_0">import level data</h2> <!> <textarea class="svelte-h4qokl"></textarea> <button type="button" class="svelte-h4qokl">import project data</button></div>'),Ol=p('<div class="pane mx_auto shadow_d_xl p_xl width_md box"><h2 class="my_0">pick intervals</h2> <!> <button type="button" class="svelte-h4qokl">cancel</button></div>'),Rl=p('<button type="button" class="mb_lg svelte-h4qokl">cancel</button>'),Cl=p('<div class="pane mx_auto shadow_d_xl py_xl box"><h2 class="my_0">pick tonics</h2> <!></div>'),Fl=p(`<form class="level_def_form w_100"><header><h2 class="my_0"><!></h2></header> <div class="fields svelte-h4qokl"><fieldset><label><div class="title">name</div> <input></label></fieldset> <fieldset><label class="mb_0" title="the semitones to include relative to the tonic"><div class="title">intervals</div> <input></label> <button type="button" class="svelte-h4qokl">pick intervals</button> <details><summary>about <code>intervals</code></summary> <p><code>intervals</code> is a comma-separated list of numbers representing the <a href="https://wikipedia.org/wiki/Interval_(music)">musical intervals</a> used in the
					level, aka the number of piano keys (<a href="https://wikipedia.org/wiki/Semitone">semitones</a>) separating each note from the <a href="https://wikipedia.org/wiki/Tonic_(music)">tonic</a> (see below)</p> <p>for example, to practice distinguishing between the <a href="https://wikipedia.org/wiki/Perfect_fourth">perfect fourth</a> and <a href="https://wikipedia.org/wiki/Perfect_fifth">perfect fifth</a>, enter "<code>5, 7</code>"</p> <p>negative numbers are allowed</p></details></fieldset> <fieldset><label title="the number of trials per level"><div class="title">trial count</div> <div class="row"><input class="small_input svelte-h4qokl" type="number"> <input type="range"></div></label></fieldset> <fieldset><label title="the number of notes per trial"><div class="title">sequence length</div> <div class="row"><input class="small_input svelte-h4qokl" type="number"> <input type="range"></div></label></fieldset> <fieldset class="row"><label class="text_align_center"><div class="title">lowest note</div> <div> </div> <input type="number"> <input type="range"></label> <label class="text_align_center"><div class="title">highest note</div> <div> </div> <input type="number"> <input type="range"></label></fieldset> <!> <fieldset><label class="mb_0" title="the possible starting notes for each trial"><div class="title">tonics</div> <input placeholder="all"></label> <button type="button" class="svelte-h4qokl">pick tonics</button> <details><summary>about <code>tonics</code></summary> <p>The <a href="https://wikipedia.org/wiki/Tonic_(music)">tonic</a> is like the "base" or "home"
					note, and for our purposes it's always the first note played in a trial. Other notes in the
					trial are calculated from the tonic and intervals. (see above)</p></details></fieldset> <button type="button" class="accent svelte-h4qokl"><!></button> <!> <button type="button" class="svelte-h4qokl"><!></button> <!> <!> <!></div></form> <!> <!> <!>`,1);function Jl(l,e){de(e,!0);const a=te(e,"editing",3,!1),r=Vt.get();let c=L(!1),s=L(Me(e.level_data.name));const f=u(()=>{var v;return(v=t(s))==null?void 0:v.trim()});let h=L(e.level_data.intervals),g=L(e.level_data.tonics);const P=u(()=>t(g)?t(g).filter(v=>v>=t(b)&&v<=t(j)):t(g));let z=L(Me(e.level_data.trial_count)),k=L(Me(e.level_data.sequence_length)),b=L(Me(e.level_data.min_note)),j=L(Me(e.level_data.max_note));const I=()=>nt.parse({id:e.level_data.id,name:t(f),intervals:t(h),tonics:t(P),trial_count:t(z),sequence_length:t(k),min_note:t(b),max_note:t(j)});Ce(()=>{m(s,e.level_data.name,!0),m(h,e.level_data.intervals),m(g,e.level_data.tonics),m(z,e.level_data.trial_count,!0),m(k,e.level_data.sequence_length,!0),m(b,e.level_data.min_note,!0),m(j,e.level_data.max_note,!0)});const T=u(()=>t(f)!==e.level_data.name||t(z)!==e.level_data.trial_count||t(k)!==e.level_data.sequence_length||t(b)!==e.level_data.min_note||t(j)!==e.level_data.max_note||!Le(t(h),e.level_data.intervals)||!Le(t(P),e.level_data.tonics));let J=L(!1),M=L(!1),E=L(!1),O=L(""),D=L("");const K=u(()=>t(O)!==t(D));let V=L("");Ce(()=>{e.level_data,m(V,"")});let q=L(void 0),W=L(void 0),me=L(void 0),se=L(void 0);const _e=u(()=>t(g)&&new Set(t(g)));let N=L(Me(Ot)),F=L(1),re=L(void 0);const fe=u(()=>t(b)>=t(j));var ge=Fl(),ae=ze(ge),ee=o(ae),U=o(ee),be=o(U);{var Ie=v=>{var R=C("editing level");_(v,R)},Ae=v=>{var R=C("create a new level");_(v,R)};w(be,v=>{a()?v(Ie):v(Ae,!1)})}i(U),i(ee);var pe=n(ee,2),A=o(pe),d=o(A),y=n(o(d),2);Se(y),i(d),i(A);var Q=n(A,2),$=o(Q),x=n(o($),2);Se(x),x.__change=[hl,h],Ee(x,v=>m(me,v),()=>t(me)),i($);var S=n($,2);S.__click=[pl,M],Re(2),i(Q);var Z=n(Q,2),H=o(Z),X=n(o(H),2),B=o(X);Se(B),Y(B,"min",1);var oe=n(B,2);Se(oe),Y(oe,"min",1),Y(oe,"max",20),i(X),i(H),i(Z);var ne=n(Z,2),Pe=o(ne),Ge=n(o(Pe),2),Ke=o(Ge);Se(Ke),Y(Ke,"min",2);var Qe=n(Ke,2);Se(Qe),Y(Qe,"min",2),Y(Qe,"max",16),i(Ge),i(Pe),i(ne);var ot=n(ne,2),_t=o(ot),ct=n(o(_t),2),ta=o(ct,!0);i(ct);var Ne=n(ct,2);Se(Ne),Y(Ne,"step",1),Y(Ne,"min",tt),Y(Ne,"max",at);var Je=n(Ne,2);Se(Je),Y(Je,"step",1),Y(Je,"min",tt),Y(Je,"max",at),i(_t);var yt=n(_t,2),vt=n(o(yt),2),aa=o(vt,!0);i(vt);var Oe=n(vt,2);Se(Oe),Y(Oe,"step",1),Y(Oe,"min",tt),Y(Oe,"max",at);var Be=n(Oe,2);Se(Be),Y(Be,"step",1),Y(Be,"min",tt),Y(Be,"max",at),i(yt),i(ot);var kt=n(ot,2);{var la=v=>{rt(v,{status:"error",children:(R,ce)=>{Re();var ve=C("the lowest note must be lower than the highest");_(R,ve)},$$slots:{default:!0}})},ra=v=>{var R=yl(),ce=ze(R);const ve=u(()=>t(re)??0);ea(ce,{get width(){return t(ve)},max_height:50,get min_note(){return t(b)},get max_note(){return t(j)},get highlighted_keys(){return t(_e)},clickable:!1,middle_c_label:!0}),Re(2),_(v,R)};w(kt,v=>{t(fe)?v(la):v(ra,!1)})}var Ze=n(kt,2),dt=o(Ze),$e=n(o(dt),2);Se($e),$e.__change=[kl,g],Ee($e,v=>m(se,v),()=>t(se)),i(dt);var na=n(dt,2);na.__click=[xl,E],Re(2),i(Ze);var He=n(Ze,2);He.__click=[wl,e,I];var ia=o(He);{var sa=v=>{var R=C("save changes to level");_(v,R)},oa=v=>{var R=C("create level");_(v,R)};w(ia,v=>{a()?v(sa):v(oa,!1)})}i(He);var xt=n(He,2);{var _a=v=>{var R=Tl(),ce=ze(R);ce.__click=[jl,c];var ve=n(ce,2);{var ye=le=>{var qe=Il(),et=o(qe);et.__click=[zl,c,e],i(qe),we(3,qe,()=>je),_(le,qe)};w(ve,le=>{t(c)&&le(ye)})}var ie=n(ve,2);{var ke=le=>{var qe=Sl();qe.__click=[ql,e],_(le,qe)};w(ie,le=>{e.onduplicate&&le(ke)})}_(v,R)};w(xt,v=>{e.onremove&&a()&&v(_a)})}var Ve=n(xt,2);Ve.__click=[bl,O,D,I,J];var ca=o(Ve);{var va=v=>{var R=C("import/export data");_(v,R)},da=v=>{var R=C("import data");_(v,R)};w(ca,v=>{a()?v(va):v(da,!1)})}i(Ve),Ee(Ve,v=>m(W,v),()=>t(W));var wt=n(Ve,2);{var ua=v=>{var R=Pl(),ce=o(R);rt(ce,{status:"error",children:(ve,ye)=>{var ie=Al(),ke=o(ie,!0);i(ie),G(()=>he(ke,t(V))),_(ve,ie)},$$slots:{default:!0}}),i(R),_(v,R)};w(wt,v=>{t(V)&&v(ua)})}var jt=n(wt,2);{var ma=v=>{var R=Dl();R.__click=[Ml,e,T,I],_(v,R)};w(jt,v=>{e.onplay&&a()&&v(ma)})}var fa=n(jt,2);{var ga=v=>{var R=Ll();R.__click=[El,e];var ce=o(R);{var ve=ie=>{var ke=C("discard changes and stop editing");_(ie,ke)},ye=ie=>{var ke=C("close level editor");_(ie,ke)};w(ce,ie=>{t(T)?ie(ve):ie(ye,!1)})}i(R),_(v,R)};w(fa,v=>{e.onclose&&a()&&v(ga)})}i(pe),i(ae);var zt=n(ae,2);{var ba=v=>{Ue(v,{onclose:()=>{var R;m(J,!1),(R=t(W))==null||R.focus()},children:(R,ce)=>{var ve=Nl(),ye=n(o(ve),2);pt(ye,{get text(){return t(D)},oncopy:()=>{var le;(le=t(q))==null||le.select()}});var ie=n(ye,2);Ye(ie),Ee(ie,le=>m(q,le),()=>t(q));var ke=n(ie,2);ke.__click=[gl,V,D,e,J],i(ve),G(()=>{ke.disabled=!t(K),Y(ke,"title",t(K)?void 0:"data has not changed")}),xe(ie,()=>t(D),le=>m(D,le)),_(R,ve)},$$slots:{default:!0}})};w(zt,v=>{t(J)&&v(ba)})}var It=n(zt,2);{var ha=v=>{Ue(v,{onclose:()=>{var ce;m(M,!1),(ce=t(me))==null||ce.focus()},children:(ce,ve=At)=>{var ye=Ol(),ie=n(o(ye),2);rl(ie,{get intervals(){return t(h)},oninput:le=>{m(h,le),ve()()},get scale(){return t(N)},set scale(le){m(N,le,!0)},get octaves(){return t(F)},set octaves(le){m(F,le,!0)}});var ke=n(ie,2);ke.__click=function(...le){var qe;(qe=ve())==null||qe.apply(this,le)},i(ye),_(ce,ye)},$$slots:{default:!0}})};w(It,v=>{t(M)&&v(ha)})}var pa=n(It,2);{var ya=v=>{Ue(v,{onclose:()=>{var ce;m(E,!1),(ce=t(se))==null||ce.focus()},children:(ce,ve=At)=>{var ye=Cl(),ie=n(o(ye),2);const ke=u(()=>new Set(t(g)));ul(ie,{audio_state:r,get notes(){return t(ke)},get min_note(){return t(b)},get max_note(){return t(j)},oninput:qe=>{m(g,qe),ve()()},before_buttons:qe=>{var et=Rl();et.__click=function(...ka){var qt;(qt=ve())==null||qt.apply(this,ka)},_(qe,et)},$$slots:{before_buttons:!0}}),i(ye),_(ce,ye)},$$slots:{default:!0}})};w(pa,v=>{t(E)&&v(ya)})}G((v,R)=>{lt(x,v),he(ta,Pt[t(b)]),he(aa,Pt[t(j)]),lt($e,R),He.disabled=a()&&!t(T)||t(fe)},[()=>gt(t(h)),()=>ht(t(g))]),xe(y,()=>t(s),v=>m(s,v)),xe(B,()=>t(z),v=>m(z,v)),xe(oe,()=>t(z),v=>m(z,v)),xe(Ke,()=>t(k),v=>m(k,v)),xe(Qe,()=>t(k),v=>m(k,v)),xe(Ne,()=>t(b),v=>m(b,v)),xe(Je,()=>t(b),v=>m(b,v)),xe(Oe,()=>t(j),v=>m(j,v)),xe(Be,()=>t(j),v=>m(j,v)),Ya(Ze,"clientWidth",v=>m(re,v)),_(l,ge),ue()}Te(["change","click"]);var Bl=(l,e,a)=>e()(a.project.id),Hl=p('<button type="button"> </button>'),Vl=(l,e,a,r,c)=>{var s,f;return t(e)?(s=a())==null?void 0:s(r.project.id):(f=c())==null?void 0:f(r.project_data??r.load(r.project.id))},Ul=p('<button type="button"><!></button>'),Wl=(l,e)=>m(e,!t(e)),Xl=p('<button type="button" class="icon_button plain_button font_size_xl svelte-12y7az0"><!></button>'),Yl=p("<li><!>  <!> <!></li>");function Gl(l,e){de(e,!0);const a=te(e,"select",3,null),r=te(e,"edit",3,null),c=te(e,"remove",3,null);let s=L(!1);var f=Yl();let h;var g=o(f);{var P=I=>{var T=Hl();let J;T.__click=[Bl,a,e];var M=o(T,!0);i(T),G(E=>{J=De(T,1,"flex_1",null,J,E),he(M,e.project.name)},[()=>({selected:e.selected})]),_(I,T)};w(g,I=>{a()&&I(P)})}var z=n(g,2);{var k=I=>{var T=Ul();let J;T.__click=[Vl,s,c,e,r];var M=o(T);{var E=D=>{var K=C("✕");_(D,K)},O=D=>{var K=C("✎");_(D,K)};w(M,D=>{t(s)?D(E):D(O,!1)})}i(T),G(D=>{J=De(T,1,"icon_button plain_button font_size_xl deselectable svelte-12y7az0",null,J,D),Y(T,"title",t(s)?"remove project":"edit project")},[()=>({selected:e.selected&&!t(s)&&e.editing,color_c:t(s)})]),_(I,T)};w(z,I=>{(t(s)&&c()||!t(s)&&r())&&I(k)})}var b=n(z,2);{var j=I=>{var T=Xl();T.__click=[Wl,s];var J=o(T);{var M=O=>{var D=C("×");_(O,D)},E=O=>{var D=C("✕");_(O,D)};w(J,O=>{t(s)?O(M):O(E,!1)})}i(T),G(()=>Y(T,"title",t(s)?"cancel removing":"remove project")),_(I,T)};w(b,I=>{c()&&I(j)})}i(f),G(I=>h=De(f,1,"project_item svelte-12y7az0",null,h,I),[()=>({selected:e.selected})]),we(3,f,()=>je),_(l,f),ue()}Te(["click"]);var Kl=p('<menu class="unstyled width_sm mb_0"></menu>');function Ql(l,e){de(e,!0);const a=te(e,"selected_project_id",3,null),r=te(e,"editing_project_id",3,null),c=te(e,"projects",19,()=>[]),s=te(e,"project_datas",19,()=>[]);var f=Kl();Fe(f,21,c,h=>h.id,(h,g)=>{const P=u(()=>s().find(b=>b.id===t(g).id)),z=u(()=>t(g).id===a()),k=u(()=>t(g).id===r());Gl(h,{get project(){return t(g)},get project_data(){return t(P)},get load(){return e.load_project},get select(){return e.select_project},get edit(){return e.edit_project},get remove(){return e.remove_project},get selected(){return t(z)},get editing(){return t(k)}})}),i(f),_(l,f),ue()}var Zl=(l,e,a,r)=>{t(e)?a().editing_project=!1:t(r)(it.parse({}))},$l=p('<div class="panel p_md"><header><h2 class="my_0">projects</h2></header> <!> <button type="button">create a new project</button></div>');function er(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().load_project),c=u(()=>a().select_project),s=u(()=>a().edit_project),f=u(()=>a().remove_project),h=u(()=>a().editing_project&&a().selected_project_id!==a().editing_project_id),g=u(()=>a().app_data),P=u(()=>t(g).projects);var z=$l(),k=n(o(z),2);const b=u(()=>a().editing_project?a().editing_project_id:null);Ql(k,{get selected_project_id(){return a().selected_project_id},get editing_project_id(){return t(b)},get projects(){return t(P)},get project_datas(){return a().project_datas},get load_project(){return t(r)},get select_project(){return t(c)},edit_project:T=>t(s)(T===a().editing_project_data&&a().editing_project?null:T),get remove_project(){return t(f)}});var j=n(k,2);let I;j.__click=[Zl,h,a,s],i(z),G(T=>I=De(j,1,"w_100 mt_md deselectable",null,I,T),[()=>({selected:t(h)})]),_(l,z),ue()}Te(["click"]);var tr=(l,e)=>e.toggle(),ar=p(`<aside>devices with smaller screens aren't well supported yet, see <a href="https://github.com/ryanatkn/earbetter/issues/2">issue #2</a></aside> <table><tbody><tr><td class="svelte-1gwge1y"><code>Spacebar</code></td><td class="svelte-1gwge1y">replay trial</td></tr><tr><td class="svelte-1gwge1y"><code>r</code></td><td class="svelte-1gwge1y">restart level</td></tr><tr><td class="svelte-1gwge1y"><code>Escape</code></td><td class="svelte-1gwge1y"><button type="button" class="inline">toggle main menu</button></td></tr><tr><td class="svelte-1gwge1y"><code>1 to 4</code></td><td class="svelte-1gwge1y">set instrument</td></tr><tr><td class="svelte-1gwge1y"><code>c</code></td><td class="svelte-1gwge1y">connect MIDI</td></tr><tr><td class="svelte-1gwge1y"><code>up/down arrows</code></td><td class="svelte-1gwge1y">adjust volume</td></tr></tbody></table>`,1);function lr(l,e){de(e,!0);const a=Ma.get();var r=ar(),c=n(ze(r),2),s=o(c),f=n(o(s),2),h=n(o(f)),g=o(h);g.__click=[tr,a],Qt(g,"",{},{"min-width":"172px"}),i(h),i(f),Re(3),i(s),i(c),_(l,r),ue()}Te(["click"]);var rr=p('<div class="realm_stats_summary svelte-1mwdoug" title="you performed flawlessly in every level of this realm!">★</div>');function nr(l,e){de(e,!0);const a=u(()=>e.realm_data.levels.map(k=>e.level_stats.mistakes[k.id]??[])),r=u(()=>t(a).reduce((k,b)=>k+b.length,0)),c=u(()=>Ut*t(a).length),s=u(()=>!!t(r)&&t(r)>=t(c)),f=u(()=>t(s)?t(a).reduce((k,b)=>k+b.reduce((j,I)=>j+I,0),0):void 0),h=u(()=>t(f)===0);var g=Lt(),P=ze(g);{var z=k=>{var b=rr();_(k,b)};w(P,k=>{t(h)&&k(z)})}_(l,g),ue()}var ir=(l,e,a)=>e()(a.realm_data.id),sr=p('<button type="button"> </button>'),or=(l,e,a,r,c)=>{var s,f;return t(e)?(s=a())==null?void 0:s(r.realm_data.id):(f=c())==null?void 0:f(r.realm_data)},_r=p('<button type="button"><!></button>'),cr=(l,e)=>m(e,!t(e)),vr=p('<button type="button" class="icon_button plain_button font_size_xl svelte-1joa4ch"><!></button>'),dr=p("<li><!> <!>  <!> <!></li>");function ur(l,e){de(e,!0);const a=te(e,"select",3,null),r=te(e,"edit",3,null),c=te(e,"remove",3,null);let s=L(!1);const f=u(()=>e.project_data.level_stats);var h=dr();let g;var P=o(h);{var z=M=>{nr(M,{get realm_data(){return e.realm_data},get level_stats(){return t(f)}})};w(P,M=>{t(f)&&M(z)})}var k=n(P,2);{var b=M=>{var E=sr();let O;E.__click=[ir,a,e];var D=o(E,!0);i(E),G(K=>{O=De(E,1,"realm_button svelte-1joa4ch",null,O,K),he(D,e.realm_data.name)},[()=>({selected:e.selected})]),_(M,E)};w(k,M=>{a()&&M(b)})}var j=n(k,2);{var I=M=>{var E=_r();let O;E.__click=[or,s,c,e,r];var D=o(E);{var K=q=>{var W=C("✕");_(q,W)},V=q=>{var W=C("✎");_(q,W)};w(D,q=>{t(s)?q(K):q(V,!1)})}i(E),G(q=>{O=De(E,1,"icon_button plain_button font_size_xl deselectable svelte-1joa4ch",null,O,q),Y(E,"title",t(s)?"remove realm":e.editing?"stop editing realm":"edit realm")},[()=>({selected:e.selected&&!t(s)&&e.editing,color_c:t(s)})]),_(M,E)};w(j,M=>{(t(s)&&c()||!t(s)&&r())&&M(I)})}var T=n(j,2);{var J=M=>{var E=vr();E.__click=[cr,s];var O=o(E);{var D=V=>{var q=C("×");_(V,q)},K=V=>{var q=C("✕");_(V,q)};w(O,V=>{t(s)?V(D):V(K,!1)})}i(E),G(()=>Y(E,"title",t(s)?"cancel removing":"remove realm")),_(M,E)};w(T,M=>{c()&&M(J)})}i(h),G(M=>g=De(h,1,"realm_item svelte-1joa4ch",null,g,M),[()=>({selected:e.selected})]),we(3,h,()=>je),_(l,h),ue()}Te(["click"]);var mr=p('<menu class="unstyled width_sm mb_0"></menu>');function fr(l,e){de(e,!0);const a=te(e,"selected_realm_data",3,null),r=te(e,"editing_realm_id",3,null),c=te(e,"realms",19,()=>[]),s=u(()=>new Map(c().map(g=>[g.id,g]))),f=g=>t(s).get(g);var h=mr();Fe(h,21,c,g=>g.id,(g,P)=>{const z=u(()=>f(t(P).id)),k=u(()=>{var j;return t(P).id===((j=a())==null?void 0:j.id)}),b=u(()=>t(P).id===r());ur(g,{get realm_data(){return t(z)},get project_data(){return e.project_data},get select(){return e.select_realm},get edit(){return e.edit_realm},get remove(){return e.remove_realm},get selected(){return t(k)},get editing(){return t(b)}})}),i(h),_(l,h),ue()}const gr=(l,e,a,r,c)=>{var s;t(e)?(s=document.querySelector(".realm_def_form input"))==null||s.focus():t(a)?r().editing_realm=!1:t(c)(st.parse({}))};var br=p("<div><!></div>"),hr=p('<div class="panel p_md"><header><h2 class="my_0">realms</h2></header> <!> <button type="button">create a new realm</button></div>');function pr(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().select_realm),c=u(()=>a().edit_realm),s=u(()=>a().remove_realm),f=u(()=>{var j;return a().editing_realm&&!!a().editing_realm_data&&((j=a().selected_realm_data)==null?void 0:j.id)!==a().editing_realm_data.id}),h=u(()=>{var j;return!((j=a().realms)!=null&&j.length)});var g=hr(),P=n(o(g),2);{var z=j=>{var I=br(),T=o(I);const J=u(()=>a().editing_realm?a().editing_realm_id:null);fr(T,{get project_data(){return a().selected_project_data},get selected_realm_data(){return a().selected_realm_data},get realms(){return a().realms},get editing_realm_id(){return t(J)},get select_realm(){return t(r)},edit_realm:M=>t(c)(M===a().editing_realm_data&&a().editing_realm?null:M),get remove_realm(){return t(s)}}),i(I),we(3,I,()=>je),_(j,I)};w(P,j=>{a().realms&&a().selected_project_data&&j(z)})}var k=n(P,2);let b;k.__click=[gr,h,f,a,c],i(g),G(j=>b=De(k,1,Xa(t(h)?void 0:"deselectable"),"svelte-100yq62",b,j),[()=>({selected:t(f)||t(h)})]),_(l,g),ue()}Te(["click"]);const yr=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Ja());const f=st.parse(s);r.onsubmit(f)}catch(s){console.error("failed to import data",s),m(e,s.message||"unknown error",!0)}m(c,!1)},kr=(l,e,a,r,c)=>{m(e,m(a,JSON.stringify(r()),!0),!0),m(c,!0)};var xr=p('<div class="importing pane shadow_d_xl p_xl width_md mx_auto svelte-1g446ss"><h2 class="my_0">import realm data</h2> <!> <textarea class="svelte-1g446ss"></textarea> <button type="button" class="svelte-1g446ss">import realm data</button></div>'),wr=(l,e,a)=>{l.key==="Enter"&&(Xt(l),e.onsubmit(a()))},jr=(l,e,a)=>e.onsubmit(a()),zr=(l,e)=>m(e,!t(e)),Ir=(l,e,a)=>{m(e,!1),a.onremove(a.realm_data.id)},qr=p('<div class="pb_md"><button type="button" class="color_c w_100 svelte-1g446ss">✕ confirm remove</button></div>'),Sr=(l,e)=>e.onduplicate(e.realm_data.id),Tr=p('<button type="button" class="svelte-1g446ss">duplicate realm</button>'),Ar=p('<button type="button" class="svelte-1g446ss">remove realm</button> <!> <!>',1),Pr=(l,e)=>m(e,!t(e)),Mr=(l,e,a)=>{m(e,!1),a.onsubmit(Wt().realms)},Dr=p('<div><button type="button" class="w_100 svelte-1g446ss"> </button></div>'),Er=p('<button type="button" class="svelte-1g446ss">create default realms</button> <!>',1),Lr=p("<pre> </pre>"),Nr=p('<div class="message-wrapper svelte-1g446ss"><!></div>'),Or=(l,e)=>e.onclose(e.realm_data.id),Rr=p('<button class="w_100 svelte-1g446ss" type="button"><!></button>'),Cr=p('<!> <form class="realm_def_form"><header><h2 class="my_0"><!></h2></header> <fieldset><label><div class="title">name</div> <input></label></fieldset> <button type="button" class="accent svelte-1g446ss"><!></button> <!> <button type="button" class="svelte-1g446ss"><!></button> <!> <!> <!></form>',1);function Fr(l,e){de(e,!0);const a=te(e,"editing",3,!1);let r=L(!1),c=L(Me(e.realm_data.name));const s=u(()=>{var x;return(x=t(c))==null?void 0:x.trim()}),f=()=>st.parse({id:e.realm_data.id,name:t(s),levels:e.realm_data.levels});Ce(()=>{console.log("set_realm_data",e.realm_data),m(c,e.realm_data.name,!0)});const h=u(()=>t(s)!==e.realm_data.name);let g=L(!1),P=L(""),z=L("");const k=u(()=>t(P)!==t(z));let b=L("");Ce(()=>{e.realm_data,m(b,"")});let j=L(void 0),I=L(void 0);const T=Wt().realms;let J=L(!1);var M=Cr(),E=ze(M);{var O=x=>{Ue(x,{onclose:()=>{var S;m(g,!1),(S=t(I))==null||S.focus()},children:(S,Z)=>{var H=xr(),X=n(o(H),2);pt(X,{get text(){return t(z)},oncopy:()=>{var ne;(ne=t(j))==null||ne.select()}});var B=n(X,2);Ye(B),Ee(B,ne=>m(j,ne),()=>t(j));var oe=n(B,2);oe.__click=[yr,b,z,e,g],i(H),G(()=>{oe.disabled=!t(k),Y(oe,"title",t(k)?void 0:"data has not changed")}),xe(B,()=>t(z),ne=>m(z,ne)),_(S,H)},$$slots:{default:!0}})};w(E,x=>{t(g)&&x(O)})}var D=n(E,2),K=o(D),V=o(K),q=o(V);{var W=x=>{var S=C("editing realm");_(x,S)},me=x=>{var S=C("create a new realm");_(x,S)};w(q,x=>{a()?x(W):x(me,!1)})}i(V),i(K);var se=n(K,2),_e=o(se),N=n(o(_e),2);Se(N),N.__keydown=[wr,e,f],i(_e),i(se);var F=n(se,2);F.__click=[jr,e,f];var re=o(F);{var fe=x=>{var S=C("save changes to realm");_(x,S)},ge=x=>{var S=C("create realm");_(x,S)};w(re,x=>{a()?x(fe):x(ge,!1)})}i(F);var ae=n(F,2);{var ee=x=>{var S=Ar(),Z=ze(S);Z.__click=[zr,r];var H=n(Z,2);{var X=ne=>{var Pe=qr(),Ge=o(Pe);Ge.__click=[Ir,r,e],i(Pe),we(3,Pe,()=>je),_(ne,Pe)};w(H,ne=>{t(r)&&ne(X)})}var B=n(H,2);{var oe=ne=>{var Pe=Tr();Pe.__click=[Sr,e],_(ne,Pe)};w(B,ne=>{e.onduplicate&&ne(oe)})}_(x,S)};w(ae,x=>{e.onremove&&a()&&x(ee)})}var U=n(ae,2);U.__click=[kr,P,z,f,g];var be=o(U);{var Ie=x=>{var S=C("import/export data");_(x,S)},Ae=x=>{var S=C("import data");_(x,S)};w(be,x=>{a()?x(Ie):x(Ae,!1)})}i(U),Ee(U,x=>m(I,x),()=>t(I));var pe=n(U,2);{var A=x=>{var S=Er(),Z=ze(S);Z.__click=[Pr,J];var H=n(Z,2);{var X=B=>{var oe=Dr(),ne=o(oe);ne.__click=[Mr,J,e];var Pe=o(ne);i(ne),i(oe),G(()=>he(Pe,`create ${T.length??""} new realms`)),we(3,oe,()=>je),_(B,oe)};w(H,B=>{t(J)&&B(X)})}_(x,S)};w(pe,x=>{a()||x(A)})}var d=n(pe,2);{var y=x=>{var S=Nr(),Z=o(S);rt(Z,{status:"error",children:(H,X)=>{var B=Lr(),oe=o(B,!0);i(B),G(()=>he(oe,t(b))),_(H,B)},$$slots:{default:!0}}),i(S),_(x,S)};w(d,x=>{t(b)&&x(y)})}var Q=n(d,2);{var $=x=>{var S=Rr();S.__click=[Or,e];var Z=o(S);{var H=B=>{var oe=C("discard changes");_(B,oe)},X=B=>{var oe=C("close realm editor");_(B,oe)};w(Z,B=>{t(h)?B(H):B(X,!1)})}i(S),_(x,S)};w(Q,x=>{e.onclose&&a()&&x($)})}i(D),G(()=>F.disabled=a()&&!t(h)),xe(N,()=>t(c),x=>m(c,x)),_(l,M),ue()}Te(["click","keydown"]);var Jr=p('<div class="panel p_md"><!></div>');function Br(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().remove_realm),c=u(()=>a().duplicate_realm),s=u(()=>a().update_realm),f=u(()=>a().create_realm),h=u(()=>a().editing_realm_data??st.parse({})),g=u(()=>a().realms?a().realms.some(b=>b.id===t(h).id):!1),P=(b,j)=>{var I;(I=a().realms)!=null&&I.some(T=>T.id===b.id)?t(s)(b):t(f)(b,j)};var z=Jr(),k=o(z);Fr(k,{get editing(){return t(g)},get realm_data(){return t(h)},onsubmit:b=>{if(Array.isArray(b))for(let j=0;j<b.length;j++)P(b[j],j===0);else P(b,!0)},onremove:b=>t(r)(b),onduplicate:b=>t(c)(b),onclose:()=>a().editing_realm=!1}),i(z),_(l,z),ue()}var Hr=(l,e)=>e.app.play_level(e.level_data.id),Vr=async(l,e,a,r)=>{if(t(e))a.app.remove_level(a.level_data.id);else{const c=!t(r);if(a.app.edit_level(c?a.level_data:null),c){await Nt();const s=document.querySelector(".level_def_form");s==null||s.scrollIntoView({behavior:"smooth",block:"center"})}}},Ur=(l,e)=>m(e,!t(e)),Wr=p('<li><!> <button type="button" title="play this level"> </button> <button type="button"><!></button> <button type="button" class="icon_button plain_button font_size_xl svelte-170pvnv"><!></button></li>');function Xr(l,e){de(e,!0);const a=u(()=>e.app.draft_level_data===e.level_data),r=u(()=>e.app.editing_level&&t(a)),c=u(()=>{var q;return(q=e.app.selected_project_data)==null?void 0:q.level_stats});let s=L(!1);const f=u(()=>t(r)||t(a));var h=Wr();let g;var P=o(h);{var z=q=>{Ka(q,{get level_data(){return e.level_data},get level_stats(){return t(c)}})};w(P,q=>{t(c)&&q(z)})}var k=n(P,2);let b;k.__click=[Hr,e];var j=o(k,!0);i(k);var I=n(k,2);let T;I.__click=[Vr,s,e,r];var J=o(I);{var M=q=>{var W=C("✕");_(q,W)},E=q=>{var W=C("✎");_(q,W)};w(J,q=>{t(s)?q(M):q(E,!1)})}i(I);var O=n(I,2);O.__click=[Ur,s];var D=o(O);{var K=q=>{var W=C("×");_(q,W)},V=q=>{var W=C("✕");_(q,W)};w(D,q=>{t(s)?q(K):q(V,!1)})}i(O),i(h),G((q,W,me)=>{g=De(h,1,"level_map_item svelte-170pvnv",null,g,q),b=De(k,1,"level_button deselectable svelte-170pvnv",null,b,W),he(j,e.level_data.name),T=De(I,1,"icon_button plain_button font_size_xl svelte-170pvnv",null,T,me),Y(I,"title",t(s)?"remove level":t(r)?"stop editing level":"edit level"),Y(O,"title",t(s)?"cancel removing":"remove level")},[()=>({selected:t(f)}),()=>({selected:t(f)}),()=>({selected:!t(s)&&t(r),color_c:t(s)})]),we(3,h,()=>je),_(l,h),ue()}Te(["click"]);const Yr=(l,e,a,r)=>{var c;t(e)?(c=document.querySelector(".level_def_form input"))==null||c.focus():a.app.edit_level(t(r)?null:nt.parse({}))};var Gr=p('<div class="panel p_md"><header><h2 class="my_0">levels</h2> <h3 class="my_0"> </h3></header> <menu class="levels unstyled mb_0 svelte-wmjxbn"></menu> <button type="button">create a new level</button></div>');function Kr(l,e){de(e,!0);const a=u(()=>e.app.editing_level&&!e.levels.some(k=>k===e.app.draft_level_data)),r=u(()=>!e.levels.length);var c=Gr(),s=o(c),f=n(o(s),2),h=o(f,!0);i(f),i(s);var g=n(s,2);Fe(g,21,()=>e.levels,k=>k.id,(k,b)=>{Xr(k,{get app(){return e.app},get level_data(){return t(b)}})}),i(g);var P=n(g,2);P.__click=[Yr,r,e,a];let z;i(c),G(k=>{var b;he(h,(b=e.app.selected_realm_data)==null?void 0:b.name),z=De(P,1,"svelte-wmjxbn",null,z,k)},[()=>({selected:t(a)||t(r),deselectable:!t(r)})]),_(l,c),ue()}Te(["click"]);const Qr=(l,e,a,r,c)=>{m(e,"");try{const s=JSON.parse(t(a));s&&!s.id&&(s.id=Ba());const f=it.parse(s);r.onsubmit(f)}catch(s){console.error("failed to import data",s),m(e,s.message||"unknown error",!0)}m(c,!1)},Zr=(l,e,a,r,c)=>{m(e,m(a,JSON.stringify(r()),!0),!0),m(c,!0)};var $r=p('<div class="importing pane shadow_d_xl p_xl width_md mx_auto svelte-l3tcx7"><h2 class="my_0">import project data</h2> <!> <textarea class="svelte-l3tcx7"></textarea> <button type="button" class="svelte-l3tcx7">import project data</button></div>'),en=(l,e,a)=>{l.key==="Enter"&&(Xt(l),e.onsubmit(a()))},tn=(l,e,a)=>e.onsubmit(a()),an=(l,e)=>m(e,!t(e)),ln=(l,e,a)=>{m(e,!1),a.onremove(a.project_data.id)},rn=p('<div class="pb_md"><button type="button" class="color_c w_100 svelte-l3tcx7">✕ confirm remove</button></div>'),nn=(l,e)=>e.onduplicate(e.project_data.id),sn=p('<button type="button" class="w_100 svelte-l3tcx7">duplicate project</button>'),on=p('<button class="w_100 svelte-l3tcx7" type="button">remove project</button> <!> <!>',1),_n=p("<pre> </pre>"),cn=p('<div class="overflow_x_auto"><!></div>'),vn=(l,e)=>e.onclose(e.project_data.id),dn=p('<button type="button" class="w_100 svelte-l3tcx7"><!></button>'),un=p('<!> <form><header><h2 class="my_0"><!></h2></header> <fieldset><label><div class="title">name</div> <input></label></fieldset> <button type="button" class="accent w_100 svelte-l3tcx7"><!></button> <!> <button type="button" class="w_100 svelte-l3tcx7"><!></button> <!> <!></form>',1);function mn(l,e){de(e,!0);const a=te(e,"editing",3,!1);let r=L(!1),c=L(Me(e.project_data.name));const s=u(()=>t(c).trim()),f=()=>it.parse({id:e.project_data.id,name:t(s),realms:e.project_data.realms,level_stats:e.project_data.level_stats});Ce(()=>{console.log("set_project_data",e.project_data),m(c,e.project_data.name,!0)});const h=u(()=>t(s)!==e.project_data.name);let g=L(!1),P=L(""),z=L("");const k=u(()=>t(P)!==t(z));let b=L("");Ce(()=>{e.project_data,m(b,"")});let j=L(void 0),I=L(void 0);var T=un(),J=ze(T);{var M=d=>{Ue(d,{onclose:()=>{var y;m(g,!1),(y=t(I))==null||y.focus()},children:(y,Q)=>{var $=$r(),x=n(o($),2);pt(x,{get text(){return t(z)},oncopy:()=>{var H;(H=t(j))==null||H.select()}});var S=n(x,2);Ye(S),Ee(S,H=>m(j,H),()=>t(j));var Z=n(S,2);Z.__click=[Qr,b,z,e,g],i($),G(()=>{Z.disabled=!t(k),Y(Z,"title",t(k)?void 0:"data has not changed")}),xe(S,()=>t(z),H=>m(z,H)),_(y,$)},$$slots:{default:!0}})};w(J,d=>{t(g)&&d(M)})}var E=n(J,2),O=o(E),D=o(O),K=o(D);{var V=d=>{var y=C("editing project");_(d,y)},q=d=>{var y=C("create a new project");_(d,y)};w(K,d=>{a()?d(V):d(q,!1)})}i(D),i(O);var W=n(O,2),me=o(W),se=n(o(me),2);Se(se),se.__keydown=[en,e,f],i(me),i(W);var _e=n(W,2);_e.__click=[tn,e,f];var N=o(_e);{var F=d=>{var y=C("save changes to project");_(d,y)},re=d=>{var y=C("create project");_(d,y)};w(N,d=>{a()?d(F):d(re,!1)})}i(_e);var fe=n(_e,2);{var ge=d=>{var y=on(),Q=ze(y);Q.__click=[an,r];var $=n(Q,2);{var x=H=>{var X=rn(),B=o(X);B.__click=[ln,r,e],i(X),we(3,X,()=>je),_(H,X)};w($,H=>{t(r)&&H(x)})}var S=n($,2);{var Z=H=>{var X=sn();X.__click=[nn,e],_(H,X)};w(S,H=>{e.onduplicate&&H(Z)})}_(d,y)};w(fe,d=>{e.onremove&&a()&&d(ge)})}var ae=n(fe,2);ae.__click=[Zr,P,z,f,g];var ee=o(ae);{var U=d=>{var y=C("import/export data");_(d,y)},be=d=>{var y=C("import data");_(d,y)};w(ee,d=>{a()?d(U):d(be,!1)})}i(ae),Ee(ae,d=>m(I,d),()=>t(I));var Ie=n(ae,2);{var Ae=d=>{var y=cn(),Q=o(y);rt(Q,{status:"error",children:($,x)=>{var S=_n(),Z=o(S,!0);i(S),G(()=>he(Z,t(b))),_($,S)},$$slots:{default:!0}}),i(y),_(d,y)};w(Ie,d=>{t(b)&&d(Ae)})}var pe=n(Ie,2);{var A=d=>{var y=dn();y.__click=[vn,e];var Q=o(y);{var $=S=>{var Z=C("discard changes and stop editing");_(S,Z)},x=S=>{var Z=C("close project editor");_(S,Z)};w(Q,S=>{t(h)?S($):S(x,!1)})}i(y),_(d,y)};w(pe,d=>{e.onclose&&a()&&d(A)})}i(E),G(()=>_e.disabled=a()&&!t(h)),xe(se,()=>t(c),d=>m(c,d)),_(l,T),ue()}Te(["click","keydown"]);var fn=p('<div class="panel p_md"><!></div>');function gn(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().remove_project),c=u(()=>a().duplicate_project),s=u(()=>a().update_project),f=u(()=>a().create_project),h=u(()=>a().editing_project_data??it.parse({})),g=u(()=>a().project_datas.some(b=>b.id===t(h).id));var P=fn(),z=o(P);const k=u(()=>t(g)?t(s):t(f));mn(z,{get editing(){return t(g)},get project_data(){return t(h)},get onsubmit(){return t(k)},get onremove(){return t(r)},get onduplicate(){return t(c)},onclose:()=>a().editing_project=!1}),i(P),_(l,P),ue()}var bn=p('<section class="card svelte-8muejm"><!></section>'),hn=p('<section class="card svelte-8muejm"><!></section>'),pn=p('<div class="width_sm svelte-8muejm"><!>  <!> <section class="card svelte-8muejm"><div class="panel p_md"><header><h2 class="my_0">controls</h2></header> <!> <div class="mb_lg"><!></div> <!> <aside>Earbetter supports MIDI devices like piano keyboards, connect and click:</aside> <!></div></section></div>'),yn=(l,e)=>t(e)(),kn=p(`<section class="card svelte-8muejm"><div class="panel p_md"><p>Earbetter is an <a href="https://wikipedia.org/wiki/Ear_training">ear training</a> tool:</p> <ul><li>each level is a standalone challenge that's a series of trials</li> <li></li> <li>realms group levels into bigger challenges</li> <li>projects group realms so you can customize various experiences</li> <li>levels can be shared via their links or exporting/importing data</li></ul> <p>See also the 3 minute <a href="https://www.youtube.com/watch?v=zW2zI1A_Ikw">video intro on YouTube</a> and <a href="https://github.com/ryanatkn/earbetter">the readme</a>.</p> <aside>Earbetter is in early development, and many things are unfinished and unknown - feedback
						is appreciated on <a href="https://github.com/ryanatkn/earbetter">the GitHub discussions and issues</a>.</aside> <div class="box row"><button type="button" class="m_0">ok, hide this</button></div></div></section>`),xn=p('<section class="card svelte-8muejm"><!></section>'),wn=p('<section class="card svelte-8muejm"><!></section>'),jn=p('<section class="card svelte-8muejm"><div class="panel p_md"><!></div></section>'),zn=p('<div class="width_sm svelte-8muejm"><!>  <!></div>'),In=p('<!> <div class="map svelte-8muejm"><!> <div class="width_sm svelte-8muejm"><!> <section class="card svelte-8muejm"><!></section>  <!></div> <!></div>',1);function qn(l,e){de(e,!0);const a=te(e,"app",7),r=u(()=>a().toggle_trainer_help),c=u(()=>a().play_level),s=u(()=>a().edit_level),f=u(()=>a().remove_level),h=u(()=>a().duplicate_level),g=u(()=>a().create_level),P=u(()=>a().update_level),z=Ft.get();window.ac=z;const k=u(()=>a().draft_level_data??nt.parse({})),b=u(()=>a().levels?a().levels.some(N=>N.id===t(k).id):!1),j=u(()=>{var N;return!((N=a().realms)!=null&&N.length)});var I=In(),T=ze(I);$t(T,{get midi_access(){return a().midi_access},onnotestart:(N,F)=>{Bt(a(),z(),N,Ht(a().volume,F),a().instrument)},onnotestop:N=>{bt(N)}});var J=n(T,2),M=o(J);{var E=N=>{var F=pn(),re=o(F);{var fe=d=>{var y=bn(),Q=o(y);er(Q,{get app(){return a()}}),i(y),we(3,y,()=>je),_(d,y)};w(re,d=>{a().selected_project_data&&d(fe)})}var ge=n(re,2);{var ae=d=>{var y=hn(),Q=o(y);gn(Q,{get app(){return a()}}),i(y),we(3,y,()=>je),_(d,y)};w(ge,d=>{(a().editing_project&&a().editing_project_data||!a().selected_project_data)&&d(ae)})}var ee=n(ge,2),U=o(ee),be=n(o(U),2);lr(be,{});var Ie=n(be,2),Ae=o(Ie);Gt(Ae,{get volume(){return a().volume},set volume(d){a().volume=d}}),i(Ie);var pe=n(Ie,2);Yt(pe,{get instrument(){return a().instrument},set instrument(d){a().instrument=d}});var A=n(pe,4);Kt(A,{get midi_state(){return a()}}),i(U),i(ee),i(F),we(3,ee,()=>je),_(N,F)};w(M,N=>{a().project_datas.length&&N(E)})}var O=n(M,2),D=o(O);{var K=N=>{var F=kn(),re=o(F),fe=n(o(re),2),ge=n(o(fe),2);ge.textContent=`your level score is the sum of mistakes in your best ${Ut}
							runs, win a ★ at 0`,Re(6),i(fe);var ae=n(fe,6),ee=o(ae);ee.__click=[yn,r],i(ae),i(re),i(F),we(3,F,()=>je),_(N,F)};w(D,N=>{a().show_trainer_help&&N(K)})}var V=n(D,2),q=o(V);pr(q,{get app(){return a()}}),i(V);var W=n(V,2);{var me=N=>{var F=xn(),re=o(F);Br(re,{get app(){return a()}}),i(F),we(3,F,()=>je),_(N,F)};w(W,N=>{(a().editing_realm&&a().editing_realm_data||t(j))&&N(me)})}i(O);var se=n(O,2);{var _e=N=>{var F=zn(),re=o(F);{var fe=ee=>{var U=wn(),be=o(U);Kr(be,{get app(){return a()},get levels(){return a().levels}}),i(U),we(3,U,()=>je),_(ee,U)};w(re,ee=>{a().levels&&ee(fe)})}var ge=n(re,2);{var ae=ee=>{var U=jn(),be=o(U),Ie=o(be);const Ae=u(()=>t(b)?t(P):t(g));Jl(Ie,{get editing(){return t(b)},get level_data(){return t(k)},get onsubmit(){return t(Ae)},get onremove(){return t(f)},get onduplicate(){return t(h)},onplay:async(pe,A)=>{A&&t(P)(pe),await t(c)(pe.id)},onclose:()=>t(s)(null)}),i(be),i(U),we(2,U,()=>je),_(ee,U)};w(ge,ee=>{var U;a().selected_realm_id&&(a().editing_level&&a().levels||((U=a().levels)==null?void 0:U.length)===0)&&ee(ae)})}i(F),_(N,F)};w(se,N=>{a().project_datas.length&&N(_e)})}i(J),_(l,I),ue()}Te(["click"]);var Sn=p('<main><!> <!> <!> <div class="box"><!></div></main>');function Vn(l,e){de(e,!0);const a=Vt.get();var r=Sn();wa(P=>{Sa.title="Earbetter trainer"});var c=o(r);Ga(c,{onclick:()=>Ta(Aa+"/")});var s=n(c,2);Pa(s);var f=n(s,2);qn(f,{app:a});var h=n(f,2),g=o(h);Da(g,{}),i(h),i(r),_(l,r),ue()}export{Vn as component};
