var we=Object.defineProperty;var le=n=>{throw TypeError(n)};var xe=(n,e,t)=>e in n?we(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ce=(n,e,t)=>xe(n,typeof e!="symbol"?e+"":e,t),R=(n,e,t)=>e.has(n)||le("Cannot "+t);var z=(n,e,t)=>(R(n,e,"read from private field"),t?t.call(n):e.get(n)),W=(n,e,t)=>e.has(n)?le("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Z=(n,e,t,o)=>(R(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t),oe=(n,e,t)=>(R(n,e,"access private method"),t);import{e as Te,u as Ee,p as ie,g as s,b as y,c as te,a as X,t as j,d as se,f as _e,G as C,V as Me,$ as p,W as Le,T as ze}from"./Drfw-9es.js";import{d as de,t as O,e as N,a as S,b as ne,s as Se,c as re}from"./D6FQBtKd.js";import{c as he,s as U,d as fe,b as be,e as Be}from"./wr1Q2OBW.js";import{p as g,i as V}from"./CnDERkxj.js";import{C as ge,s as ue,E as $,F as He,a as Ae,b as Ie,H as Ke}from"./CPUX8dqx.js";var A,P,Y,q,ke;const J=class J{constructor(e){W(this,q);W(this,A,new WeakMap);W(this,P);W(this,Y);Z(this,Y,e)}observe(e,t){var o=z(this,A).get(e)||new Set;return o.add(t),z(this,A).set(e,o),oe(this,q,ke).call(this).observe(e,z(this,Y)),()=>{var h=z(this,A).get(e);h.delete(t),h.size===0&&(z(this,A).delete(e),z(this,P).unobserve(e))}}};A=new WeakMap,P=new WeakMap,Y=new WeakMap,q=new WeakSet,ke=function(){return z(this,P)??Z(this,P,new ResizeObserver(e=>{for(var t of e){J.entries.set(t.target,t);for(var o of z(this,A).get(t.target)||[])o(t)}}))},ce(J,"entries",new WeakMap);let ae=J;var Pe=new ae({box:"border-box"});function pe(n,e,t){var o=Pe.observe(n,()=>t(n[e]));Te(()=>(Ee(()=>t(n[e])),o))}const De=(n,e)=>{let t=n.previousSibling;for(;t;){if(e(t))return t;t=t.previousSibling}return null},We=(n,e)=>{let t=n.nextSibling;for(;t;){if(e(t))return t;t=t.nextSibling}return null};var Ge=O('<div class="middle_c svelte-gdrax4"><!></div>'),Ne=O('<button type="button"><!></button>');function Ue(n,e){ie(e,!0);const t=g(e,"clickable",3,!0),o=g(e,"enabled",3,!0),h=g(e,"pressed",3,!1),k=g(e,"highlighted",3,!1),x=g(e,"emphasized",3,!1),_=g(e,"middle_c_label",3,!0),c=g(e,"allow_sticking",3,!1),r=y(()=>ge.has(e.note)),b=y(()=>!s(r)),v=y(()=>e.note===60),f=a=>{const i=De(a,u=>u instanceof HTMLButtonElement);i==null||i.focus()},T=a=>{const i=We(a,u=>u instanceof HTMLButtonElement);i==null||i.focus()},E=a=>{var u;const{key:i}=a;switch(i){case" ":case"Enter":{ue(a),(u=e.onpress)==null||u.call(e,e.note),a.currentTarget.focus();break}case"ArrowLeft":{f(a.currentTarget);break}case"ArrowRight":{T(a.currentTarget);break}}},M=a=>{var u;const{key:i}=a;switch(i){case" ":case"Enter":{ue(a),(u=e.onrelease)==null||u.call(e,e.note);break}}},d=y(()=>t()&&o());var l=Ne();let w;l.__keydown=function(...a){var i;(i=s(d)?E:void 0)==null||i.apply(this,a)},l.__keyup=function(...a){var i;(i=s(d)?M:void 0)==null||i.apply(this,a)},l.__mousedown=function(...a){var i;(i=s(d)?u=>{var L;(L=e.onpress)==null||L.call(e,e.note),u.currentTarget.focus()}:void 0)==null||i.apply(this,a)},l.__mouseup=function(...a){var i;(i=s(d)?()=>{var u;(u=e.onrelease)==null||u.call(e,e.note)}:void 0)==null||i.apply(this,a)},l.__focusout=function(...a){var i;(i=s(d)&&!c()?()=>{var u;(u=e.onrelease)==null||u.call(e,e.note)}:void 0)==null||i.apply(this,a)};let B;var I=te(l);{var D=a=>{var i=Ge(),u=te(i);{var L=H=>{var m=ne();j(()=>Se(m,_())),S(H,m)},Q=(H,m)=>{{var ve=K=>{var F=ne("C4");S(K,F)},ye=K=>{var F=re(),me=_e(F);be(me,_),S(K,F)};V(H,K=>{typeof _()=="boolean"?K(ve):K(ye,!1)},m)}};V(u,H=>{typeof _()=="string"?H(L):H(Q,!1)})}X(i),S(a,i)};V(I,a=>{s(v)&&_()&&a(D)})}X(l),j(a=>{w=he(l,1,"piano_key svelte-gdrax4",null,w,a),U(l,"tabindex",s(d)?void 0:-1),U(l,"aria-label",`piano key for midi ${e.note??""}`),U(l,"data-note",e.note),B=fe(l,"",B,{left:`${e.left_offset??""}px`})},[()=>({natural:s(r),accidental:s(b),disabled:!o(),clickable:s(d),active:h(),highlighted:k(),emphasized:x()})]),N("mouseenter",l,function(...a){var i;(i=s(d)&&e.pressing_any?u=>{var L;(L=e.onpress)==null||L.call(e,e.note),u.currentTarget.focus()}:void 0)==null||i.apply(this,a)}),N("mouseleave",l,function(...a){var i;(i=s(d)?()=>{var u;(u=e.onrelease)==null||u.call(e,e.note)}:void 0)==null||i.apply(this,a)}),S(n,l),se()}de(["keydown","keyup","mousedown","mouseup","focusout"]);const Ye=5,Fe=7/12,Ve=.7,ee={1:0,2:-3/5,3:0,4:-2/5,5:0,6:0,7:-2/3,8:0,9:-1/2,10:0,11:-1/3,12:0},Xe=(n,e,t,o=500)=>{const h=Math.abs(ee[$[e]]);let k=Math.abs(ee[$[t]]);k&&(k=1-k);const x=t-e+1;if(x<=0)return{piano_keys:[],natural_key_height:o,natural_key_width:0,accidental_key_height:0,accidental_key_width:0};const _=He(e,t),c=n/(_.length+(h+k))|0,r=c*Fe|0,b=Math.min(o,r*Ye)|0,v=b*Ve|0;let f=0;const T=[];for(let E=0;E<x;E++){const M=E+e;let d,l,w;ge.has(M)?(d=c,l=b,w=f*c+h*r,f++):(d=r,l=v,w=f*c+ee[$[M]]*r+h*r),T.push({note:M,left_offset:w,width:d,height:l})}return{piano_keys:T,natural_key_height:b,natural_key_width:c,accidental_key_height:v,accidental_key_width:r}};var je=O("<div></div>");function $e(n,e){ie(e,!0);const t=g(e,"max_height",3,void 0),o=g(e,"min_note",3,Ae),h=g(e,"max_note",3,Ie),k=g(e,"enabled_notes",3,null),x=g(e,"pressed_keys",3,null),_=g(e,"highlighted_keys",3,null),c=g(e,"emphasized_keys",3,null),r=g(e,"clickable",3,!0),b=y(()=>Xe(e.width,o(),h(),t())),v=y(()=>s(b).piano_keys),f=y(()=>s(b).natural_key_width),T=y(()=>s(b).natural_key_height),E=y(()=>s(b).accidental_key_width),M=y(()=>s(b).accidental_key_height);let d=Me(!1);var l=je();N("mousedown",p,()=>C(d,!0),!0),N("mouseup",p,()=>C(d,!1),!0),N("mouseleave",p,()=>C(d,!1));let w,B;Be(l,21,()=>s(v),({note:I,left_offset:D})=>I,(I,D)=>{let a=()=>s(D).note,i=()=>s(D).left_offset;const u=y(()=>!k()||k().has(a())),L=y(()=>{var m;return(m=x())==null?void 0:m.has(a())}),Q=y(()=>{var m;return(m=_())==null?void 0:m.has(a())}),H=y(()=>{var m;return(m=c())==null?void 0:m.has(a())});Ue(I,{get note(){return a()},get left_offset(){return i()},get clickable(){return r()},get enabled(){return s(u)},get pressed(){return s(L)},get highlighted(){return s(Q)},get emphasized(){return s(H)},get middle_c_label(){return e.middle_c_label},get allow_sticking(){return e.allow_sticking},get pressing_any(){return s(d)},get onpress(){return e.onpress},get onrelease(){return e.onrelease}})}),X(l),j(I=>{w=he(l,1,"piano svelte-d5674k",null,w,I),U(l,"aria-disabled",!r()),B=fe(l,"",B,{width:`${e.width??""}px`,height:`${s(T)??""}px`,"--piano_natural_key_width":`${s(f)??""}px`,"--piano_natural_key_height":`${s(T)??""}px`,"--piano_accidental_key_width":`${s(E)??""}px`,"--piano_accidental_key_height":`${s(M)??""}px`})},[()=>({disabled:!r()})]),S(n,l),se()}var G=(n=>(n[n.Stop=8]="Stop",n[n.Start=9]="Start",n[n.Knob=11]="Knob",n[n.PitchBend=14]="PitchBend",n))(G||{});function et(n,e){ie(e,!0);const t=console.log.bind(console),o=_=>{var T,E,M,d,l,w,B;const c=Ke(_),{command:r,channel:b,note:v,velocity:f}=c;switch(t("midimessage",r,c),r){case G.Stop:{b===0?(T=e.onnotestop)==null||T.call(e,v,f):b===9?(E=e.onpadstop)==null||E.call(e,v,f):t("unknown MIDI stop command",c);break}case G.Start:{b===0?f===0?(M=e.onnotestop)==null||M.call(e,v,f):(d=e.onnotestart)==null||d.call(e,v,f):b===9?f===0?(l=e.onpadstop)==null||l.call(e,v,f):(w=e.onpadstart)==null||w.call(e,v,f):t("unknown MIDI start command",c);break}case G.Knob:{v===1?(B=e.onmodwheel)==null||B.call(e,f):t("unknown MIDI knob command",c);break}case G.PitchBend:{t("unhandled MIDI pitch bend",c);break}default:t("unrecognized MIDI command",c)}},h=[],k=()=>{for(const _ of h)_();h.length=0};Le(k);const x=_=>{if(h.length&&k(),!!_)for(const c of _.inputs.values())c.addEventListener("midimessage",o),h.push(()=>{c.removeEventListener("midimessage",o)})};ze(()=>x(e.midi_access)),se()}var qe=O('<button type="button" class="icon_button plain_button svelte-1gk9bl5"><!></button>');function tt(n,e){const t=g(e,"title",3,"go back");var o=qe();o.__click=function(..._){var c;(c=e.onclick)==null||c.apply(this,_)};var h=te(o);{var k=_=>{var c=re(),r=_e(c);be(r,()=>e.children),S(_,c)},x=_=>{var c=ne("←");S(_,c)};V(h,_=>{e.children?_(k):_(x,!1)})}X(o),j(()=>U(o,"title",t())),S(n,o)}de(["click"]);export{tt as B,et as M,$e as P,pe as b};
