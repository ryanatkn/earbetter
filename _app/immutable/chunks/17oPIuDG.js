import{l as W,t as b,a as c,s as Y,d as ae,c as te,b as se}from"./Ckbefv40.js";import{u as X,b as re,i as ie,e as Z,Y as ne,p as G,a as H,D as le,s as k,c as m,r as o,t as F,N as P,F as A,g as f,d as C,f as ce,n as oe}from"./D-3fTjYY.js";import{s as I,r as Q,e as $}from"./L33y2_sP.js";import{p as J,i as M}from"./t9At_Kmo.js";import{r as ue,D as ve,q as de,t as U,u as B}from"./sYHH2aNZ.js";function R(e,a,r=a){W(e,"input",t=>{var s=t?e.defaultValue:e.value;if(s=N(e)?T(s):s,r(s),s!==(s=a())){var i=e.selectionStart,n=e.selectionEnd;e.value=s??"",n!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(n,e.value.length))}}),(ie&&e.defaultValue!==e.value||X(a)==null&&e.value)&&r(N(e)?T(e.value):e.value),re(()=>{var t=a();N(e)&&t===T(e.value)||e.type==="date"&&!t&&!e.value||t!==e.value&&(e.value=t??"")})}function N(e){var a=e.type;return a==="number"||a==="range"}function T(e){return e===""?null:+e}function j(e,a,r){if(e.multiple)return me(e,a);for(var t of e.options){var s=D(t);if(ne(s,a)){t.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function _e(e,a){let r=!0;Z(()=>{a&&j(e,X(a),r),r=!1;var t=new MutationObserver(()=>{var s=e.__value;j(e,s)});return t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function fe(e,a,r=a){var t=!0;W(e,"change",s=>{var i=s?"[selected]":":checked",n;if(e.multiple)n=[].map.call(e.querySelectorAll(i),D);else{var d=e.querySelector(i)??e.querySelector("option:not([disabled])");n=d&&D(d)}r(n)}),Z(()=>{var s=a();if(j(e,s,t),t&&s===void 0){var i=e.querySelector(":checked");i!==null&&(s=D(i),r(s))}e.__value=s,t=!1}),_e(e)}function me(e,a){for(var r of e.options)r.selected=~a.indexOf(D(r))}function D(e){return"__value"in e?e.__value:e.value}let p;const be=e=>{console.log("resetting midi_access"),p=void 0,e.midi_access=null},ge=async e=>{const a=e.midi_access;if(a)return a;if(p)return p;const r=ue();p=r,console.log("request_access midi_access",r);try{const t=await r;return r!==p?p:(e.midi_access=t,t)}catch(t){return console.error("request_access failed",t),p}};var ye=b('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"> <input type="range"></div></label>');function Oe(e,a){G(a,!0);let r=J(a,"volume",31,()=>le(ve));var t=ye(),s=k(m(t),2),i=m(s);Q(i),I(i,"step",.01),I(i,"min",0),I(i,"max",1);var n=k(i,2);Q(n),I(n,"step",.01),I(n,"min",0),I(n,"max",1),o(s),o(t),R(i,r),R(n,r),c(e,t),H()}var qe=b("<option> </option>"),Ie=b('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function ze(e,a){G(a,!0);let r=J(a,"instrument",15);var t=Ie(),s=m(t),i=k(m(s),2);$(i,20,()=>de,n=>n,(n,d)=>{var l=qe(),S={},L=m(l,!0);o(l),F(()=>{S!==(S=d)&&(l.value=(l.__value=d)??""),Y(L,d)}),c(n,l)}),o(i),o(s),o(t),fe(i,r),c(e,t),H()}var pe=async(e,a,r,t,s)=>{console.log("requesting midi access"),A(a,"pending");try{be(r.midi_state),await t()(r.midi_state),A(a,"success")}catch(i){console.error("failed to request midi access",i),A(a,"failure"),A(s,i.message,!0)}},he=b('<li class="svelte-13ivzsn"><small> </small></li>'),xe=b("<div><div>MIDI devices</div> <ul></ul></div>"),Me=b("<span>no MIDI devices found, try again?</span>"),De=b("<span>requesting MIDI access</span>"),ke=b("<span>failed to request MIDI access<!></span>"),Se=b("connect MIDI &nbsp;<code>c</code>",1),Ve=b('<button type="button" class="big svelte-13ivzsn"><!></button>');function Ce(e,a){G(a,!0);const r=J(a,"request_access",3,ge);let t=P("initial");const s=C(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),i=C(()=>{var g;return((g=f(s))==null?void 0:g.length)??0}),n=C(()=>f(i)>0||f(t)==="pending");let d=P(void 0);var l=Ve();l.__click=[pe,t,a,r,d];var S=m(l);{var L=g=>{var V=te(),O=ce(V);{var z=u=>{var v=xe(),w=k(m(v),2);$(w,20,()=>f(s),_=>_,(_,q)=>{var h=he(),E=m(h),x=m(E,!0);o(E),o(h),F(()=>Y(x,q.name)),c(_,h)}),o(w),o(v),c(u,v)},y=u=>{var v=Me();U(1,v,()=>B),c(u,v)};M(O,u=>{var v;(v=f(s))!=null&&v.length?u(z):u(y,!1)})}c(g,V)},ee=(g,V)=>{{var O=y=>{var u=De();U(1,u,()=>B),c(y,u)},z=(y,u)=>{{var v=_=>{var q=ke(),h=k(m(q));{var E=x=>{var K=se();F(()=>Y(K,`: ${f(d)??""}`)),c(x,K)};M(h,x=>{f(d)&&x(E)})}o(q),U(1,q,()=>B),c(_,q)},w=_=>{var q=Se();oe(),c(_,q)};M(y,_=>{f(t)==="failure"?_(v):_(w,!1)},u)}};M(g,y=>{f(t)==="pending"?y(O):y(z,!1)},V)}};M(S,g=>{a.midi_state.midi_access?g(L):g(ee,!1)})}o(l),F(()=>{l.disabled=f(n),I(l,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),c(e,l),H()}ae(["click"]);export{ze as I,Oe as V,fe as a,R as b,Ce as c,_e as i,ge as r,j as s};
