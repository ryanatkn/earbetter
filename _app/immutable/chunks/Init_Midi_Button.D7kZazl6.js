import{h as $,c as m,s as b,a as c,t as g,r as d,b as F,d as O,f as L,e as ee,v as ae}from"./disclose-version.wE5PaFVB.js";import{d as te,s as I,r as H,e as Q,i as R}from"./style.BI6wc9N8.js";import{b as re,r as se,e as W,u as ie,t as E,g as o,p as ne,a as oe,s as w,h as J,d as S}from"./index-client.DEO7R3f7.js";import{b as ce,p as B,a as X,i as k}from"./props.BV_xrcCh.js";import{r as le,D as ue,q as ve,t as z,u as C}from"./index.B0SYoWXo.js";function Se(e,a,t,r=!0){r&&t();for(var s of a)e.addEventListener(s,t);re(()=>{for(var i of a)e.removeEventListener(i,t)})}function Y(e,a,t,r=t){e.addEventListener(a,t);const s=e.__on_r;s?e.__on_r=()=>{s(),r()}:e.__on_r=r,te()}function K(e,a,t){Y(e,"input",()=>{t(N(e)?P(e.value):e.value)}),se(()=>{var r=a();if($&&e.defaultValue!==e.value){t(e.value);return}N(e)&&r===P(e.value)||e.type==="date"&&!r&&!e.value||(e.value=r??"")})}function N(e){var a=e.type;return a==="number"||a==="range"}function P(e){return e===""?null:+e}function U(e,a,t){if(e.multiple)return fe(e,a);for(var r of e.options){var s=D(r);if(ce(s,a)){r.selected=!0;return}}(!t||a!==void 0)&&(e.selectedIndex=-1)}function _e(e,a){let t=!0;W(()=>{a&&U(e,ie(a),t),t=!1;var r=new MutationObserver(()=>{var s=e.__value;U(e,s)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function de(e,a,t){var r=!0;Y(e,"change",()=>{var s;if(e.multiple)s=[].map.call(e.querySelectorAll(":checked"),D);else{var i=e.querySelector(":checked");s=i&&D(i)}t(s)}),W(()=>{var s=a();if(U(e,s,r),r&&s===void 0){var i=e.querySelector(":checked");i!==null&&(s=D(i),t(s))}e.__value=s,r=!1}),_e(e)}function fe(e,a){for(var t of e.options)t.selected=~a.indexOf(D(t))}function D(e){return"__value"in e?e.__value:e.value}let x;const me=e=>{console.log("resetting midi_access"),x=void 0,e.midi_access=null},be=async e=>{const a=e.midi_access;if(a)return a;if(x)return x;const t=le();x=t,console.log("request_access midi_access",t);try{const r=await t;return t!==x?x:(e.midi_access=r,r)}catch(r){return console.error("request_access failed",r),x}};var ge=g('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"> <input type="range"></div></label>');function ze(e,a){let t=B(a,"volume",31,()=>X(ue));var r=ge(),s=m(r),i=b(b(s,!0)),u=m(i);H(u),I(u,"step",.01),I(u,"min",0),I(u,"max",1);var l=b(b(u,!0));H(l),I(l,"step",.01),I(l,"min",0),I(l,"max",1),d(i),d(r),K(u,t,n=>t(n)),K(l,t,n=>t(n)),c(e,r)}var pe=g("<option> </option>"),ye=g('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function Ce(e,a){let t=B(a,"instrument",15);var r=ye(),s=m(r),i=m(s),u=b(b(i,!0));Q(u,21,()=>ve,R,(l,n,T)=>{var v=pe(),y={},M=m(v);d(v),E(()=>{y!==(y=o(n))&&(v.value=(v.__value=o(n))==null?"":o(n)),F(M,o(n))}),c(l,v)}),d(u),d(s),d(r),de(u,t,l=>t(l)),c(e,r)}var Ie=async(e,a,t,r,s)=>{console.log("requesting midi access"),w(a,"pending");try{me(t.midi_state),await r()(t.midi_state),w(a,"success")}catch(i){console.error("failed to request midi access",i),w(a,"failure"),w(s,X(i.message))}},xe=g('<li class="svelte-13ivzsn"><small> </small></li>'),qe=g("<div><div>MIDI devices</div> <ul></ul></div>"),he=g("<span>no MIDI devices found, try again?</span>"),Me=g("<span>requesting MIDI access</span>"),ke=g("<span>failed to request MIDI access<!></span>"),De=g("connect MIDI &nbsp;<code>c</code>",1),Le=g('<button type="button" class="big svelte-13ivzsn"><!></button>');function Fe(e,a){ne(a,!0);const t=B(a,"request_access",3,be);let r=J("initial");const s=S(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),i=S(()=>{var v;return((v=o(s))==null?void 0:v.length)??0}),u=S(()=>o(i)>0||o(r)==="pending");let l=J(void 0);var n=Le();n.__click=[Ie,r,a,t,l];var T=m(n);k(T,()=>a.midi_state.midi_access,v=>{var y=O(),M=L(y);k(M,()=>{var f;return(f=o(s))==null?void 0:f.length},f=>{var _=qe(),V=m(_),q=b(b(V,!0));Q(q,21,()=>o(s),R,(p,A,j)=>{var h=xe(),G=m(h),Z=m(G);d(G),d(h),E(()=>F(Z,o(A).name)),c(p,h)}),d(q),d(_),c(f,_)},f=>{var _=he();z(1,_,()=>C),c(f,_)}),c(v,y)},v=>{var y=O(),M=L(y);k(M,()=>o(r)==="pending",f=>{var _=Me();z(1,_,()=>C),c(f,_)},f=>{var _=O(),V=L(_);k(V,()=>o(r)==="failure",q=>{var p=ke(),A=b(m(p));k(A,()=>o(l),j=>{var h=ee();E(()=>F(h,`: ${o(l)??""}`)),c(j,h)}),d(p),z(1,p,()=>C),c(q,p)},q=>{var p=De();b(L(p,!0)),c(q,p)},!0),c(f,_)},!0),c(v,y)}),d(n),E(()=>{n.disabled=o(u),I(n,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),c(e,n),oe()}ae(["click"]);export{Ce as I,ze as V,de as a,K as b,Fe as c,_e as i,Se as l,be as r,U as s};
