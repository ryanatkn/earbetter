import{l as X,t as b,a as c,s as j,d as ae,c as te,b as se}from"./D6FQBtKd.js";import{u as Y,r as re,i as ie,e as Z,a1 as ne,p as J,d as K,M as le,s as k,c as m,a as o,t as L,V as Q,G as A,g as f,b as F,f as ce,n as oe}from"./Drfw-9es.js";import{s as I,r as R,e as $}from"./wr1Q2OBW.js";import{p as N,i as M}from"./CnDERkxj.js";import{r as ue,D as ve,q as de,t as U,u as B}from"./HpLCJ4lA.js";function W(e,a,r=a){X(e,"input",t=>{var s=t?e.defaultValue:e.value;if(s=G(e)?T(s):s,r(s),s!==(s=a())){var i=e.selectionStart,n=e.selectionEnd;e.value=s??"",n!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(n,e.value.length))}}),(ie&&e.defaultValue!==e.value||Y(a)==null&&e.value)&&r(G(e)?T(e.value):e.value),re(()=>{var t=a();G(e)&&t===T(e.value)||e.type==="date"&&!t&&!e.value||t!==e.value&&(e.value=t??"")})}function G(e){var a=e.type;return a==="number"||a==="range"}function T(e){return e===""?null:+e}function H(e,a,r){if(e.multiple)return me(e,a);for(var t of e.options){var s=D(t);if(ne(s,a)){t.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function _e(e,a){let r=!0;Z(()=>{a&&H(e,Y(a),r),r=!1;var t=new MutationObserver(()=>{var s=e.__value;H(e,s)});return t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function fe(e,a,r=a){var t=!0;X(e,"change",s=>{var i=s?"[selected]":":checked",n;if(e.multiple)n=[].map.call(e.querySelectorAll(i),D);else{var u=e.querySelector(i)??e.querySelector("option:not([disabled])");n=u&&D(u)}r(n)}),Z(()=>{var s=a();if(H(e,s,t),t&&s===void 0){var i=e.querySelector(":checked");i!==null&&(s=D(i),r(s))}e.__value=s,t=!1}),_e(e)}function me(e,a){for(var r of e.options)r.selected=~a.indexOf(D(r))}function D(e){return"__value"in e?e.__value:e.value}let p;const be=e=>{console.log("resetting midi_access"),p=void 0,e.midi_access=null},ge=async e=>{const a=e.midi_access;if(a)return a;if(p)return p;const r=ue();p=r,console.log("request_access midi_access",r);try{const t=await r;return r!==p?p:(e.midi_access=t,t)}catch(t){return console.error("request_access failed",t),p}};var ye=b('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"> <input type="range"></div></label>');function ze(e,a){J(a,!0);let r=N(a,"volume",31,()=>le(ve));var t=ye(),s=k(m(t),2),i=m(s);R(i),I(i,"step",.01),I(i,"min",0),I(i,"max",1);var n=k(i,2);R(n),I(n,"step",.01),I(n,"min",0),I(n,"max",1),o(s),o(t),W(i,r),W(n,r),c(e,t),K()}var qe=b("<option> </option>"),Ie=b('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function Ce(e,a){J(a,!0);let r=N(a,"instrument",15);var t=Ie(),s=m(t),i=k(m(s),2);$(i,20,()=>de,n=>n,(n,u)=>{var l=qe(),S={},O=m(l,!0);o(l),L(()=>{S!==(S=u)&&(l.value=(l.__value=u)==null?"":u),j(O,u)}),c(n,l)}),o(i),o(s),o(t),fe(i,r),c(e,t),K()}var pe=async(e,a,r,t,s)=>{console.log("requesting midi access"),A(a,"pending");try{be(r.midi_state),await t()(r.midi_state),A(a,"success")}catch(i){console.error("failed to request midi access",i),A(a,"failure"),A(s,i.message,!0)}},he=b('<li class="svelte-13ivzsn"><small> </small></li>'),xe=b("<div><div>MIDI devices</div> <ul></ul></div>"),Me=b("<span>no MIDI devices found, try again?</span>"),De=b("<span>requesting MIDI access</span>"),ke=b("<span>failed to request MIDI access<!></span>"),Se=b("connect MIDI &nbsp;<code>c</code>",1),Ve=b('<button type="button" class="big svelte-13ivzsn"><!></button>');function Fe(e,a){J(a,!0);const r=N(a,"request_access",3,ge);let t=Q("initial");const s=F(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),i=F(()=>{var g;return((g=f(s))==null?void 0:g.length)??0}),n=F(()=>f(i)>0||f(t)==="pending");let u=Q(void 0);var l=Ve();l.__click=[pe,t,a,r,u];var S=m(l);{var O=g=>{var V=te(),z=ce(V);{var C=v=>{var d=xe(),w=k(m(d),2);$(w,20,()=>f(s),_=>_,(_,q)=>{var h=he(),E=m(h),x=m(E,!0);o(E),o(h),L(()=>j(x,q.name)),c(_,h)}),o(w),o(d),c(v,d)},y=v=>{var d=Me();U(1,d,()=>B),c(v,d)};M(z,v=>{var d;(d=f(s))!=null&&d.length?v(C):v(y,!1)})}c(g,V)},ee=(g,V)=>{{var z=y=>{var v=De();U(1,v,()=>B),c(y,v)},C=(y,v)=>{{var d=_=>{var q=ke(),h=k(m(q));{var E=x=>{var P=se();L(()=>j(P,`: ${f(u)??""}`)),c(x,P)};M(h,x=>{f(u)&&x(E)})}o(q),U(1,q,()=>B),c(_,q)},w=_=>{var q=Se();oe(),c(_,q)};M(y,_=>{f(t)==="failure"?_(d):_(w,!1)},v)}};M(g,y=>{f(t)==="pending"?y(z):y(C,!1)},V)}};M(S,g=>{a.midi_state.midi_access?g(O):g(ee,!1)})}o(l),L(()=>{l.disabled=f(n),I(l,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),c(e,l),K()}ae(["click"]);export{Ce as I,ze as V,fe as a,W as b,Fe as c,_e as i,ge as r,H as s};
