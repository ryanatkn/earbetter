var ve=Object.defineProperty;var ye=(n,e,t)=>e in n?ve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var de=(n,e,t)=>(ye(n,typeof e!="symbol"?e+"":e,t),t),$=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var L=(n,e,t)=>($(n,e,"read from private field"),t?t.call(n):e.get(n)),N=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},ee=(n,e,t,c)=>($(n,e,"write to private field"),c?c.call(n,t):e.set(n,t),t);var oe=(n,e,t)=>($(n,e,"access private method"),t);import{e as me,u as we,p as Q,g as l,t as j,a as R,d as o,s as te,h as xe,F as Te,D as Ee}from"./index-client.DEO7R3f7.js";import{v as re,c as se,e as Me,b as ze,a as z,d as le,f as ce,r as q,u as W,t as P,$ as ne}from"./disclose-version.wE5PaFVB.js";import{c as he,s as Y,t as B,b as I,e as Le}from"./style.BI6wc9N8.js";import{p as v,i as X}from"./props.BV_xrcCh.js";import{C as fe,s as ue,E as ae,F as Se,a as Be,b as He,H as Ae}from"./index.B0SYoWXo.js";var H,K,F,J,ge;const O=class O{constructor(e){N(this,J);N(this,H,new WeakMap);N(this,K,void 0);N(this,F,void 0);ee(this,F,e)}observe(e,t){var c=L(this,H).get(e)||new Set;return c.add(t),L(this,H).set(e,c),oe(this,J,ge).call(this).observe(e,L(this,F)),()=>{var h=L(this,H).get(e);h.delete(t),h.size===0&&(L(this,H).delete(e),L(this,K).unobserve(e))}}};H=new WeakMap,K=new WeakMap,F=new WeakMap,J=new WeakSet,ge=function(){return L(this,K)??ee(this,K,new ResizeObserver(e=>{for(var t of e){O.entries.set(t.target,t);for(var c of L(this,H).get(t.target)||[])c(t)}}))},de(O,"entries",new WeakMap);let _e=O;var Ie=new _e({box:"border-box"});function pe(n,e,t){var c=Ie.observe(n,()=>t(n[e]));me(()=>(we(()=>t(n[e])),c))}const Ke=(n,e)=>{let t=n.previousSibling;for(;t;){if(e(t))return t;t=t.previousSibling}return null},Pe=(n,e)=>{let t=n.nextSibling;for(;t;){if(e(t))return t;t=t.nextSibling}return null};var De=P("C4",1),Ne=P('<div class="middle_c svelte-gdrax4"><!></div>'),Ue=P('<button type="button" class="piano_key svelte-gdrax4"><!></button>');function We(n,e){Q(e,!0);const t=v(e,"clickable",3,!0),c=v(e,"enabled",3,!0),h=v(e,"pressed",3,!1),u=v(e,"highlighted",3,!1),g=v(e,"emphasized",3,!1),r=v(e,"middle_c_label",3,!0),d=v(e,"allow_sticking",3,!1),b=o(()=>fe.has(e.note)),k=o(()=>!l(b)),y=o(()=>e.note===60),f=i=>{const a=Ke(i,m=>m instanceof HTMLButtonElement);a==null||a.focus()},T=i=>{const a=Pe(i,m=>m instanceof HTMLButtonElement);a==null||a.focus()},E=i=>{var m;const{key:a}=i;switch(a){case" ":case"Enter":{ue(i),(m=e.onpress)==null||m.call(e,e.note),i.currentTarget.focus();break}case"ArrowLeft":{f(i.currentTarget);break}case"ArrowRight":{T(i.currentTarget);break}}},M=i=>{var m;const{key:a}=i;switch(a){case" ":case"Enter":{ue(i),(m=e.onrelease)==null||m.call(e,e.note);break}}},_=o(()=>t()&&c());var s=Ue();s.__keydown=function(...i){var a;(a=l(_)?E:void 0)==null||a.apply(this,i)},s.__keyup=function(...i){var a;(a=l(_)?M:void 0)==null||a.apply(this,i)};var w=o(()=>l(_)?i=>{var a;(a=e.onpress)==null||a.call(e,e.note),i.currentTarget.focus()}:void 0);s.__mousedown=function(...i){var a;(a=l(w))==null||a.apply(this,i)};var S=o(()=>l(_)?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0);s.__mouseup=function(...i){var a;(a=l(S))==null||a.apply(this,i)};var V=o(()=>l(_)&&e.pressing_any?i=>{var a;(a=e.onpress)==null||a.call(e,e.note),i.currentTarget.focus()}:void 0),A=o(()=>l(_)?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0),Z=o(()=>l(_)&&!d()?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0);s.__focusout=function(...i){var a;(a=l(Z))==null||a.apply(this,i)};var C=se(s);X(C,()=>l(y)&&r(),i=>{var a=Ne(),m=se(a);X(m,()=>typeof r()=="string",x=>{var D=Me();j(()=>ze(D,r())),z(x,D)},x=>{var D=le(),be=ce(D);X(be,()=>typeof r()=="boolean",p=>{var G=De();z(p,G)},p=>{var G=le(),ke=ce(G);he(ke,r),z(p,G)},!0),z(x,D)}),q(a),z(i,a)}),q(s),j(()=>{Y(s,"tabindex",l(_)?void 0:-1),Y(s,"aria-label",`piano key for midi ${e.note??""}`),Y(s,"data-note",e.note),B(s,"natural",l(b)),B(s,"accidental",l(k)),B(s,"disabled",!c()),B(s,"clickable",l(_)),B(s,"active",h()),B(s,"highlighted",u()),B(s,"emphasized",g()),I(s,"left",`${e.left_offset??""}px`)}),W("mouseenter",s,function(...i){var a;(a=l(V))==null||a.apply(this,i)}),W("mouseleave",s,function(...i){var a;(a=l(A))==null||a.apply(this,i)}),z(n,s),R()}re(["keydown","keyup","mousedown","mouseup","focusout"]);const Ye=5,Fe=7/12,Ge=.7,ie={1:0,2:-3/5,3:0,4:-2/5,5:0,6:0,7:-2/3,8:0,9:-1/2,10:0,11:-1/3,12:0},Xe=(n,e,t,c=500)=>{const h=Math.abs(ie[ae[e]]);let u=Math.abs(ie[ae[t]]);u&&(u=1-u);const g=t-e+1;if(g<=0)return{piano_keys:[],natural_key_height:c,natural_key_width:0,accidental_key_height:0,accidental_key_width:0};const r=Se(e,t),d=n/(r.length+(h+u))|0,b=d*Fe|0,k=Math.min(c,b*Ye)|0,y=k*Ge|0;let f=0;const T=[];for(let E=0;E<g;E++){const M=E+e;let _,s,w;fe.has(M)?(_=d,s=k,w=f*d+h*b,f++):(_=b,s=y,w=f*d+ie[ae[M]]*b+h*b),T.push({note:M,left_offset:w,width:_,height:s})}return{piano_keys:T,natural_key_height:k,natural_key_width:d,accidental_key_height:y,accidental_key_width:b}};var je=P('<div class="piano svelte-d5674k"></div>');function $e(n,e){Q(e,!0);const t=v(e,"max_height",19,()=>{}),c=v(e,"min_note",3,Be),h=v(e,"max_note",3,He),u=v(e,"enabled_notes",3,null),g=v(e,"pressed_keys",3,null),r=v(e,"highlighted_keys",3,null),d=v(e,"emphasized_keys",3,null),b=v(e,"clickable",3,!0),k=o(()=>Xe(e.width,c(),h(),t())),y=o(()=>l(k).piano_keys),f=o(()=>l(k).natural_key_width),T=o(()=>l(k).natural_key_height),E=o(()=>l(k).accidental_key_width),M=o(()=>l(k).accidental_key_height);let _=xe(!1);var s=je();W("mousedown",ne,()=>te(_,!0),!0),W("mouseup",ne,()=>te(_,!1),!0),W("mouseleave",ne,()=>te(_,!1)),Le(s,21,()=>l(y),({note:w,left_offset:S},V)=>w,(w,S,V)=>{let A=()=>l(S).note,Z=()=>l(S).left_offset;var C=o(()=>!u()||u().has(A())),i=o(()=>{var x;return(x=g())==null?void 0:x.has(A())}),a=o(()=>{var x;return(x=r())==null?void 0:x.has(A())}),m=o(()=>{var x;return(x=d())==null?void 0:x.has(A())});We(w,{get note(){return A()},get left_offset(){return Z()},get clickable(){return b()},get enabled(){return l(C)},get pressed(){return l(i)},get highlighted(){return l(a)},get emphasized(){return l(m)},get middle_c_label(){return e.middle_c_label},get allow_sticking(){return e.allow_sticking},get pressing_any(){return l(_)},get onpress(){return e.onpress},get onrelease(){return e.onrelease}})}),q(s),j(()=>{Y(s,"aria-disabled",!b()),B(s,"disabled",!b()),I(s,"width",`${e.width??""}px`),I(s,"height",`${l(T)??""}px`),I(s,"--piano_natural_key_width",`${l(f)??""}px`),I(s,"--piano_natural_key_height",`${l(T)??""}px`),I(s,"--piano_accidental_key_width",`${l(E)??""}px`),I(s,"--piano_accidental_key_height",`${l(M)??""}px`)}),z(n,s),R()}var U=(n=>(n[n.Stop=8]="Stop",n[n.Start=9]="Start",n[n.Knob=11]="Knob",n[n.PitchBend=14]="PitchBend",n))(U||{});function et(n,e){Q(e,!0);const t=console.log.bind(console),c=r=>{var T,E,M,_,s,w,S;const d=Ae(r),{command:b,channel:k,note:y,velocity:f}=d;switch(t("midimessage",b,d),b){case U.Stop:{k===0?(T=e.onnotestop)==null||T.call(e,y,f):k===9?(E=e.onpadstop)==null||E.call(e,y,f):t("unknown MIDI stop command",d);break}case U.Start:{k===0?f===0?(M=e.onnotestop)==null||M.call(e,y,f):(_=e.onnotestart)==null||_.call(e,y,f):k===9?f===0?(s=e.onpadstop)==null||s.call(e,y,f):(w=e.onpadstart)==null||w.call(e,y,f):t("unknown MIDI start command",d);break}case U.Knob:{y===1?(S=e.onmodwheel)==null||S.call(e,f):t("unknown MIDI knob command",d);break}case U.PitchBend:{t("unhandled MIDI pitch bend",d);break}default:t("unrecognized MIDI command",d)}},h=[],u=()=>{for(const r of h)r();h.length=0};Te(u);const g=r=>{if(h.length&&u(),!!r)for(const d of r.inputs.values())d.addEventListener("midimessage",c),h.push(()=>{d.removeEventListener("midimessage",c)})};Ee(()=>g(e.midi_access)),R()}var qe=P("‚Üê",1),Je=P('<button type="button" class="icon_button plain_button svelte-1gk9bl5"><!></button>');function tt(n,e){Q(e,!0);const t=v(e,"title",3,"go back");var c=Je();c.__click=function(...u){var g;(g=e.onclick)==null||g.apply(this,u)};var h=se(c);X(h,()=>e.children,u=>{var g=le(),r=ce(g);he(r,()=>e.children),z(u,g)},u=>{var g=qe();z(u,g)}),q(c),j(()=>Y(c,"title",t())),z(n,c),R()}re(["click"]);export{tt as B,et as M,$e as P,pe as b};
