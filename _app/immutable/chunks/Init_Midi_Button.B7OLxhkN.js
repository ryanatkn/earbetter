import{a as o,t as d,s as j,c as O,b as Y,d as Z}from"./disclose-version.Bm39VVKR.js";import{i as $,aA as ee,b as ae,C as te,e as P,u as re,s as k,c as _,r as u,t as V,g as n,p as se,a as ie,j as A,_ as G,f as S,d as z,n as ne}from"./index-client.CU3AkS2I.js";import{d as oe,s as g,r as H,e as Q,i as R}from"./string.zkJUj9Mg.js";import{b as le,p as T,a as W,i as h}from"./props.Du8wBp8y.js";import{r as ce,D as ue,q as ve,t as F,u as U}from"./index.C8uV2S4O.js";function Oe(e,a,s,r=!0){r&&s();for(var t of a)e.addEventListener(t,s);$(()=>{for(var i of a)e.removeEventListener(i,s)})}function X(e,a,s,r=s){e.addEventListener(a,s);const t=e.__on_r;t?e.__on_r=()=>{t(),r()}:e.__on_r=r,oe()}function J(e,a,s=a){var r=ee();X(e,"input",()=>{var t=K(e)?N(e.value):e.value;s(t),r&&t!==(t=a())&&(e.value=t??"")}),ae(()=>{var t=a();if(te&&e.defaultValue!==e.value){s(e.value);return}K(e)&&t===N(e.value)||e.type==="date"&&!t&&!e.value||(e.value=t??"")})}function K(e){var a=e.type;return a==="number"||a==="range"}function N(e){return e===""?null:+e}function B(e,a,s){if(e.multiple)return fe(e,a);for(var r of e.options){var t=M(r);if(le(t,a)){r.selected=!0;return}}(!s||a!==void 0)&&(e.selectedIndex=-1)}function _e(e,a){let s=!0;P(()=>{a&&B(e,re(a),s),s=!1;var r=new MutationObserver(()=>{var t=e.__value;B(e,t)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function de(e,a,s=a){var r=!0;X(e,"change",()=>{var t;if(e.multiple)t=[].map.call(e.querySelectorAll(":checked"),M);else{var i=e.querySelector(":checked");t=i&&M(i)}s(t)}),P(()=>{var t=a();if(B(e,t,r),r&&t===void 0){var i=e.querySelector(":checked");i!==null&&(t=M(i),s(t))}e.__value=t,r=!1}),_e(e)}function fe(e,a){for(var s of e.options)s.selected=~a.indexOf(M(s))}function M(e){return"__value"in e?e.__value:e.value}let y;const me=e=>{console.log("resetting midi_access"),y=void 0,e.midi_access=null},be=async e=>{const a=e.midi_access;if(a)return a;if(y)return y;const s=ce();y=s,console.log("request_access midi_access",s);try{const r=await s;return s!==y?y:(e.midi_access=r,r)}catch(r){return console.error("request_access failed",r),y}};var pe=d('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"> <input type="range"></div></label>');function Se(e,a){let s=T(a,"volume",31,()=>W(ue));var r=pe(),t=k(_(r),2),i=_(t);H(i),g(i,"step",.01),g(i,"min",0),g(i,"max",1);var f=k(i,2);H(f),g(f,"step",.01),g(f,"min",0),g(f,"max",1),u(t),u(r),J(i,s),J(f,s),o(e,r)}var ge=d("<option> </option>"),ye=d('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function ze(e,a){let s=T(a,"instrument",15);var r=ye(),t=_(r),i=k(_(t),2);Q(i,21,()=>ve,R,(f,m)=>{var l=ge(),D={},b=_(l);u(l),V(()=>{D!==(D=n(m))&&(l.value=(l.__value=n(m))==null?"":n(m)),j(b,n(m))}),o(f,l)}),u(i),u(t),u(r),de(i,s),o(e,r)}var Ie=async(e,a,s,r,t)=>{console.log("requesting midi access"),A(a,"pending");try{me(s.midi_state),await r()(s.midi_state),A(a,"success")}catch(i){console.error("failed to request midi access",i),A(a,"failure"),A(t,W(i.message))}},qe=d('<li class="svelte-13ivzsn"><small> </small></li>'),xe=d("<div><div>MIDI devices</div> <ul></ul></div>"),he=d("<span>no MIDI devices found, try again?</span>"),Me=d("<span>requesting MIDI access</span>"),ke=d("<span>failed to request MIDI access<!></span>"),De=d("connect MIDI &nbsp;<code>c</code>",1),Le=d('<button type="button" class="big svelte-13ivzsn"><!></button>');function Fe(e,a){se(a,!0);const s=T(a,"request_access",3,be);let r=G("initial");const t=z(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),i=z(()=>{var b;return((b=n(t))==null?void 0:b.length)??0}),f=z(()=>n(i)>0||n(r)==="pending");let m=G(void 0);var l=Le();l.__click=[Ie,r,a,s,m];var D=_(l);h(D,()=>a.midi_state.midi_access,b=>{var I=O(),C=S(I);h(C,()=>{var v;return(v=n(t))==null?void 0:v.length},v=>{var c=xe(),L=k(_(c),2);Q(L,21,()=>n(t),R,(q,p)=>{var x=qe(),w=_(x),E=_(w);u(w),u(x),V(()=>j(E,n(p).name)),o(q,x)}),u(L),u(c),o(v,c)},v=>{var c=he();F(1,c,()=>U),o(v,c)}),o(b,I)},b=>{var I=O(),C=S(I);h(C,()=>n(r)==="pending",v=>{var c=Me();F(1,c,()=>U),o(v,c)},v=>{var c=O(),L=S(c);h(L,()=>n(r)==="failure",q=>{var p=ke(),x=k(_(p));h(x,()=>n(m),w=>{var E=Y();V(()=>j(E,`: ${n(m)??""}`)),o(w,E)}),u(p),F(1,p,()=>U),o(q,p)},q=>{var p=De();ne(),o(q,p)},!0),o(v,c)},!0),o(b,I)}),u(l),V(()=>{l.disabled=n(f),g(l,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),o(e,l),ie()}Z(["click"]);export{ze as I,Se as V,de as a,J as b,Fe as c,_e as i,Oe as l,be as r,B as s};
