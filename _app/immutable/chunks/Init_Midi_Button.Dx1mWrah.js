import{h as ee,c as m,s as b,a as o,t as g,r as _,b as U,d as S,f as L,e as ae,u as te}from"./disclose-version.C5EwI3-V.js";import{d as re,s as I,r as J,e as R,i as W}from"./style.BTM4hw-r.js";import{b as se,r as ie,e as X,u as ne,t as V,H as D,p as oe,a as ue,s as E,j as K,g as f,d as z}from"./index-client.Cqv4GYu1.js";import{b as ce,p as B,a as Y,i as k}from"./props.DNuZbuIM.js";import{r as le,D as ve,q as _e,t as C,u as F}from"./index.D3MZVUk2.js";function ze(e,a,t,r=!0){r&&t();for(var s of a)e.addEventListener(s,t);se(()=>{for(var i of a)e.removeEventListener(i,t)})}function Z(e,a,t,r=t){e.addEventListener(a,t);const s=e.__on_r;s?e.__on_r=()=>{s(),r()}:e.__on_r=r,re()}function N(e,a,t){Z(e,"input",()=>{t(P(e)?Q(e.value):e.value)}),ie(()=>{var r=a();if(ee&&e.defaultValue!==e.value){t(e.value);return}P(e)&&r===Q(e.value)||e.type==="date"&&!r&&!e.value||(e.value=r??"")})}function P(e){var a=e.type;return a==="number"||a==="range"}function Q(e){return e===""?null:+e}function j(e,a,t){if(e.multiple)return me(e,a);for(var r of e.options){var s=w(r);if(ce(s,a)){r.selected=!0;return}}(!t||a!==void 0)&&(e.selectedIndex=-1)}function de(e,a){let t=!0;X(()=>{a&&j(e,ne(a),t),t=!1;var r=new MutationObserver(()=>{var s=e.__value;j(e,s)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function fe(e,a,t){var r=!0;Z(e,"change",()=>{var s;if(e.multiple)s=[].map.call(e.querySelectorAll(":checked"),w);else{var i=e.querySelector(":checked");s=i&&w(i)}t(s)}),X(()=>{var s=a();if(j(e,s,r),r&&s===void 0){var i=e.querySelector(":checked");i!==null&&(s=w(i),t(s))}e.__value=s,r=!1}),de(e)}function me(e,a){for(var t of e.options)t.selected=~a.indexOf(w(t))}function w(e){return"__value"in e?e.__value:e.value}let x;const be=e=>{console.log("resetting midi_access"),x=void 0,e.midi_access=null},ge=async e=>{const a=e.midi_access;if(a)return a;if(x)return x;const t=le();x=t,console.log("request_access midi_access",t);try{const r=await t;return t!==x?x:(e.midi_access=r,r)}catch(r){return console.error("request_access failed",r),x}};var pe=g('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"> <input type="range"></div></label>');function Ce(e,a){let t=B(a,"volume",15,()=>Y(ve));var r=pe(),s=m(r),i=b(b(s,!0)),c=m(i);J(c),I(c,"step",.01),I(c,"min",0),I(c,"max",1);var u=b(b(c,!0));J(u),I(u,"step",.01),I(u,"min",0),I(u,"max",1),_(i),_(r),N(c,t,n=>t(n)),N(u,t,n=>t(n)),o(e,r)}var ye=g("<option> </option>"),Ie=g('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function Fe(e,a){let t=B(a,"instrument",7);var r=Ie(),s=m(r),i=m(s),c=b(b(i,!0));R(c,73,()=>_e,W,(u,n,H)=>{var l=ye(),y={},M=m(l);_(l),V(()=>{y!==(y=D(n))&&(l.value=(l.__value=D(n))==null?"":D(n)),U(M,D(n))}),o(u,l)}),_(c),_(s),_(r),fe(c,t,u=>t(u)),o(e,r)}var xe=async(e,a,t,r,s)=>{console.log("requesting midi access"),E(a,"pending");try{be(t.midi_state),await r()(t.midi_state),E(a,"success")}catch(i){console.error("failed to request midi access",i),E(a,"failure"),E(s,Y(i.message))}},qe=g('<li class="svelte-13ivzsn"><small> </small></li>'),he=g("<div><div>MIDI devices</div> <ul></ul></div>"),Me=g("<span>no MIDI devices found, try again?</span>"),ke=g("<span>requesting MIDI access</span>"),De=g("<span>failed to request MIDI access<!></span>"),we=g("connect MIDI &nbsp;<code>c</code>",1),Le=g('<button type="button" class="big svelte-13ivzsn"><!></button>');function Ue(e,a){oe(a,!0);const t=B(a,"request_access",3,ge);let r=K("initial");const s=z(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),i=z(()=>{var l;return((l=f(s))==null?void 0:l.length)??0}),c=z(()=>f(i)>0||f(r)==="pending");let u=K(void 0);var n=Le();n.__click=[xe,r,a,t,u];var H=m(n);k(H,()=>a.midi_state.midi_access,l=>{var y=S(),M=L(y);k(M,()=>{var d;return(d=f(s))==null?void 0:d.length},d=>{var v=he(),A=m(v),q=b(b(A,!0));R(q,73,()=>f(s),W,(p,O,T)=>{var h=qe(),G=m(h),$=m(G);_(G),_(h),V(()=>U($,D(O).name)),o(p,h)}),_(q),_(v),o(d,v)},d=>{var v=Me();C(1,v,()=>F),o(d,v)}),o(l,y)},l=>{var y=S(),M=L(y);k(M,()=>f(r)==="pending",d=>{var v=ke();C(1,v,()=>F),o(d,v)},d=>{var v=S(),A=L(v);k(A,()=>f(r)==="failure",q=>{var p=De(),O=b(m(p));k(O,()=>f(u),T=>{var h=ae();V(()=>U(h,`: ${f(u)??""}`)),o(T,h)}),_(p),C(1,p,()=>F),o(q,p)},q=>{var p=we();b(L(p,!0)),o(q,p)},!0),o(d,v)},!0),o(l,y)}),_(n),V(()=>{n.disabled=f(c),I(n,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),o(e,n),ue()}te(["click"]);export{Fe as I,Ce as V,fe as a,N as b,Ue as c,de as i,ze as l,ge as r,j as s};
