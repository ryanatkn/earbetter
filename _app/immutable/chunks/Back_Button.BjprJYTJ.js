var ye=Object.defineProperty;var me=(n,e,t)=>e in n?ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var re=(n,e,t)=>(me(n,typeof e!="symbol"?e+"":e,t),t),ee=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var S=(n,e,t)=>(ee(n,e,"read from private field"),t?t.call(n):e.get(n)),Y=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},te=(n,e,t,c)=>(ee(n,e,"write to private field"),c?c.call(n,t):e.set(n,t),t);var de=(n,e,t)=>(ee(n,e,"access private method"),t);import{e as we,u as xe,p as C,g as s,t as Q,a as p,d as r,s as ne,j as Te,H as P,G as Ee,F as Me}from"./index-client.Cqv4GYu1.js";import{u as he,c as le,e as ze,b as Le,a as z,d as ce,f as ue,r as R,q as F,t as G,$ as ae}from"./disclose-version.C5EwI3-V.js";import{c as fe,s as q,t as B,b as K,e as He}from"./style.BTM4hw-r.js";import{p as y,i as O}from"./props.DNuZbuIM.js";import{C as ge,s as oe,E as ie,F as Se,a as Be,b as Ae,H as Ie}from"./index.D3MZVUk2.js";var A,D,X,V,be;const Z=class Z{constructor(e){Y(this,V);Y(this,A,new WeakMap);Y(this,D,void 0);Y(this,X,void 0);te(this,X,e)}observe(e,t){var c=S(this,A).get(e)||new Set;return c.add(t),S(this,A).set(e,c),de(this,V,be).call(this).observe(e,S(this,X)),()=>{var g=S(this,A).get(e);g.delete(t),g.size===0&&(S(this,A).delete(e),S(this,D).unobserve(e))}}};A=new WeakMap,D=new WeakMap,X=new WeakMap,V=new WeakSet,be=function(){return S(this,D)??te(this,D,new ResizeObserver(e=>{for(var t of e){Z.entries.set(t.target,t);for(var c of S(this,A).get(t.target)||[])c(t)}}))},re(Z,"entries",new WeakMap);let _e=Z;var Ke=new _e({box:"border-box"});function $e(n,e,t){var c=Ke.observe(n,()=>t(n[e]));we(()=>(xe(()=>t(n[e])),c))}const Pe=(n,e)=>{let t=n.previousSibling;for(;t;){if(e(t))return t;t=t.previousSibling}return null},De=(n,e)=>{let t=n.nextSibling;for(;t;){if(e(t))return t;t=t.nextSibling}return null};var Ge=G("C4",1),Ne=G('<div class="middle_c svelte-gdrax4"><!></div>'),Ue=G('<button type="button" class="piano_key svelte-gdrax4"><!></button>');function We(n,e){C(e,!0);const t=y(e,"clickable",3,!0),c=y(e,"enabled",3,!0),g=y(e,"pressed",3,!1),d=y(e,"highlighted",3,!1),v=y(e,"emphasized",3,!1),o=y(e,"middle_c_label",3,!0),u=y(e,"allow_sticking",3,!1),k=r(()=>ge.has(e.note)),x=r(()=>!s(k)),h=r(()=>e.note===60),b=i=>{const a=Pe(i,w=>w instanceof HTMLButtonElement);a==null||a.focus()},L=i=>{const a=De(i,w=>w instanceof HTMLButtonElement);a==null||a.focus()},T=i=>{var w;const{key:a}=i;switch(a){case" ":case"Enter":{oe(i),(w=e.onpress)==null||w.call(e,e.note),i.currentTarget.focus();break}case"ArrowLeft":{b(i.currentTarget);break}case"ArrowRight":{L(i.currentTarget);break}}},E=i=>{var w;const{key:a}=i;switch(a){case" ":case"Enter":{oe(i),(w=e.onrelease)==null||w.call(e,e.note);break}}},f=r(()=>t()&&c());var l=Ue();l.__keydown=function(...i){var a;return(a=s(f)?T:void 0)==null?void 0:a.apply(this,i)},l.__keyup=function(...i){var a;return(a=s(f)?E:void 0)==null?void 0:a.apply(this,i)};var _=r(()=>s(f)?i=>{var a;(a=e.onpress)==null||a.call(e,e.note),i.currentTarget.focus()}:void 0);l.__mousedown=function(...i){var a;return(a=s(_))==null?void 0:a.apply(this,i)};var M=r(()=>s(f)?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0);l.__mouseup=function(...i){var a;return(a=s(M))==null?void 0:a.apply(this,i)};var I=r(()=>s(f)&&e.pressing_any?i=>{var a;(a=e.onpress)==null||a.call(e,e.note),i.currentTarget.focus()}:void 0),N=r(()=>s(f)?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0),H=r(()=>s(f)&&!u()?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0);l.__focusout=function(...i){var a;return(a=s(H))==null?void 0:a.apply(this,i)};var U=le(l);O(U,()=>s(h)&&o(),i=>{var a=Ne(),w=le(a);O(w,()=>typeof o()=="string",W=>{var m=ze();Q(()=>Le(m,o())),z(W,m)},W=>{var m=ce(),ve=ue(m);O(ve,()=>typeof o()=="boolean",$=>{var J=Ge();z($,J)},$=>{var J=ce(),ke=ue(J);fe(ke,o),z($,J)},!0),z(W,m)}),R(a),z(i,a)}),R(l),Q(()=>{q(l,"tabindex",s(f)?void 0:-1),q(l,"aria-label",`piano key for midi ${e.note??""}`),q(l,"data-note",e.note),B(l,"natural",s(k)),B(l,"accidental",s(x)),B(l,"disabled",!c()),B(l,"clickable",s(f)),B(l,"active",g()),B(l,"highlighted",d()),B(l,"emphasized",v()),K(l,"left",`${e.left_offset??""}px`)}),F("mouseenter",l,function(...i){var a;return(a=s(I))==null?void 0:a.apply(this,i)},!1),F("mouseleave",l,function(...i){var a;return(a=s(N))==null?void 0:a.apply(this,i)},!1),z(n,l),p()}he(["keydown","keyup","mousedown","mouseup","focusout"]);const Ye=5,je=7/12,Fe=.7,se={1:0,2:-3/5,3:0,4:-2/5,5:0,6:0,7:-2/3,8:0,9:-1/2,10:0,11:-1/3,12:0},qe=(n,e,t,c=500)=>{const g=Math.abs(se[ie[e]]);let d=Math.abs(se[ie[t]]);d&&(d=1-d);const v=t-e+1;if(v<=0)return{piano_keys:[],natural_key_height:c,natural_key_width:0,accidental_key_height:0,accidental_key_width:0};const o=Se(e,t),u=n/(o.length+(g+d))|0,k=u*je|0,x=Math.min(c,k*Ye)|0,h=x*Fe|0;let b=0;const L=[];for(let T=0;T<v;T++){const E=T+e;let f,l,_;ge.has(E)?(f=u,l=x,_=b*u+g*k,b++):(f=k,l=h,_=b*u+se[ie[E]]*k+g*k),L.push({note:E,left_offset:_,width:f,height:l})}return{piano_keys:L,natural_key_height:x,natural_key_width:u,accidental_key_height:h,accidental_key_width:k}};var Xe=G('<div class="piano svelte-d5674k"></div>');function et(n,e){C(e,!0);const t=y(e,"max_height",11,()=>{}),c=y(e,"min_note",3,Be),g=y(e,"max_note",3,Ae),d=y(e,"enabled_notes",3,null),v=y(e,"pressed_keys",3,null),o=y(e,"highlighted_keys",3,null),u=y(e,"emphasized_keys",3,null),k=y(e,"clickable",3,!0),x=r(()=>qe(e.width,c(),g(),t())),h=r(()=>{let{piano_keys:M,natural_key_width:I,natural_key_height:N,accidental_key_width:H,accidental_key_height:U}=s(x);return[M,I,N,H,U]}),b=r(()=>s(h)[0]),L=r(()=>s(h)[1]),T=r(()=>s(h)[2]),E=r(()=>s(h)[3]),f=r(()=>s(h)[4]);let l=Te(!1);var _=Xe();F("mousedown",ae,()=>ne(l,!0),!0),F("mouseup",ae,()=>ne(l,!1),!0),F("mouseleave",ae,()=>ne(l,!1),!1),He(_,77,()=>s(b),(M,I)=>P(P(M)).note,(M,I,N)=>{let H=()=>P(P(I)).note,U=()=>P(P(I)).left_offset;var i=r(()=>!d()||d().has(H())),a=r(()=>{var m;return(m=v())==null?void 0:m.has(H())}),w=r(()=>{var m;return(m=o())==null?void 0:m.has(H())}),W=r(()=>{var m;return(m=u())==null?void 0:m.has(H())});We(M,{get note(){return H()},get left_offset(){return U()},get clickable(){return k()},get enabled(){return s(i)},get pressed(){return s(a)},get highlighted(){return s(w)},get emphasized(){return s(W)},get middle_c_label(){return e.middle_c_label},get allow_sticking(){return e.allow_sticking},get pressing_any(){return s(l)},get onpress(){return e.onpress},get onrelease(){return e.onrelease}})}),R(_),Q(()=>{q(_,"aria-disabled",!k()),B(_,"disabled",!k()),K(_,"width",`${e.width??""}px`),K(_,"height",`${s(T)??""}px`),K(_,"--piano_natural_key_width",`${s(L)??""}px`),K(_,"--piano_natural_key_height",`${s(T)??""}px`),K(_,"--piano_accidental_key_width",`${s(E)??""}px`),K(_,"--piano_accidental_key_height",`${s(f)??""}px`)}),z(n,_),p()}var j=(n=>(n[n.Stop=8]="Stop",n[n.Start=9]="Start",n[n.Knob=11]="Knob",n[n.PitchBend=14]="PitchBend",n))(j||{});function tt(n,e){C(e,!0);const t=console.log.bind(console),c=o=>{var L,T,E,f,l,_,M;const u=Ie(o),{command:k,channel:x,note:h,velocity:b}=u;switch(t("midimessage",k,u),k){case j.Stop:{x===0?(L=e.onnotestop)==null||L.call(e,h,b):x===9?(T=e.onpadstop)==null||T.call(e,h,b):t("unknown MIDI stop command",u);break}case j.Start:{x===0?b===0?(E=e.onnotestop)==null||E.call(e,h,b):(f=e.onnotestart)==null||f.call(e,h,b):x===9?b===0?(l=e.onpadstop)==null||l.call(e,h,b):(_=e.onpadstart)==null||_.call(e,h,b):t("unknown MIDI start command",u);break}case j.Knob:{h===1?(M=e.onmodwheel)==null||M.call(e,b):t("unknown MIDI knob command",u);break}case j.PitchBend:{t("unhandled MIDI pitch bend",u);break}default:t("unrecognized MIDI command",u)}},g=[],d=()=>{for(const o of g)o();g.length=0};Ee(d);const v=o=>{if(g.length&&d(),!!o)for(const u of o.inputs.values())u.addEventListener("midimessage",c),g.push(()=>{u.removeEventListener("midimessage",c)})};Me(()=>v(e.midi_access)),p()}var Je=G("‚Üê",1),Oe=G('<button type="button" class="icon_button plain_button svelte-1gk9bl5"><!></button>');function nt(n,e){C(e,!0);const t=y(e,"title",3,"go back");var c=Oe();c.__click=function(...d){var v;return(v=e.onclick)==null?void 0:v.apply(this,d)};var g=le(c);O(g,()=>e.children,d=>{var v=ce(),o=ue(v);fe(o,()=>e.children),z(d,v)},d=>{var v=Je();z(d,v)}),R(c),Q(()=>q(c,"title",t())),z(n,c),p()}he(["click"]);export{nt as B,tt as M,et as P,$e as b};
