import"./DsnmJJEf.js";import{af as ae,ae as te,u as se,h as re,v as ie,D as q,ag as le,p as J,f as b,b as l,c as K,O as ne,s as M,d as f,r as u,t as V,e as H,$ as R,Q as E,i as m,j,a3 as ce,k as B,a as F,n as oe,l as ve}from"./CJaerUHp.js";import{s as y,d as X,e as Z,f as ue}from"./yq475m88.js";import{p as N,i as D}from"./C-YpJhoF.js";import{r as _e,D as de,u as me,t as Q,v as T}from"./1gEw6I4J.js";function Y(e,a,i=a){var s=new WeakSet;ae(e,"input",async r=>{var t=r?e.defaultValue:e.value;if(t=W(e)?G(t):t,i(t),q!==null&&s.add(q),await te(),t!==(t=a())){var n=e.selectionStart,_=e.selectionEnd;e.value=t??"",_!==null&&(e.selectionStart=n,e.selectionEnd=Math.min(_,e.value.length))}}),(ie&&e.defaultValue!==e.value||se(a)==null&&e.value)&&(i(W(e)?G(e.value):e.value),q!==null&&s.add(q)),re(()=>{var r=a();if(e===document.activeElement){var t=le??q;if(s.has(t))return}W(e)&&r===G(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function W(e){var a=e.type;return a==="number"||a==="range"}function G(e){return e===""?null:+e}let h;const fe=e=>{console.log("resetting midi_access"),h=void 0,e.midi_access=null},be=async e=>{const a=e.midi_access;if(a)return a;if(h)return h;const i=_e();h=i,console.log("request_access midi_access",i);try{const s=await i;return i!==h?h:(e.midi_access=s,s)}catch(s){return console.error("request_access failed",s),h}};var ge=b('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"/> <input type="range"/></div></label>');function Ce(e,a){J(a,!0);let i=N(a,"volume",31,()=>ne(de));var s=ge(),r=M(f(s),2),t=f(r);X(t),y(t,"step",.01),y(t,"min",0),y(t,"max",1);var n=M(t,2);X(n),y(n,"step",.01),y(n,"min",0),y(n,"max",1),u(r),u(s),Y(t,i),Y(n,i),l(e,s),K()}var ye=b("<option> </option>"),he=b('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function Le(e,a){J(a,!0);let i=N(a,"instrument",15);var s=he(),r=f(s),t=M(f(r),2);Z(t,20,()=>me,n=>n,(n,_)=>{var o=ye(),S=f(o,!0);u(o);var k={};V(()=>{H(S,_),k!==(k=_)&&(o.value=(o.__value=_)??"")}),l(n,o)}),u(t),u(r),u(s),ue(t,i),l(e,s),K()}var Ie=async(e,a,i,s,r)=>{console.log("requesting midi access"),E(a,"pending");try{fe(i.midi_state),await s()(i.midi_state),E(a,"success")}catch(t){console.error("failed to request midi access",t),E(a,"failure"),E(r,t.message,!0)}},pe=b('<li class="svelte-13ivzsn"><small> </small></li>'),xe=b("<div><div>MIDI devices</div> <ul></ul></div>"),qe=b("<span>no MIDI devices found, try again?</span>"),De=b("<span>requesting MIDI access</span>"),Me=b("<span>failed to request MIDI access<!></span>"),ke=b("connect MIDI &nbsp;<code>c</code>",1),we=b('<button type="button" class="big svelte-13ivzsn"><!></button>');function Oe(e,a){J(a,!0);const i=N(a,"request_access",3,be);let s=R("initial");const r=j(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),t=j(()=>m(r)?.length??0),n=j(()=>m(t)>0||m(s)==="pending");let _=R(void 0);var o=we();o.__click=[Ie,s,a,i,_];var S=f(o);{var k=I=>{var p=B(),z=F(p);{var A=c=>{var v=xe(),w=M(f(v),2);Z(w,20,()=>m(r),x=>x,(x,L)=>{var d=pe(),g=f(d),O=f(g,!0);u(g),u(d),V(()=>H(O,L.name)),l(x,d)}),u(w),u(v),l(c,v)},C=c=>{var v=qe();Q(1,v,()=>T),l(c,v)};D(z,c=>{m(r)?.length?c(A):c(C,!1)})}l(I,p)},$=I=>{var p=B(),z=F(p);{var A=c=>{var v=De();Q(1,v,()=>T),l(c,v)},C=c=>{var v=B(),w=F(v);{var x=d=>{var g=Me(),O=M(f(g));{var ee=U=>{var P=ve();V(()=>H(P,`: ${m(_)??""}`)),l(U,P)};D(O,U=>{m(_)&&U(ee)})}u(g),Q(1,g,()=>T),l(d,g)},L=d=>{var g=ke();oe(),l(d,g)};D(w,d=>{m(s)==="failure"?d(x):d(L,!1)},!0)}l(c,v)};D(z,c=>{m(s)==="pending"?c(A):c(C,!1)},!0)}l(I,p)};D(S,I=>{a.midi_state.midi_access?I(k):I($,!1)})}u(o),V(()=>{o.disabled=m(n),y(o,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),l(e,o),K()}ce(["click"]);export{Le as I,Ce as V,Oe as a,Y as b,be as r};
