var Ee=Object.defineProperty;var Me=(a,e,t)=>e in a?Ee(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var oe=(a,e,t)=>(Me(a,typeof e!="symbol"?e+"":e,t),t),ee=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var z=(a,e,t)=>(ee(a,e,"read from private field"),t?t.call(a):e.get(a)),Y=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},te=(a,e,t,_)=>(ee(a,e,"write to private field"),_?_.call(a,t):e.set(a,t),t);var re=(a,e,t)=>(ee(a,e,"access private method"),t);import{e as ze,u as Le,a as O,g as l,c as le,r as Z,t as j,p as Q,d as o,f as ce,k as ne,$ as ae,_ as Se,Z as Be,Y as He}from"./index-client.BoISVktJ.js";import{h as fe,g as U,a as M,t as R,e as _e,b as Ae,d as de}from"./disclose-version.DbIX9lBU.js";import{s as W,t as S,b as A,c as ge,e as Ie}from"./string.CP9_p8aN.js";import{p as b,i as X}from"./props.Dc3VY8m1.js";import{s as he,C as be,E as ie,F as Ke,a as Pe,b as De,H as Ye}from"./index.DY9TdQ-H.js";var B,P,G,q,ve;const J=class J{constructor(e){Y(this,q);Y(this,B,new WeakMap);Y(this,P,void 0);Y(this,G,void 0);te(this,G,e)}observe(e,t){var _=z(this,B).get(e)||new Set;return _.add(t),z(this,B).set(e,_),re(this,q,ve).call(this).observe(e,z(this,G)),()=>{var h=z(this,B).get(e);h.delete(t),h.size===0&&(z(this,B).delete(e),z(this,P).unobserve(e))}}};B=new WeakMap,P=new WeakMap,G=new WeakMap,q=new WeakSet,ve=function(){return z(this,P)??te(this,P,new ResizeObserver(e=>{for(var t of e){J.entries.set(t.target,t);for(var _ of z(this,B).get(t.target)||[])_(t)}}))},oe(J,"entries",new WeakMap);let ue=J;var Ne=new ue({box:"border-box"});function tt(a,e,t){var _=Ne.observe(a,()=>t(a[e]));ze(()=>(Le(()=>t(a[e])),_))}const Ue=(a,e)=>{let t=a.previousSibling;for(;t;){if(e(t))return t;t=t.previousSibling}return null},We=(a,e)=>{let t=a.nextSibling;for(;t;){if(e(t))return t;t=t.nextSibling}return null};var Ge=R('<div class="middle_c svelte-gdrax4"><!></div>'),Fe=R('<button type="button" class="piano_key svelte-gdrax4"><!></button>');function Xe(a,e){O(e,!0);const t=b(e,"clickable",3,!0),_=b(e,"enabled",3,!0),h=b(e,"pressed",3,!1),v=b(e,"highlighted",3,!1),w=b(e,"emphasized",3,!1),d=b(e,"middle_c_label",3,!0),c=b(e,"allow_sticking",3,!1),r=o(()=>be.has(e.note)),g=o(()=>!l(r)),k=o(()=>e.note===60),f=i=>{const n=Ue(i,m=>m instanceof HTMLButtonElement);n==null||n.focus()},x=i=>{const n=We(i,m=>m instanceof HTMLButtonElement);n==null||n.focus()},T=i=>{var m;const{key:n}=i;switch(n){case" ":case"Enter":{he(i),(m=e.onpress)==null||m.call(e,e.note),i.currentTarget.focus();break}case"ArrowLeft":{f(i.currentTarget);break}case"ArrowRight":{x(i.currentTarget);break}}},E=i=>{var m;const{key:n}=i;switch(n){case" ":case"Enter":{he(i),(m=e.onrelease)==null||m.call(e,e.note);break}}},u=o(()=>t()&&_());var s=Fe();s.__keydown=function(...i){var n;(n=l(u)?T:void 0)==null||n.apply(this,i)},s.__keyup=function(...i){var n;(n=l(u)?E:void 0)==null||n.apply(this,i)};var y=o(()=>l(u)?i=>{var n;(n=e.onpress)==null||n.call(e,e.note),i.currentTarget.focus()}:void 0);s.__mousedown=function(...i){var n;(n=l(y))==null||n.apply(this,i)};var L=o(()=>l(u)?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0);s.__mouseup=function(...i){var n;(n=l(L))==null||n.apply(this,i)};var H=o(()=>l(u)&&e.pressing_any?i=>{var n;(n=e.onpress)==null||n.call(e,e.note),i.currentTarget.focus()}:void 0),V=o(()=>l(u)?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0),C=o(()=>l(u)&&!c()?()=>{var i;(i=e.onrelease)==null||i.call(e,e.note)}:void 0);s.__focusout=function(...i){var n;(n=l(C))==null||n.apply(this,i)};var p=le(s);{var $=i=>{var n=Ge(),m=le(n);{var ke=I=>{var D=_e();j(()=>Ae(D,d())),M(I,D)},ye=I=>{var D=de(),me=ce(D);{var we=K=>{var F=_e("C4");M(K,F)},xe=K=>{var F=de(),Te=ce(F);ge(Te,d),M(K,F)};X(me,K=>{typeof d()=="boolean"?K(we):K(xe,!1)},!0)}M(I,D)};X(m,I=>{typeof d()=="string"?I(ke):I(ye,!1)})}Z(n),M(i,n)};X(p,i=>{l(k)&&d()&&i($)})}Z(s),j(()=>{W(s,"tabindex",l(u)?void 0:-1),W(s,"aria-label",`piano key for midi ${e.note??""}`),W(s,"data-note",e.note),S(s,"natural",l(r)),S(s,"accidental",l(g)),S(s,"disabled",!_()),S(s,"clickable",l(u)),S(s,"active",h()),S(s,"highlighted",v()),S(s,"emphasized",w()),A(s,"left",`${e.left_offset??""}px`)}),U("mouseenter",s,function(...i){var n;(n=l(H))==null||n.apply(this,i)}),U("mouseleave",s,function(...i){var n;(n=l(V))==null||n.apply(this,i)}),M(a,s),Q()}fe(["keydown","keyup","mousedown","mouseup","focusout"]);const Ze=5,je=7/12,qe=.7,se={1:0,2:-3/5,3:0,4:-2/5,5:0,6:0,7:-2/3,8:0,9:-1/2,10:0,11:-1/3,12:0},Je=(a,e,t,_=500)=>{const h=Math.abs(se[ie[e]]);let v=Math.abs(se[ie[t]]);v&&(v=1-v);const w=t-e+1;if(w<=0)return{piano_keys:[],natural_key_height:_,natural_key_width:0,accidental_key_height:0,accidental_key_width:0};const d=Ke(e,t),c=a/(d.length+(h+v))|0,r=c*je|0,g=Math.min(_,r*Ze)|0,k=g*qe|0;let f=0;const x=[];for(let T=0;T<w;T++){const E=T+e;let u,s,y;be.has(E)?(u=c,s=g,y=f*c+h*r,f++):(u=r,s=k,y=f*c+se[ie[E]]*r+h*r),x.push({note:E,left_offset:y,width:u,height:s})}return{piano_keys:x,natural_key_height:g,natural_key_width:c,accidental_key_height:k,accidental_key_width:r}};var Oe=R('<div class="piano svelte-d5674k"></div>');function nt(a,e){O(e,!0);const t=b(e,"max_height",3,void 0),_=b(e,"min_note",3,Pe),h=b(e,"max_note",3,De),v=b(e,"enabled_notes",3,null),w=b(e,"pressed_keys",3,null),d=b(e,"highlighted_keys",3,null),c=b(e,"emphasized_keys",3,null),r=b(e,"clickable",3,!0),g=o(()=>Je(e.width,_(),h(),t())),k=o(()=>l(g).piano_keys),f=o(()=>l(g).natural_key_width),x=o(()=>l(g).natural_key_height),T=o(()=>l(g).accidental_key_width),E=o(()=>l(g).accidental_key_height);let u=Se(!1);var s=Oe();U("mousedown",ae,()=>ne(u,!0),!0),U("mouseup",ae,()=>ne(u,!1),!0),U("mouseleave",ae,()=>ne(u,!1)),Ie(s,21,()=>l(k),({note:y,left_offset:L})=>y,(y,L)=>{let H=()=>l(L).note,V=()=>l(L).left_offset;var C=o(()=>!v()||v().has(H())),p=o(()=>{var n;return(n=w())==null?void 0:n.has(H())}),$=o(()=>{var n;return(n=d())==null?void 0:n.has(H())}),i=o(()=>{var n;return(n=c())==null?void 0:n.has(H())});Xe(y,{get note(){return H()},get left_offset(){return V()},get clickable(){return r()},get enabled(){return l(C)},get pressed(){return l(p)},get highlighted(){return l($)},get emphasized(){return l(i)},get middle_c_label(){return e.middle_c_label},get allow_sticking(){return e.allow_sticking},get pressing_any(){return l(u)},get onpress(){return e.onpress},get onrelease(){return e.onrelease}})}),Z(s),j(()=>{W(s,"aria-disabled",!r()),S(s,"disabled",!r()),A(s,"width",`${e.width??""}px`),A(s,"height",`${l(x)??""}px`),A(s,"--piano_natural_key_width",`${l(f)??""}px`),A(s,"--piano_natural_key_height",`${l(x)??""}px`),A(s,"--piano_accidental_key_width",`${l(T)??""}px`),A(s,"--piano_accidental_key_height",`${l(E)??""}px`)}),M(a,s),Q()}var N=(a=>(a[a.Stop=8]="Stop",a[a.Start=9]="Start",a[a.Knob=11]="Knob",a[a.PitchBend=14]="PitchBend",a))(N||{});function at(a,e){O(e,!0);const t=console.log.bind(console),_=d=>{var x,T,E,u,s,y,L;const c=Ye(d),{command:r,channel:g,note:k,velocity:f}=c;switch(t("midimessage",r,c),r){case N.Stop:{g===0?(x=e.onnotestop)==null||x.call(e,k,f):g===9?(T=e.onpadstop)==null||T.call(e,k,f):t("unknown MIDI stop command",c);break}case N.Start:{g===0?f===0?(E=e.onnotestop)==null||E.call(e,k,f):(u=e.onnotestart)==null||u.call(e,k,f):g===9?f===0?(s=e.onpadstop)==null||s.call(e,k,f):(y=e.onpadstart)==null||y.call(e,k,f):t("unknown MIDI start command",c);break}case N.Knob:{k===1?(L=e.onmodwheel)==null||L.call(e,f):t("unknown MIDI knob command",c);break}case N.PitchBend:{t("unhandled MIDI pitch bend",c);break}default:t("unrecognized MIDI command",c)}},h=[],v=()=>{for(const d of h)d();h.length=0};Be(v);const w=d=>{if(h.length&&v(),!!d)for(const c of d.inputs.values())c.addEventListener("midimessage",_),h.push(()=>{c.removeEventListener("midimessage",_)})};He(()=>w(e.midi_access)),Q()}var Qe=R('<button type="button" class="icon_button plain_button svelte-1gk9bl5"><!></button>');function it(a,e){O(e,!0);const t=b(e,"title",3,"go back");var _=Qe();_.__click=function(...d){var c;(c=e.onclick)==null||c.apply(this,d)};var h=le(_);{var v=d=>{var c=de(),r=ce(c);ge(r,()=>e.children),M(d,c)},w=d=>{var c=_e("←");M(d,c)};X(h,d=>{e.children?d(v):d(w,!1)})}Z(_),j(()=>W(_,"title",t())),M(a,_),Q()}fe(["click"]);export{it as B,at as M,nt as P,tt as b};
