import{a as o,t as m,s as j,c as O,b as Y,d as Z}from"./disclose-version.BZ0CqQI7.js";import{i as $,b as ee,C as ae,e as P,u as te,s as k,c as f,r as v,t as A,g as n,p as re,a as se,j as V,_ as G,f as S,d as z,n as ie}from"./index-client.tYQFSbcU.js";import{d as ne,s as p,r as H,e as Q,i as R}from"./style.Hj4NPC1L.js";import{b as oe,p as T,a as W,i as h}from"./props.BUAVstng.js";import{r as ce,D as le,q as ue,t as F,u as U}from"./index.RjCIe0pU.js";function Ce(e,a,t,r=!0){r&&t();for(var s of a)e.addEventListener(s,t);$(()=>{for(var i of a)e.removeEventListener(i,t)})}function X(e,a,t,r=t){e.addEventListener(a,t);const s=e.__on_r;s?e.__on_r=()=>{s(),r()}:e.__on_r=r,ne()}function J(e,a,t){X(e,"input",()=>{t(K(e)?N(e.value):e.value)}),ee(()=>{var r=a();if(ae&&e.defaultValue!==e.value){t(e.value);return}K(e)&&r===N(e.value)||e.type==="date"&&!r&&!e.value||(e.value=r??"")})}function K(e){var a=e.type;return a==="number"||a==="range"}function N(e){return e===""?null:+e}function B(e,a,t){if(e.multiple)return de(e,a);for(var r of e.options){var s=M(r);if(oe(s,a)){r.selected=!0;return}}(!t||a!==void 0)&&(e.selectedIndex=-1)}function ve(e,a){let t=!0;P(()=>{a&&B(e,te(a),t),t=!1;var r=new MutationObserver(()=>{var s=e.__value;B(e,s)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function _e(e,a,t){var r=!0;X(e,"change",()=>{var s;if(e.multiple)s=[].map.call(e.querySelectorAll(":checked"),M);else{var i=e.querySelector(":checked");s=i&&M(i)}t(s)}),P(()=>{var s=a();if(B(e,s,r),r&&s===void 0){var i=e.querySelector(":checked");i!==null&&(s=M(i),t(s))}e.__value=s,r=!1}),ve(e)}function de(e,a){for(var t of e.options)t.selected=~a.indexOf(M(t))}function M(e){return"__value"in e?e.__value:e.value}let y;const fe=e=>{console.log("resetting midi_access"),y=void 0,e.midi_access=null},me=async e=>{const a=e.midi_access;if(a)return a;if(y)return y;const t=ce();y=t,console.log("request_access midi_access",t);try{const r=await t;return t!==y?y:(e.midi_access=r,r)}catch(r){return console.error("request_access failed",r),y}};var be=m('<label class="text_align_center"><div class="title">volume</div> <div class="row"><input type="number" class="svelte-1q1myf8"> <input type="range"></div></label>');function Oe(e,a){let t=T(a,"volume",31,()=>W(le));var r=be(),s=k(f(r),2),i=f(s);H(i),p(i,"step",.01),p(i,"min",0),p(i,"max",1);var _=k(i,2);H(_),p(_,"step",.01),p(_,"min",0),p(_,"max",1),v(s),v(r),J(i,t,c=>t(c)),J(_,t,c=>t(c)),o(e,r)}var ge=m("<option> </option>"),pe=m('<div class="mb_lg"><label class="text_align_center"><div class="title">instrument</div> <select></select></label></div>');function Se(e,a){let t=T(a,"instrument",15);var r=pe(),s=f(r),i=k(f(s),2);Q(i,21,()=>ue,R,(_,c)=>{var l=ge(),D={},b=f(l);v(l),A(()=>{D!==(D=n(c))&&(l.value=(l.__value=n(c))==null?"":n(c)),j(b,n(c))}),o(_,l)}),v(i),v(s),v(r),_e(i,t,_=>t(_)),o(e,r)}var ye=async(e,a,t,r,s)=>{console.log("requesting midi access"),V(a,"pending");try{fe(t.midi_state),await r()(t.midi_state),V(a,"success")}catch(i){console.error("failed to request midi access",i),V(a,"failure"),V(s,W(i.message))}},Ie=m('<li class="svelte-13ivzsn"><small> </small></li>'),qe=m("<div><div>MIDI devices</div> <ul></ul></div>"),xe=m("<span>no MIDI devices found, try again?</span>"),he=m("<span>requesting MIDI access</span>"),Me=m("<span>failed to request MIDI access<!></span>"),ke=m("connect MIDI &nbsp;<code>c</code>",1),De=m('<button type="button" class="big svelte-13ivzsn"><!></button>');function ze(e,a){re(a,!0);const t=T(a,"request_access",3,me);let r=G("initial");const s=z(()=>a.midi_state.midi_access&&Array.from(a.midi_state.midi_access.inputs.values())),i=z(()=>{var b;return((b=n(s))==null?void 0:b.length)??0}),_=z(()=>n(i)>0||n(r)==="pending");let c=G(void 0);var l=De();l.__click=[ye,r,a,t,c];var D=f(l);h(D,()=>a.midi_state.midi_access,b=>{var I=O(),C=S(I);h(C,()=>{var d;return(d=n(s))==null?void 0:d.length},d=>{var u=qe(),L=k(f(u),2);Q(L,21,()=>n(s),R,(q,g)=>{var x=Ie(),w=f(x),E=f(w);v(w),v(x),A(()=>j(E,n(g).name)),o(q,x)}),v(L),v(u),o(d,u)},d=>{var u=xe();F(1,u,()=>U),o(d,u)}),o(b,I)},b=>{var I=O(),C=S(I);h(C,()=>n(r)==="pending",d=>{var u=he();F(1,u,()=>U),o(d,u)},d=>{var u=O(),L=S(u);h(L,()=>n(r)==="failure",q=>{var g=Me(),x=k(f(g));h(x,()=>n(c),w=>{var E=Y();A(()=>j(E,`: ${n(c)??""}`)),o(w,E)}),v(g),F(1,g,()=>U),o(q,g)},q=>{var g=ke();ie(),o(q,g)},!0),o(d,u)},!0),o(b,I)}),v(l),A(()=>{l.disabled=n(_),p(l,"title",a.midi_state.midi_access?"MIDI is ready!":"connect your MIDI device [c]")}),o(e,l),se()}Z(["click"]);export{Se as I,Oe as V,_e as a,J as b,ze as c,ve as i,Ce as l,me as r,B as s};
