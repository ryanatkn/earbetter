var we=Object.defineProperty;var le=n=>{throw TypeError(n)};var xe=(n,e,t)=>e in n?we(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ce=(n,e,t)=>xe(n,typeof e!="symbol"?e+"":e,t),V=(n,e,t)=>e.has(n)||le("Cannot "+t);var z=(n,e,t)=>(V(n,e,"read from private field"),t?t.call(n):e.get(n)),N=(n,e,t)=>e.has(n)?le("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Z=(n,e,t,o)=>(V(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t),oe=(n,e,t)=>(V(n,e,"access private method"),t);import{e as Me,u as Te,p as ie,g as s,d as y,c as te,r as X,t as j,a as se,f as _e,F as C,N as Ee,$ as p,O as Le,M as ze}from"./D3PyqNrN.js";import{d as de,t as Q,e as W,a as S,b as ne,s as Se,c as re}from"./BkDeQcoF.js";import{c as he,s as Y,d as fe,b as ge,e as Be}from"./D8xi9fHe.js";import{p as b,i as O}from"./DZ3TPD6y.js";import{C as be,s as ue,E as $,F as He,a as Ae,b as Ie,H as Ke}from"./DBDXvqfh.js";var A,P,F,q,ke;const J=class J{constructor(e){N(this,q);N(this,A,new WeakMap);N(this,P);N(this,F);Z(this,F,e)}observe(e,t){var o=z(this,A).get(e)||new Set;return o.add(t),z(this,A).set(e,o),oe(this,q,ke).call(this).observe(e,z(this,F)),()=>{var h=z(this,A).get(e);h.delete(t),h.size===0&&(z(this,A).delete(e),z(this,P).unobserve(e))}}};A=new WeakMap,P=new WeakMap,F=new WeakMap,q=new WeakSet,ke=function(){return z(this,P)??Z(this,P,new ResizeObserver(e=>{for(var t of e){J.entries.set(t.target,t);for(var o of z(this,A).get(t.target)||[])o(t)}}))},ce(J,"entries",new WeakMap);let ae=J;var Pe=new ae({box:"border-box"});function pe(n,e,t){var o=Pe.observe(n,()=>t(n[e]));Me(()=>(Te(()=>t(n[e])),o))}const De=(n,e)=>{let t=n.previousSibling;for(;t;){if(e(t))return t;t=t.previousSibling}return null},Ne=(n,e)=>{let t=n.nextSibling;for(;t;){if(e(t))return t;t=t.nextSibling}return null};var Ue=Q('<div class="middle_c svelte-gdrax4"><!></div>'),We=Q('<button type="button"><!></button>');function Ye(n,e){ie(e,!0);const t=b(e,"clickable",3,!0),o=b(e,"enabled",3,!0),h=b(e,"pressed",3,!1),k=b(e,"highlighted",3,!1),x=b(e,"emphasized",3,!1),_=b(e,"middle_c_label",3,!0),c=b(e,"allow_sticking",3,!1),r=y(()=>be.has(e.note)),g=y(()=>!s(r)),v=y(()=>e.note===60),f=a=>{const i=De(a,u=>u instanceof HTMLButtonElement);i==null||i.focus()},M=a=>{const i=Ne(a,u=>u instanceof HTMLButtonElement);i==null||i.focus()},T=a=>{var u;const{key:i}=a;switch(i){case" ":case"Enter":{ue(a),(u=e.onpress)==null||u.call(e,e.note),a.currentTarget.focus();break}case"ArrowLeft":{f(a.currentTarget);break}case"ArrowRight":{M(a.currentTarget);break}}},E=a=>{var u;const{key:i}=a;switch(i){case" ":case"Enter":{ue(a),(u=e.onrelease)==null||u.call(e,e.note);break}}},d=y(()=>t()&&o());var l=We();let w;l.__keydown=function(...a){var i;(i=s(d)?T:void 0)==null||i.apply(this,a)},l.__keyup=function(...a){var i;(i=s(d)?E:void 0)==null||i.apply(this,a)},l.__mousedown=function(...a){var i;(i=s(d)?u=>{var L;(L=e.onpress)==null||L.call(e,e.note),u.currentTarget.focus()}:void 0)==null||i.apply(this,a)},l.__mouseup=function(...a){var i;(i=s(d)?()=>{var u;(u=e.onrelease)==null||u.call(e,e.note)}:void 0)==null||i.apply(this,a)},l.__focusout=function(...a){var i;(i=s(d)&&!c()?()=>{var u;(u=e.onrelease)==null||u.call(e,e.note)}:void 0)==null||i.apply(this,a)};let B;var I=te(l);{var D=a=>{var i=Ue(),u=te(i);{var L=H=>{var m=ne();j(()=>Se(m,_())),S(H,m)},R=(H,m)=>{{var ve=K=>{var G=ne("C4");S(K,G)},ye=K=>{var G=re(),me=_e(G);ge(me,_),S(K,G)};O(H,K=>{typeof _()=="boolean"?K(ve):K(ye,!1)},m)}};O(u,H=>{typeof _()=="string"?H(L):H(R,!1)})}X(i),S(a,i)};O(I,a=>{s(v)&&_()&&a(D)})}X(l),j(a=>{w=he(l,1,"piano_key svelte-gdrax4",null,w,a),Y(l,"tabindex",s(d)?void 0:-1),Y(l,"aria-label",`piano key for midi ${e.note??""}`),Y(l,"data-note",e.note),B=fe(l,"",B,{left:`${e.left_offset??""}px`})},[()=>({natural:s(r),accidental:s(g),disabled:!o(),clickable:s(d),active:h(),highlighted:k(),emphasized:x()})]),W("mouseenter",l,function(...a){var i;(i=s(d)&&e.pressing_any?u=>{var L;(L=e.onpress)==null||L.call(e,e.note),u.currentTarget.focus()}:void 0)==null||i.apply(this,a)}),W("mouseleave",l,function(...a){var i;(i=s(d)?()=>{var u;(u=e.onrelease)==null||u.call(e,e.note)}:void 0)==null||i.apply(this,a)}),S(n,l),se()}de(["keydown","keyup","mousedown","mouseup","focusout"]);const Fe=5,Ge=7/12,Oe=.7,ee={1:0,2:-3/5,3:0,4:-2/5,5:0,6:0,7:-2/3,8:0,9:-1/2,10:0,11:-1/3,12:0},Xe=(n,e,t,o=500)=>{const h=Math.abs(ee[$[e]]);let k=Math.abs(ee[$[t]]);k&&(k=1-k);const x=t-e+1;if(x<=0)return{piano_keys:[],natural_key_height:o,natural_key_width:0,accidental_key_height:0,accidental_key_width:0};const _=He(e,t),c=n/(_.length+(h+k))|0,r=c*Ge|0,g=Math.min(o,r*Fe)|0,v=g*Oe|0;let f=0;const M=[];for(let T=0;T<x;T++){const E=T+e;let d,l,w;be.has(E)?(d=c,l=g,w=f*c+h*r,f++):(d=r,l=v,w=f*c+ee[$[E]]*r+h*r),M.push({note:E,left_offset:w,width:d,height:l})}return{piano_keys:M,natural_key_height:g,natural_key_width:c,accidental_key_height:v,accidental_key_width:r}};var je=Q("<div></div>");function $e(n,e){ie(e,!0);const t=b(e,"max_height",3,void 0),o=b(e,"min_note",3,Ae),h=b(e,"max_note",3,Ie),k=b(e,"enabled_notes",3,null),x=b(e,"pressed_keys",3,null),_=b(e,"highlighted_keys",3,null),c=b(e,"emphasized_keys",3,null),r=b(e,"clickable",3,!0),g=y(()=>Xe(e.width,o(),h(),t())),v=y(()=>s(g).piano_keys),f=y(()=>s(g).natural_key_width),M=y(()=>s(g).natural_key_height),T=y(()=>s(g).accidental_key_width),E=y(()=>s(g).accidental_key_height);let d=Ee(!1);var l=je();W("mousedown",p,()=>C(d,!0),!0),W("mouseup",p,()=>C(d,!1),!0),W("mouseleave",p,()=>C(d,!1));let w,B;Be(l,21,()=>s(v),({note:I,left_offset:D})=>I,(I,D)=>{let a=()=>s(D).note,i=()=>s(D).left_offset;const u=y(()=>!k()||k().has(a())),L=y(()=>{var m;return(m=x())==null?void 0:m.has(a())}),R=y(()=>{var m;return(m=_())==null?void 0:m.has(a())}),H=y(()=>{var m;return(m=c())==null?void 0:m.has(a())});Ye(I,{get note(){return a()},get left_offset(){return i()},get clickable(){return r()},get enabled(){return s(u)},get pressed(){return s(L)},get highlighted(){return s(R)},get emphasized(){return s(H)},get middle_c_label(){return e.middle_c_label},get allow_sticking(){return e.allow_sticking},get pressing_any(){return s(d)},get onpress(){return e.onpress},get onrelease(){return e.onrelease}})}),X(l),j(I=>{w=he(l,1,"piano svelte-d5674k",null,w,I),Y(l,"aria-disabled",!r()),B=fe(l,"",B,{width:`${e.width??""}px`,height:`${s(M)??""}px`,"--piano_natural_key_width":`${s(f)??""}px`,"--piano_natural_key_height":`${s(M)??""}px`,"--piano_accidental_key_width":`${s(T)??""}px`,"--piano_accidental_key_height":`${s(E)??""}px`})},[()=>({disabled:!r()})]),S(n,l),se()}var U=(n=>(n[n.Stop=8]="Stop",n[n.Start=9]="Start",n[n.Knob=11]="Knob",n[n.PitchBend=14]="PitchBend",n))(U||{});function et(n,e){ie(e,!0);const t=console.log.bind(console),o=_=>{var M,T,E,d,l,w,B;const c=Ke(_),{command:r,channel:g,note:v,velocity:f}=c;switch(t("midimessage",r,c),r){case U.Stop:{g===0?(M=e.onnotestop)==null||M.call(e,v,f):g===9?(T=e.onpadstop)==null||T.call(e,v,f):t("unknown MIDI stop command",c);break}case U.Start:{g===0?f===0?(E=e.onnotestop)==null||E.call(e,v,f):(d=e.onnotestart)==null||d.call(e,v,f):g===9?f===0?(l=e.onpadstop)==null||l.call(e,v,f):(w=e.onpadstart)==null||w.call(e,v,f):t("unknown MIDI start command",c);break}case U.Knob:{v===1?(B=e.onmodwheel)==null||B.call(e,f):t("unknown MIDI knob command",c);break}case U.PitchBend:{t("unhandled MIDI pitch bend",c);break}default:t("unrecognized MIDI command",c)}},h=[],k=()=>{for(const _ of h)_();h.length=0};Le(k);const x=_=>{if(h.length&&k(),!!_)for(const c of _.inputs.values())c.addEventListener("midimessage",o),h.push(()=>{c.removeEventListener("midimessage",o)})};ze(()=>x(e.midi_access)),se()}var qe=Q('<button type="button" class="icon_button plain_button svelte-1gk9bl5"><!></button>');function tt(n,e){const t=b(e,"title",3,"go back");var o=qe();o.__click=function(..._){var c;(c=e.onclick)==null||c.apply(this,_)};var h=te(o);{var k=_=>{var c=re(),r=_e(c);ge(r,()=>e.children),S(_,c)},x=_=>{var c=ne("←");S(_,c)};O(h,_=>{e.children?_(k):_(x,!1)})}X(o),j(()=>Y(o,"title",t())),S(n,o)}de(["click"]);export{tt as B,et as M,$e as P,pe as b};
