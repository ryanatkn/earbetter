var we=Object.defineProperty;var le=n=>{throw TypeError(n)};var xe=(n,e,t)=>e in n?we(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ce=(n,e,t)=>xe(n,typeof e!="symbol"?e+"":e,t),R=(n,e,t)=>e.has(n)||le("Cannot "+t);var D=(n,e,t)=>(R(n,e,"read from private field"),t?t.call(n):e.get(n)),P=(n,e,t)=>e.has(n)?le("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),V=(n,e,t,o)=>(R(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t),oe=(n,e,t)=>(R(n,e,"access private method"),t);import{e as Ie,u as Me,p as ie,g as s,d as v,c as te,r as O,t as X,a as se,f as ue,F as Z,N as Te,$ as p,O as Ee,M as De}from"./D-3fTjYY.js";import{d as _e,t as J,e as N,a as L,b as ne,s as Le,c as fe}from"./Ckbefv40.js";import{c as he,s as U,d as re,b as be,e as ze}from"./L33y2_sP.js";import{p as g,i as G}from"./t9At_Kmo.js";import{C as ge,s as de,E as $,F as He,a as Ae,b as Be,H as Ce}from"./CsFJHB9r.js";var A,S,W,j,ke;const q=class q{constructor(e){P(this,j);P(this,A,new WeakMap);P(this,S);P(this,W);V(this,W,e)}observe(e,t){var o=D(this,A).get(e)||new Set;return o.add(t),D(this,A).set(e,o),oe(this,j,ke).call(this).observe(e,D(this,W)),()=>{var h=D(this,A).get(e);h.delete(t),h.size===0&&(D(this,A).delete(e),D(this,S).unobserve(e))}}};A=new WeakMap,S=new WeakMap,W=new WeakMap,j=new WeakSet,ke=function(){return D(this,S)??V(this,S,new ResizeObserver(e=>{for(var t of e){q.entries.set(t.target,t);for(var o of D(this,A).get(t.target)||[])o(t)}}))},ce(q,"entries",new WeakMap);let ae=q;var Se=new ae({box:"border-box"});function pe(n,e,t){var o=Se.observe(n,()=>t(n[e]));Ie(()=>(Me(()=>t(n[e])),o))}const Ke=(n,e)=>{let t=n.previousSibling;for(;t;){if(e(t))return t;t=t.previousSibling}return null},Pe=(n,e)=>{let t=n.nextSibling;for(;t;){if(e(t))return t;t=t.nextSibling}return null};var Ne=J('<div class="middle_c svelte-sdpd33"><!></div>'),Ue=J('<button type="button"><!></button>');function We(n,e){ie(e,!0);const t=g(e,"clickable",3,!0),o=g(e,"enabled",3,!0),h=g(e,"pressed",3,!1),k=g(e,"highlighted",3,!1),x=g(e,"emphasized",3,!1),u=g(e,"middle_c_label",3,!0),c=g(e,"allow_sticking",3,!1),f=v(()=>ge.has(e.note)),b=v(()=>!s(f)),m=v(()=>e.note===60),r=a=>{const i=Ke(a,d=>d instanceof HTMLButtonElement);i==null||i.focus()},I=a=>{const i=Pe(a,d=>d instanceof HTMLButtonElement);i==null||i.focus()},M=a=>{var d;const{key:i}=a;switch(i){case" ":case"Enter":{de(a),(d=e.onpress)==null||d.call(e,e.note),a.currentTarget.focus();break}case"ArrowLeft":{r(a.currentTarget);break}case"ArrowRight":{I(a.currentTarget);break}}},T=a=>{var d;const{key:i}=a;switch(i){case" ":case"Enter":{de(a),(d=e.onrelease)==null||d.call(e,e.note);break}}},_=v(()=>t()&&o());var l=Ue();let w;l.__keydown=function(...a){var i;(i=s(_)?M:void 0)==null||i.apply(this,a)},l.__keyup=function(...a){var i;(i=s(_)?T:void 0)==null||i.apply(this,a)},l.__mousedown=function(...a){var i;(i=s(_)?d=>{var E;(E=e.onpress)==null||E.call(e,e.note),d.currentTarget.focus()}:void 0)==null||i.apply(this,a)},l.__mouseup=function(...a){var i;(i=s(_)?()=>{var d;(d=e.onrelease)==null||d.call(e,e.note)}:void 0)==null||i.apply(this,a)},l.__focusout=function(...a){var i;(i=s(_)&&!c()?()=>{var d;(d=e.onrelease)==null||d.call(e,e.note)}:void 0)==null||i.apply(this,a)};let z;var B=te(l);{var K=a=>{var i=Ne(),d=te(i);{var E=H=>{var y=ne();X(()=>Le(y,u())),L(H,y)},Q=(H,y)=>{{var me=C=>{var Y=ne("C4");L(C,Y)},ve=C=>{var Y=fe(),ye=ue(Y);be(ye,u),L(C,Y)};G(H,C=>{typeof u()=="boolean"?C(me):C(ve,!1)},y)}};G(d,H=>{typeof u()=="string"?H(E):H(Q,!1)})}O(i),L(a,i)};G(B,a=>{s(m)&&u()&&a(K)})}O(l),X(a=>{w=he(l,1,"piano_key svelte-sdpd33",null,w,a),U(l,"tabindex",s(_)?void 0:-1),U(l,"aria-label",`piano key for midi ${e.note??""}`),U(l,"data-note",e.note),z=re(l,"",z,{left:`${e.left_offset??""}px`})},[()=>({natural:s(f),accidental:s(b),disabled:!o(),clickable:s(_),active:h(),highlighted:k(),emphasized:x()})]),N("mouseenter",l,function(...a){var i;(i=s(_)&&e.pressing_any?d=>{var E;(E=e.onpress)==null||E.call(e,e.note),d.currentTarget.focus()}:void 0)==null||i.apply(this,a)}),N("mouseleave",l,function(...a){var i;(i=s(_)?()=>{var d;(d=e.onrelease)==null||d.call(e,e.note)}:void 0)==null||i.apply(this,a)}),L(n,l),se()}_e(["keydown","keyup","mousedown","mouseup","focusout"]);const Ye=5,Fe=7/12,Ge=.7,ee={1:0,2:-3/5,3:0,4:-2/5,5:0,6:0,7:-2/3,8:0,9:-1/2,10:0,11:-1/3,12:0},Oe=(n,e,t,o=500)=>{const h=Math.abs(ee[$[e]]);let k=Math.abs(ee[$[t]]);k&&(k=1-k);const x=t-e+1;if(x<=0)return{piano_keys:[],natural_key_height:o,natural_key_width:0,accidental_key_height:0,accidental_key_width:0};const u=He(e,t),c=n/(u.length+(h+k))|0,f=c*Fe|0,b=Math.min(o,f*Ye)|0,m=b*Ge|0;let r=0;const I=[];for(let M=0;M<x;M++){const T=M+e;let _,l,w;ge.has(T)?(_=c,l=b,w=r*c+h*f,r++):(_=f,l=m,w=r*c+ee[$[T]]*f+h*f),I.push({note:T,left_offset:w,width:_,height:l})}return{piano_keys:I,natural_key_height:b,natural_key_width:c,accidental_key_height:m,accidental_key_width:f}};var Xe=J("<div></div>");function $e(n,e){ie(e,!0);const t=g(e,"max_height",3,void 0),o=g(e,"min_note",3,Ae),h=g(e,"max_note",3,Be),k=g(e,"enabled_notes",3,null),x=g(e,"pressed_keys",3,null),u=g(e,"highlighted_keys",3,null),c=g(e,"emphasized_keys",3,null),f=g(e,"clickable",3,!0),b=v(()=>Oe(e.width,o(),h(),t())),m=v(()=>s(b).piano_keys),r=v(()=>s(b).natural_key_width),I=v(()=>s(b).natural_key_height),M=v(()=>s(b).accidental_key_width),T=v(()=>s(b).accidental_key_height);let _=Te(!1);var l=Xe();N("mousedown",p,()=>Z(_,!0),!0),N("mouseup",p,()=>Z(_,!1),!0),N("mouseleave",p,()=>Z(_,!1));let w,z;ze(l,21,()=>s(m),({note:B,left_offset:K})=>B,(B,K)=>{let a=()=>s(K).note,i=()=>s(K).left_offset;const d=v(()=>!k()||k().has(a())),E=v(()=>{var y;return(y=x())==null?void 0:y.has(a())}),Q=v(()=>{var y;return(y=u())==null?void 0:y.has(a())}),H=v(()=>{var y;return(y=c())==null?void 0:y.has(a())});We(B,{get note(){return a()},get left_offset(){return i()},get clickable(){return f()},get enabled(){return s(d)},get pressed(){return s(E)},get highlighted(){return s(Q)},get emphasized(){return s(H)},get middle_c_label(){return e.middle_c_label},get allow_sticking(){return e.allow_sticking},get pressing_any(){return s(_)},get onpress(){return e.onpress},get onrelease(){return e.onrelease}})}),O(l),X(B=>{w=he(l,1,"piano svelte-d5674k",null,w,B),U(l,"aria-disabled",!f()),z=re(l,"",z,{width:`${e.width??""}px`,height:`${s(I)??""}px`,"--piano_natural_key_width":`${s(r)??""}px`,"--piano_natural_key_height":`${s(I)??""}px`,"--piano_accidental_key_width":`${s(M)??""}px`,"--piano_accidental_key_height":`${s(T)??""}px`})},[()=>({disabled:!f()})]),L(n,l),se()}const F={Stop:8,Start:9,Knob:11,PitchBend:14};function et(n,e){ie(e,!0);const t=console.log.bind(console),o=u=>{var I,M,T,_,l,w,z;const c=Ce(u),{command:f,channel:b,note:m,velocity:r}=c;switch(t("midimessage",f,c),f){case F.Stop:{b===0?(I=e.onnotestop)==null||I.call(e,m,r):b===9?(M=e.onpadstop)==null||M.call(e,m,r):t("unknown MIDI stop command",c);break}case F.Start:{b===0?r===0?(T=e.onnotestop)==null||T.call(e,m,r):(_=e.onnotestart)==null||_.call(e,m,r):b===9?r===0?(l=e.onpadstop)==null||l.call(e,m,r):(w=e.onpadstart)==null||w.call(e,m,r):t("unknown MIDI start command",c);break}case F.Knob:{m===1?(z=e.onmodwheel)==null||z.call(e,r):t("unknown MIDI knob command",c);break}case F.PitchBend:{t("unhandled MIDI pitch bend",c);break}default:t("unrecognized MIDI command",c)}},h=[],k=()=>{for(const u of h)u();h.length=0};Ee(k);const x=u=>{if(h.length&&k(),!!u)for(const c of u.inputs.values())c.addEventListener("midimessage",o),h.push(()=>{c.removeEventListener("midimessage",o)})};De(()=>x(e.midi_access)),se()}var je=J('<button type="button" class="icon_button plain_button svelte-1otcvwf"><!></button>');function tt(n,e){const t=g(e,"title",3,"go back");var o=je();o.__click=function(...u){var c;(c=e.onclick)==null||c.apply(this,u)};var h=te(o);{var k=u=>{var c=fe(),f=ue(c);be(f,()=>e.children),L(u,c)},x=u=>{var c=ne("←");L(u,c)};G(h,u=>{e.children?u(k):u(x,!1)})}O(o),X(()=>U(o,"title",t())),L(n,o)}_e(["click"]);export{tt as B,et as M,$e as P,pe as b};
